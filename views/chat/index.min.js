var socket;function socket_start(){socket||(console.log("WebSocket Started"),socket=socket_server());try{socket.onopen=function(t){console.log("socket initialized",t)},socket.onmessage=function(t){var e=JSON.parse(t.data);console.log(e)},socket.onclose=function(t){console.log({closed:socket,msg:t})}}catch(t){console.log(t)}}function socket_server(){console.log("Socket Initialized");var t="/chat/server";if(window.EventSource)var e=new EventSource(t);else e=new WebSocket(t);return e}function socket_stop(){null!=socket&&(console.log("WebSocket Stopped"),socket.close(),socket=null)}function socket_check(){return socket}$(document).ready((function(){function t(){$.ajax({url:"fetch_user",method:"POST",success:function(t){$("#user_details").html(t)}})}function e(){$.ajax({url:"update_last_activity",success:function(){}})}function o(t,e){var o='<div id="user_dialog_'+t+'" class="user_dialog" title="You have chat with '+e+'">';o+='<div style="height:400px; border:1px solid #ccc; overflow-y: scroll; margin-bottom:24px; padding:16px;" class="chat_history" data-touserid="'+t+'" id="chat_history_'+t+'">',o+=a(t),o+="</div>",o+='<div class="form-group">',o+='<textarea name="chat_message_'+t+'" id="chat_message_'+t+'" class="form-control chat_message"></textarea>',o+='</div><div class="form-group" align="right">',o+='<button type="button" name="send_chat" id="'+t+'" class="btn btn-info send_chat">Send</button></div></div>',$("#user_model_details").html(o)}function a(t){$.ajax({url:"fetch_user_chat_history",method:"POST",data:{to_user_id:t},success:function(e){$("#chat_history_"+t).html(e)}})}function c(){$(".chat_history").each((function(){var t=$(this).data("touserid");a(t)}))}function s(){var t=$("#is_active_group_chat_window").val(),e="fetch_data";"yes"==t&&$.ajax({url:"group_chat",method:"POST",data:{action:e},success:function(t){$("#group_chat_history").html(t)}})}t(),setInterval((function(){e(),t(),c(),s()}),5e3),$((function(){$(document).on("click",".start_chat",(function(){var t=$(this).data("touserid"),e=$(this).data("tousername");o(t,e),$("#user_dialog_"+t).dialog({autoOpen:!1,width:400}),$("#user_dialog_"+t).dialog("open"),$("#chat_message_"+t).emojioneArea({pickerPosition:"top",toneStyle:"bullet"})})),$(document).on("click",".send_chat",(function(){var t=$(this).attr("id"),e=$.trim($("#chat_message_"+t).val());""!=e?$.ajax({url:"insert_chat",method:"POST",data:{to_user_id:t,chat_message:e},success:function(e){var o=$("#chat_message_"+t).emojioneArea();o[0].emojioneArea.setText(""),$("#chat_history_"+t).html(e)}}):alert("Type something")})),$(document).on("click",".ui-button-icon",(function(){$(".user_dialog").dialog("destroy").remove(),$("#is_active_group_chat_window").val("no")})),$(document).on("focus",".chat_message",(function(){var t="yes";$.ajax({url:"update_is_type_status",method:"POST",data:{is_type:t},success:function(){}})})),$(document).on("blur",".chat_message",(function(){var t="no";$.ajax({url:"update_is_type_status",method:"POST",data:{is_type:t},success:function(){}})})),$("#group_chat_dialog").dialog({autoOpen:!1,width:400}),$("#group_chat").click((function(){$("#group_chat_dialog").dialog("open"),$("#is_active_group_chat_window").val("yes"),s()})),$("#send_group_chat").click((function(){var t=$.trim($("#group_chat_message").html()),e="insert_data";""!=t?$.ajax({url:"group_chat",method:"POST",data:{chat_message:t,action:e},success:function(t){$("#group_chat_message").html(""),$("#group_chat_history").html(t)}}):alert("Type something")})),$("#uploadFile").on("change",(function(){$("#uploadImage").ajaxSubmit({target:"#group_chat_message",resetForm:!0})})),$(document).on("click",".remove_chat",(function(){var t=$(this).attr("id");confirm("Are you sure you want to remove this chat?")&&$.ajax({url:"remove_chat",method:"POST",data:{chat_message_id:t},success:function(t){c()}})}))}))}));