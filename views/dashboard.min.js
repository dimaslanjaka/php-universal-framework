var formotpc=$("form#otpc");formotpc.fadeOut("fast");var formotpr=$("form#otp"),info=$("#msisdn-info"),fnx=$("#fn"),tfn=$("#tfn"),puk1=$("#puk1"),puk2=$("#puk2"),imgwel=$("#imgwel"),pkdt=$("#pkdt"),pkgs=$('select[id^="pkg-stats"]'),pkgls=$("select#pkgls"),pkgr=$("button#pkg-refresh"),pkgb=$("button#pkg-buy");pkgb.length&&pkgb.click((function(t){t.preventDefault();var e=$("select#pkgls").val();e?$.post(location.protocol+"//"+location.host+"/tsel-paket-info",{"paket-id":e},(function(t){t.child("id",(function(t){$.post(location.protocol+"//"+location.host+"/tsel-paket-buy",{"paket-id":t},(function(t){console.log(t),"object"==typeof t&&t.child("error",(function(e){e&&t.child("message",(function(t){switch(t.toLowerCase()){case"access token required":t="Login OTP required, please login number first";break;default:break}toastr.error(t,"package info")}))}))}))}))})):toastr.error("Package not selected, please select one","package info")}));var list_pkg=function(t){$.ajax({type:"POST",url:location.protocol+"//"+location.host+"/tsel-paket-info",data:{list:!0},success:function(e){var o;e.hasOwnProperty("message")&&toastr.error(e.message,"package info"),pkgls.empty(),pkgls.append('<option value="" disabled selected>Select package</option>');for(var s=0;s<e.length;s++)e[s].hasOwnProperty("name")&&(o=!0,pkgls.append(`<option value="${e[s].id}">${e[s].name} ${e[s].quota} ${e[s].price} ${e[s].period}</option>`),t&&o&&s==e.length-1&&toastr.success("Packages refreshed successfully","package info"))}})};if(pkgls.length&&list_pkg(),pkgr.length&&pkgr.click((function(t){t.preventDefault(),list_pkg(!0)})),pkgs.length&&pkgs.change((function(t){t.preventDefault();var e=$(this).val(),o=$(this).data("id");console.log(`changing status of package ${e} for ${o}`),$.post(location.protocol+"//"+location.host+"/dashboard",{id:o,status:e,"status-pkg":1},(function(t){"object"==typeof t&&t.child("success",(function(t){t&&toastr.success("Package status changed successfully","package info")}))}))})),pkdt.length){var preq,pkgl=$("#pkg-loading");pkgl.fadeOut("fast");var tbc=$("#paket-details");pkdt.on("change keyup",(function(t){t.preventDefault();var e=$(this).val();e&&""!=e&&(preq&&preq.abort(),pkgl.fadeIn("slow"),preq=$.post(location.protocol+"//"+location.host+"/tsel-paket-info",{"paket-id":e},(function(t){if("object"==typeof t){var o=Object.size(t);tbc.html(""),pkgl.fadeOut("slow");var s=0;for(key in t){s++;var a=t[key];"object"==typeof a&&(a=`<pre>${JSON.stringify(a,null,4)}</pre>`),tbc.append(`<tr><td>${key}</td><td >${a}</td></tr>`),s==o&&toastr.warning("<button type='button' id='cYes' class='btn clear btn-block btn-success'>Yes</button>",`add package ${e} ?`,{closeButton:!0,allowHtml:!0,onShown:function(t){$("#cYes").click((function(){console.log("clicked yes"),$.post(location.protocol+"//"+location.host+"/dashboard",{"add-pkg":1,id:e},(function(t){return console.log(t),"string"==typeof t&&t.includes("Duplicate entry")?toastr.error("package id already added","package info"):toastr.success("package added successfully","package info")}))}))}},{timeOut:0,extendedTimeOut:0,closeHtml:'<button><i class="fas fa-times"></i></button>',closeMethod:"fadeOut",closeDuration:6e4,closeEasing:"swing",preventDuplicates:!0,progressBar:!0})}}else console.error("res is not object")})))}))}var check_msisdn=function(t){t||$.post(location.protocol+"//"+location.host+"/tsel-profile2",{},(function(t){console.log(t),t&&"object"==typeof t&&t.child("puk",(function(e){puk1.html(e.profiles.puk1),puk2.html(e.profiles.puk2),t.child("me",(function(t){fnx.html(`Welcome, ${t.title} ${t.givenName} ${t.sn}`),tfn.html("Account status "+t.accountStatus);var e=new Date,o=(e.getHours(),imgwel.attr("src"));o=e.getHours()<12?"https://www.lovethispic.com/uploaded_images/361167-Good-Morning-And-Have-A-Nice-Day.jpg":e.getHours()>=12&&e.getHours()<=14?"https://www.goodmorningimagesdownload.com/wp-content/uploads/2019/08/good-afternoon-pics-17.jpg":e.getHours()>14&&e.getHours()<=22?"https://www.lovethispic.com/uploaded_images/361528-Good-Evening-Take-Care.jpg":"https://www.happybirthdaymsg.com/wp-content/uploads/2015/11/good-night-image-5.jpg",$("#imgwel").attr("src",o)}))}))}))};function requestOTP(t){$.post(location.protocol+"//"+location.host+"/tsel-otp",t,(function(t){console.log(t),t&&"object"==typeof t&&(t.child("response",(function(e){t=e.body})),t.child("error-codes",(function(t){t&&(console.log("recaptcha failure"),gexec("reloadForm",!0,(function(t){formotpc=$("form#otp"),requestOTP(formotpc.serialize())})))})),t.child("authId",(function(t){toastr.success("otp request successfully","otp information"),formotpr.fadeOut("slow",(function(t){formotpc.fadeIn("slow")}))})),t.child("message",(function(t){toastr.error(t,"otp information".toUpperCase())})),t.child("tokenId",(function(e){$.post(location.protocol+"//"+location.host+"/tsel-get",{tokenId:t.tokenId},(function(t){console.log(t),toastr.success("Relogin successfully","login information".toUpperCase()),formotpc.fadeOut("slow"),check_msisdn()}))})))}))}function verifyOTP(t){$.post(location.protocol+"//"+location.host+"/tsel-callback",t,(function(t){console.log(t),t&&"object"==typeof t&&(t.hasOwnProperty("response")&&(t=t.response.body),t.child("response",(function(e){t=e.body})),console.log(t),t.child("tokenId",(function(e){$.post(location.protocol+"//"+location.host+"/tsel-get",{tokenId:t.tokenId},(function(t){console.log(t),toastr.success("Login request successfully".capitalize(),"login information".toUpperCase()),formotpc.fadeOut("slow"),check_msisdn()}))})),t.child("authId",(function(t){toastr.error("Login request failed".capitalize(),"login information".toUpperCase())})),t.child("message",(function(t){toastr.error(t,"otp information".toUpperCase())})))}))}check_msisdn(),$("form#otpc #back").click((function(t){t.preventDefault(),formotpc.fadeOut("slow",(function(){formotpr.fadeIn("slow")}))})),formotpr.on("submit",(function(t){t.preventDefault();var e=$(this).serialize();requestOTP(e)})),formotpc.on("submit",(function(t){t.preventDefault();var e=$(this).serialize();verifyOTP(e)})),$("form#regist").length&&$("form#regist").submit((function(t){t.preventDefault(),$.post(location.protocol+"//"+location.host+"/signup",$(this).serialize(),(function(t){t&&"object"==typeof t&&t.child("success",(function(t){!0===t&&toastr.success("User created successfully".capitalize(),"user management".toUpperCase())}))}))})),$('a[href="#change"]').length&&$('a[href="#change"]').click((function(t){t.preventDefault();var e=$(this).data("id");swal({content:{element:"input",attributes:{placeholder:"Type your password",type:"text"}}}).then(t=>{$.post(location.protocol+"//"+location.host+"/user",{change:"password",id:e,value:t},(function(t){t.child("success",(function(t){t&&toastr.success("Password changed successfully","user management")}))}))})})),$('a[href="#delete"]').length&&$('a[href="#delete"]').click((function(t){t.preventDefault();var e=$(this).data("id");swal({title:"Are you sure?".capitalize(),text:"Once deleted, you will not be able to recover this user!".capitalize(),icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t?$.post(location.protocol+"//"+location.host+"/user",{id:e,delete:!0},(function(t){swal("Poof! User has been deleted!".capitalize(),{icon:"success"})})):swal("User file is safe!")})})),$('select[id^="role"]').length&&$('select[id^="role"]').change((function(){var t=$(this).data("id"),e=$(this).val();console.log(t,e),t&&e&&$.post(location.protocol+"//"+location.host+"/user",{change:"role",id:t,value:e},(function(t){t.child("success",(function(t){t&&toastr.success("Role changed successfully".capitalize(),"user management".toUpperCase())}))}))})),$("#dtMaterial").length&&($("#dtMaterial").DataTable(),$("#dtMaterial_wrapper").find("label").each((function(){$(this).parent().append($(this).children())})),$("#dtMaterial_wrapper .dataTables_filter").find("input").each((function(){const t=$(this);t.attr("placeholder","Search"),t.removeClass("form-control-sm")})),$("#dtMaterial_wrapper .dataTables_length").addClass("d-flex flex-row"),$("#dtMaterial_wrapper .dataTables_filter").addClass("md-form"),$("#dtMaterial_wrapper select").removeClass("custom-select custom-select-sm form-control form-control-sm"),$("#dtMaterial_wrapper select").addClass("mdb-select"),$("#dtMaterial_wrapper .mdb-select").materialSelect(),$("#dtMaterial_wrapper .dataTables_filter").find("label").remove());