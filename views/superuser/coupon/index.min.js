var table;function dtreload(){table&&table.ajax.reload()}$(document).ready((function(){framework().captcha.get("sname"),$("input#coupon").val(Math.random().toString(36).substr(2,9)),$(document).on("submit","form",(function(t){t.preventDefault();var e=$(this),a=e.data("success");ajx({url:e.attr("action"),method:e.attr("method"),data:e.serialize(),success:function(t){console.log(t)}},a,null,null)})),smartform(),$.fn.dataTable.ext.errMode="none",table=$("#listCoupons").DataTable({destroy:!0,processing:!0,serverSide:!0,fixedColumns:!0,stateSave:!1,autoWidth:!1,responsive:!0,deferRender:!0,paging:!0,hideEmptyCols:!0,ajax:{url:"?list="+guid(),type:"post",data:{term:getUID(),data:"",list:"true"},headers:{Accept:"application/json"},dataSrc:function(t){ids=t.data;var e=t.data;return e?(t.data.forEach((function(t,e){if(t.hasOwnProperty("limit")){var a=guid();t.limit=`<form data-success="dtreload" method="post" action="edit?guid=${a}" class="form-inline">\n                <input type="hidden" name="coupon" value="${t.code}" />\n                <div class="md-form m-0 p-0"><input class="form-control p-0 m-0" type="number" id="limit-${t.code}" name="limit" value="${t.limit}" />\n                <small id="help-${t.code}" class="form-text text-muted">\n                <i class="text-success">${t.success} Success</i> - <i class="text-primary">${t.limit-t.success} Remaining</i>\n                </small></div>\n                <button type="submit" class="btn purple text-white ml-2"><i class="fad fa-save"></i></button>\n                </form>`}})),t.data):{}},beforeSend:function(){table&&table.settings()[0].jqXHR.abort()}},dataSrc:"data",dataFilter:function(t){var e=jQuery.parseJSON(t);return console.log({dataFilter:e}),e.recordsTotal=e.recordsTotal,e.recordsFiltered=e.recordsFiltered,e.data=e.data,JSON.stringify(e)},lengthMenu:[5,10,15,20,25,30,100,200,300,400,500,"All"],createdRow:function(t,e,a){},columnDefs:[{targets:1,createdCell:function(t,e,a,o,n){}}],initComplete:function(){this.api()},columns:[{title:"Coupon",data:"code"},{title:"Limit",data:"limit"}],drawCallback:function(t){this.api()}}),$("#listCoupons").on("page.dt",(function(){$("html, body").animate({scrollTop:$(".dataTables_wrapper").offset().top},"slow"),$("thead tr th:first-child").focus().blur()})),$(".dataTables_length").addClass("bs-select"),setTimeout(()=>{$("#ReportLog").DataTable({destroy:!0,dom:"Bfrtip",processing:!1,serverSide:!1,stateSave:!1,autoWidth:!1,responsive:!0,deferRender:!0,paging:!0,lengthMenu:[5,10,15,20,25,30,100,200,300,400,500,"All"],ajax:{url:"index?report",headers:{Accept:"application/json"},method:"POST",data:{captcha:localStorage.getItem("captcha").toString(),data:"",report:"true"},dataSrc:function(t){var e=[];return e=Array.isArray(t)?t:[t],console.log(e),e}},columns:[{title:"MSISDN",data:"msisdn",name:"msisdn"},{title:"Coupon",data:"coupon",name:"coupon"},{title:"Date",data:"date",name:"date"}]})},600)}));