

<!DOCTYPE html>
<html lang="en">

<head>
  <script data-ad-client="ca-pub-1165447249910969" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106238155-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-106238155-1');
</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Universal Framework Javascript Documentation src/compiler/func.ts</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Universal Framework Javascript Documentation</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-node-localstorage.html">
                                node-localstorage
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/dimaslanjaka/universal-framework"
                        >
                            Github
                        </a>
                    
                        <a
                            class="link user-link "
                            href="/universal-framework/php"
                        >
                            PHP API
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://webmanajemen.com"
                        >
                            Blog
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="ajaxScheduler.html">ajaxScheduler</a></li><li><a href="Cookies.html">Cookies</a></li><li><a href="core.html">core</a></li><li><a href="GeneratorID.html">GeneratorID</a></li><li><a href="ip.html">ip</a></li><li><a href="Timer.html">Timer</a></li><li><a href="user.html">user</a></li><li><a href="ZLIB.html">ZLIB</a></li></ul><h3>Interfaces</h3><ul><li><a href="Array.html">Array</a></li><li><a href="Console.html">Console</a></li><li><a href="createElementOpt.html">createElementOpt</a></li><li><a href="HTMLScriptElement.html">HTMLScriptElement</a></li><li><a href="String.html">String</a></li><li><a href="Window.html">Window</a></li></ul><h3>Global</h3><ul><li><a href="global.html#___call">___call</a></li><li><a href="global.html#__call">__call</a></li><li><a href="global.html#aesDecrypt">aesDecrypt</a></li><li><a href="global.html#aesEncrypt">aesEncrypt</a></li><li><a href="global.html#aform">aform</a></li><li><a href="global.html#AJAX">AJAX</a></li><li><a href="global.html#AjaxForm">AjaxForm</a></li><li><a href="global.html#ajaxRun">ajaxRun</a></li><li><a href="global.html#ajx">ajx</a></li><li><a href="global.html#analys">analys</a></li><li><a href="global.html#array_keys">array_keys</a></li><li><a href="global.html#array_rand">array_rand</a></li><li><a href="global.html#array_remove">array_remove</a></li><li><a href="global.html#array_shuffle">array_shuffle</a></li><li><a href="global.html#array_unique">array_unique</a></li><li><a href="global.html#array_unset">array_unset</a></li><li><a href="global.html#asset">asset</a></li><li><a href="global.html#async">async</a></li><li><a href="global.html#async_exec">async_exec</a></li><li><a href="global.html#async_process">async_process</a></li><li><a href="global.html#async_this">async_this</a></li><li><a href="global.html#autoHeight_">autoHeight_</a></li><li><a href="global.html#bannedebug">bannedebug</a></li><li><a href="global.html#Base64">Base64</a></li><li><a href="global.html#base64_decode">base64_decode</a></li><li><a href="global.html#base64_encode">base64_encode</a></li><li><a href="global.html#base64_valid">base64_valid</a></li><li><a href="global.html#binl2rstr">binl2rstr</a></li><li><a href="global.html#binlMD5">binlMD5</a></li><li><a href="global.html#bitRotateLeft">bitRotateLeft</a></li><li><a href="global.html#build">build</a></li><li><a href="global.html#call_user_func">call_user_func</a></li><li><a href="global.html#compileAssets">compileAssets</a></li><li><a href="global.html#config_builder">config_builder</a></li><li><a href="global.html#copyToClipboard">copyToClipboard</a></li><li><a href="global.html#count">count</a></li><li><a href="global.html#countNewLines">countNewLines</a></li><li><a href="global.html#countries">countries</a></li><li><a href="global.html#createAlert">createAlert</a></li><li><a href="global.html#createApp">createApp</a></li><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#createJSON">createJSON</a></li><li><a href="global.html#createStyle">createStyle</a></li><li><a href="global.html#CryptoD">CryptoD</a></li><li><a href="global.html#CryptoE">CryptoE</a></li><li><a href="global.html#CryptoK">CryptoK</a></li><li><a href="global.html#datatables_colums_options">datatables_colums_options</a></li><li><a href="global.html#datatables_init">datatables_init</a></li><li><a href="global.html#datatables_optimize">datatables_optimize</a></li><li><a href="global.html#datetimelocal">datetimelocal</a></li><li><a href="global.html#debug_detect">debug_detect</a></li><li><a href="global.html#disable_button">disable_button</a></li><li><a href="global.html#doc">doc</a></li><li><a href="global.html#dumpAjax">dumpAjax</a></li><li><a href="global.html#elm">elm</a></li><li><a href="global.html#empty">empty</a></li><li><a href="global.html#enable_button">enable_button</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#extend_object">extend_object</a></li><li><a href="global.html#extend_setting_form">extend_setting_form</a></li><li><a href="global.html#findDups">findDups</a></li><li><a href="global.html#fixDeps">fixDeps</a></li><li><a href="global.html#forceSSL">forceSSL</a></li><li><a href="global.html#foreach">foreach</a></li><li><a href="global.html#formatNewLines">formatNewLines</a></li><li><a href="global.html#formsaver">formsaver</a></li><li><a href="global.html#framework">framework</a></li><li><a href="global.html#generateRandomString">generateRandomString</a></li><li><a href="global.html#get_currency_symbol">get_currency_symbol</a></li><li><a href="global.html#get_unique_id">get_unique_id</a></li><li><a href="global.html#getAnyClass">getAnyClass</a></li><li><a href="global.html#getCountries">getCountries</a></li><li><a href="global.html#getFuncName">getFuncName</a></li><li><a href="global.html#getKey">getKey</a></li><li><a href="global.html#getLatestVersion">getLatestVersion</a></li><li><a href="global.html#getLocationHash">getLocationHash</a></li><li><a href="global.html#getNativeClass">getNativeClass</a></li><li><a href="global.html#geToken">geToken</a></li><li><a href="global.html#getParameterByName">getParameterByName</a></li><li><a href="global.html#getRandom">getRandom</a></li><li><a href="global.html#gexec">gexec</a></li><li><a href="global.html#guid">guid</a></li><li><a href="global.html#hexHMACMD5">hexHMACMD5</a></li><li><a href="global.html#hexMD5">hexMD5</a></li><li><a href="global.html#http_build_query">http_build_query</a></li><li><a href="global.html#in_array">in_array</a></li><li><a href="global.html#inArray">inArray</a></li><li><a href="global.html#indicatorAjax">indicatorAjax</a></li><li><a href="global.html#inputrp">inputrp</a></li><li><a href="global.html#is_development">is_development</a></li><li><a href="global.html#is_localhost">is_localhost</a></li><li><a href="global.html#isBrowser">isBrowser</a></li><li><a href="global.html#isJSON">isJSON</a></li><li><a href="global.html#isMobile">isMobile</a></li><li><a href="global.html#isnode">isnode</a></li><li><a href="global.html#isNode">isNode</a></li><li><a href="global.html#isOffline">isOffline</a></li><li><a href="global.html#jAjax">jAjax</a></li><li><a href="global.html#JavaScriptCaller">JavaScriptCaller</a></li><li><a href="global.html#json_decode">json_decode</a></li><li><a href="global.html#L">L</a></li><li><a href="global.html#list_package">list_package</a></li><li><a href="global.html#load_datatables">load_datatables</a></li><li><a href="global.html#load_disqus">load_disqus</a></li><li><a href="global.html#load_module">load_module</a></li><li><a href="global.html#load_requirejs">load_requirejs</a></li><li><a href="global.html#loadCodemirror">loadCodemirror</a></li><li><a href="global.html#loadCSS">loadCSS</a></li><li><a href="global.html#LoadScript">LoadScript</a></li><li><a href="global.html#makeid">makeid</a></li><li><a href="global.html#md5">md5</a></li><li><a href="global.html#md5cmn">md5cmn</a></li><li><a href="global.html#md5ff">md5ff</a></li><li><a href="global.html#md5gg">md5gg</a></li><li><a href="global.html#md5hh">md5hh</a></li><li><a href="global.html#md5ii">md5ii</a></li><li><a href="global.html#module_exists">module_exists</a></li><li><a href="global.html#multiMinify">multiMinify</a></li><li><a href="global.html#object_join">object_join</a></li><li><a href="global.html#oddoreven">oddoreven</a></li><li><a href="global.html#onlyUnique">onlyUnique</a></li><li><a href="global.html#openInNewTab">openInNewTab</a></li><li><a href="global.html#pagination_up">pagination_up</a></li><li><a href="global.html#parse_proxy">parse_proxy</a></li><li><a href="global.html#parseNumber">parseNumber</a></li><li><a href="global.html#parsePackageString">parsePackageString</a></li><li><a href="global.html#prepEntities">prepEntities</a></li><li><a href="global.html#pseudo_builder">pseudo_builder</a></li><li><a href="global.html#Queue">Queue</a></li><li><a href="global.html#random_rgba">random_rgba</a></li><li><a href="global.html#rawHMACMD5">rawHMACMD5</a></li><li><a href="global.html#rawMD5">rawMD5</a></li><li><a href="global.html#readFile">readFile</a></li><li><a href="global.html#recaptcha">recaptcha</a></li><li><a href="global.html#reload_gulp">reload_gulp</a></li><li><a href="global.html#resolve_dir">resolve_dir</a></li><li><a href="global.html#restrict_mode">restrict_mode</a></li><li><a href="global.html#rp">rp</a></li><li><a href="global.html#rstr2binl">rstr2binl</a></li><li><a href="global.html#rstr2hex">rstr2hex</a></li><li><a href="global.html#rstrHMACMD5">rstrHMACMD5</a></li><li><a href="global.html#rstrMD5">rstrMD5</a></li><li><a href="global.html#safeAdd">safeAdd</a></li><li><a href="global.html#salt">salt</a></li><li><a href="global.html#select2Country">select2Country</a></li><li><a href="global.html#setEventListener">setEventListener</a></li><li><a href="global.html#shuffle">shuffle</a></li><li><a href="global.html#single_tsCompile">single_tsCompile</a></li><li><a href="global.html#socket">socket</a></li><li><a href="global.html#stacktrace">stacktrace</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html#str2rstrUTF8">str2rstrUTF8</a></li><li><a href="global.html#strpad">strpad</a></li><li><a href="global.html#tafocus">tafocus</a></li><li><a href="global.html#textAreas">textAreas</a></li><li><a href="global.html#toogleClass">toogleClass</a></li><li><a href="global.html#trycatch">trycatch</a></li><li><a href="global.html#typescriptCompiler">typescriptCompiler</a></li><li><a href="global.html#uniqid">uniqid</a></li><li><a href="global.html#userJSDecrypt">userJSDecrypt</a></li><li><a href="global.html#userJSEncrypt">userJSEncrypt</a></li><li><a href="global.html#uuidv4">uuidv4</a></li><li><a href="global.html#views">views</a></li><li><a href="global.html#writeFile">writeFile</a></li><li><a href="global.html#writenow">writenow</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>src/compiler/func.ts</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as fs from "fs";
import { exec } from "child_process";
import * as path from "path";
import { dirname } from "path";
import * as Process from "process";
import { localStorage } from "../node-localstorage/index";
//const { promisify } = require("util");
import { promisify } from "util";
import observatory from "../observatory/lib/observatory";
import chalk from "chalk";
import dns from "dns";
import sorter from "./sorter";

require("./consoler");

/**
 * Check connectivity
 */
export function isOffline() {
  var res = null;
  dns.resolve("www.google.com", function (err) {
    if (err) {
      res = true;
    } else {
      res = false;
    }
  });
  return res;
}

/**
 * Locate asset file
 * @param file
 */
export function asset(file: string) {
  file = file.toString().trim().replace(/\.\//gm, "");
  if (fs.existsSync(file)) {
    return file;
  } else if (fs.existsSync(`./${file}`)) {
    return `./${file}`;
  } else if (fs.existsSync(path.join(Process.cwd(), file))) {
    return path.join(Process.cwd(), file);
  }
}

/**
 * Smart read file
 * @param file
 */
export function readFile(file: string) {
  if (fs.existsSync(file)) {
    return fs.readFileSync(file).toString();
  }
  return `${file} not found`;
}

/**
 * write package
 * @param packageObject
 */
export function writenow(packageObject: packagejson) {
  var sorterFound = trycatch(function () {
    return true;
  });

  if (
    packageObject &amp;&amp;
    typeof packageObject == "object" &amp;&amp;
    count(packageObject) > 0
  ) {
    if (sorterFound) {
      fs.writeFileSync(
        path.join(__dirname, "package.json"),
        JSON.stringify(sorter.reorder(packageObject), null, 4),
        { encoding: "utf-8" }
      );
    } else {
      console.log("sorter not found, using default...");
      fs.writeFileSync(
        path.join(__dirname, "package.json"),
        JSON.stringify(packageObject, null, 4),
        { encoding: "utf-8" }
      );
    }
  } else {
    console.warn("not object", typeof packageObject);
  }
}

export function random_hex(familiar?: boolean) {
  if (familiar) {
    var choose = {
      aqua: "#00ffff",
      azure: "#f0ffff",
      beige: "#f5f5dc",
      black: "#000000",
      blue: "#0000ff",
      brown: "#a52a2a",
      cyan: "#00ffff",
      darkblue: "#00008b",
      darkcyan: "#008b8b",
      darkgrey: "#a9a9a9",
      darkgreen: "#006400",
      darkkhaki: "#bdb76b",
      darkmagenta: "#8b008b",
      darkolivegreen: "#556b2f",
      darkorange: "#ff8c00",
      darkorchid: "#9932cc",
      darkred: "#8b0000",
      darksalmon: "#e9967a",
      darkviolet: "#9400d3",
      fuchsia: "#ff00ff",
      gold: "#ffd700",
      green: "#008000",
      indigo: "#4b0082",
      khaki: "#f0e68c",
      lightblue: "#add8e6",
      lightcyan: "#e0ffff",
      lightgreen: "#90ee90",
      lightgrey: "#d3d3d3",
      lightpink: "#ffb6c1",
      lightyellow: "#ffffe0",
      lime: "#00ff00",
      magenta: "#ff00ff",
      maroon: "#800000",
      navy: "#000080",
      olive: "#808000",
      orange: "#ffa500",
      pink: "#ffc0cb",
      purple: "#800080",
      violet: "#800080",
      red: "#ff0000",
      silver: "#c0c0c0",
      white: "#ffffff",
      yellow: "#ffff00",
    };
    var values = Object.values(choose);
    return values[Math.floor(Math.random() * values.length)];
  } else {
    return (
      "#" + (0x1000000 + Math.random() * 0xffffff).toString(16).substr(1, 6)
    );
  }
}

/**
 * Write file recursive
 * @param path
 * @param contents
 * @param cb
 */
export function writeFile(
  path: string | number | Buffer | import("url").URL,
  contents: any,
  cb?: { (arg0: any): any; (err: NodeJS.ErrnoException): void }
) {
  try {
    contents = JSON.parse(contents.toString());
  } catch (error) {}
  if (typeof contents == "object" || Array.isArray(contents)) {
    contents = JSON.stringify(contents, null, 2);
  }
  resolve_dir(dirname(path.toString()));

  if (typeof contents == "string") {
    if (fs.existsSync(dirname(path.toString()))) {
      if (typeof cb == "function") {
        fs.writeFile(path.toString(), contents.toString(), cb);
      } else {
        fs.writeFileSync(path.toString(), contents.toString());
      }
      return true;
    }
  }
  console.error(`contents must be type string, instead of ${typeof contents}`);
  return false;
}

/**
 * Resolve directory, create if not exists
 * @param path
 */
export function resolve_dir(path: string) {
  if (!fs.existsSync(dirname(path.toString()))) {
    resolve_dir(dirname(path.toString()));
  }

  if (!fs.existsSync(path.toString())) {
    fs.mkdirSync(path.toString());
  }
}

/**
 * Random RGB color
 */
export function random_rgba() {
  var o = Math.round,
    r = Math.random,
    s = 255;
  return (
    "rgba(" +
    o(r() * s) +
    "," +
    o(r() * s) +
    "," +
    o(r() * s) +
    "," +
    r().toFixed(1) +
    ")"
  );
}

/**
 * Fix dependencies and devDependencies
 * @param pkg
 */
export async function fixDeps(pkg: packagejson) {
  const ori = pkg;
  if (!pkg.hasOwnProperty("dependencies")) {
    console.error("package.json does not have dependencies");
    throw pkg;
  }
  for (const key in pkg.dependencies) {
    if (pkg.dependencies.hasOwnProperty(key)) {
      const version = pkg.dependencies[key];
      var dups = Object.keys(pkg.devDependencies).includes(key);
      if (dups) {
        console.warn(`${key} duplicate, removing...`);
        delete pkg.dependencies[key];
      }
      if (key.includes("@types")) {
        console.warn(`${key} is typehinting module, moving to dev...`);
        pkg.devDependencies[key] = version;
        delete pkg.dependencies[key];
      }
    }
  }
  if (typeof pkg == "object" &amp;&amp; Object.keys(pkg).length) {
    return pkg;
  }
  return ori;
}

var execute_is_running = false;
var execute_dump = [];

/**
 * Execute command schedule
 * @param cmds
 * @requires NodeJS
 * @param callback
 */
export function execute(
  cmd: string | null,
  callback: (arg0: boolean, arg1: string | Error) => any = null
): any {
  if (typeof cmd != "string") {
    console.log(typeof cmd + " not string");
    return;
  }
  if (execute_is_running === false) {
    execute_is_running = true;
    exec(cmd.trim(), (error, stdout, stderr) => {
      setTimeout(function () {
        execute_is_running = false;
      }, 500);
      if (error instanceof Error) {
        if (error.hasOwnProperty("code")) {
          console.error(error.code);
        } else if (error.hasOwnProperty("message")) {
          console.error(error.message);
        } else {
          console.error(error);
        }
        if (typeof callback == "function") {
          if (stdout) {
            callback(false, new Error(stdout));
          } else if (stderr) {
            callback(false, new Error(stderr));
          } else {
            callback(false, new Error("error"));
          }
        }
        console.error(error);
      } else {
        if (typeof callback != "function") {
          console.log("callback is not function", stdout ? stdout : stderr);
        } else {
          if (stdout) {
            callback(true, stdout);
          } else if (stderr) {
            callback(false, stderr);
          }
        }
      }
    });
  } else {
    if (execute_dump &amp;&amp; !execute_dump.includes(cmd)) {
      console.warn("executor still running, please wait");
      execute_dump.push(cmd);
    }
    setTimeout(function () {
      execute(cmd, callback);
    }, 1000);
  }
}

/**
 * check if module exists
 * @param tmodule
 * @requires node
 */
export function module_exists(
  tmodule: Array&lt;string> | string,
  global: boolean = false,
  dump: boolean = false
) {
  const test = function (tmodule: string, global: boolean) {
    var result = null;
    execute(
      ("npm list -json -depth=0 " + (global ? "-g" : "")).trim(),
      function (error, message) {
        if (message instanceof Error || !error) {
          result = false;
        } else {
          try {
            var json: npmlist = JSON.parse(message);

            result = Object.keys(json.dependencies).includes(tmodule);
            if (dump) {
              console.log(
                `${tmodule} is ${result ? "installed" : "not installed"}`
              );
            }
          } catch (error) {
            result = false;
          }
        }
      }
    );
    return result;
  };
  if (typeof tmodule == "string") {
    return test(tmodule, global);
  }
  var tests = [];
  if (Array.isArray(tmodule)) {
    tmodule.forEach(function (single) {
      tests.push(test(single, global));
    });
    return tests.every(Boolean) ? true : false;
  }
}

/**
 * Configuration builder
 */
export function config_builder() {
  const config = require(asset("./config.json"));
  var parsed = JSON.stringify(parseConfig(config, true), null, 2);

  if (fs.existsSync(asset("./libs"))) {
    console.error("Libs folder not exists, exiting config builder.");
    return null;
  }

  fs.writeFileSync(asset("./config-backup.json"), parsed, {
    encoding: "utf-8",
  });
  var str = fs
    .readFileSync(asset("./libs/src/compiler/config.ts"), {
      encoding: "utf-8",
    })
    .toString()
    .replace(/\s|\t/gm, " ");

  parsed = JSON.stringify(parseConfig(config, false), null, 2)
    .replace(/\"string\"/gm, "string")
    .replace(/\"boolean\"/gm, "boolean")
    .replace(/\"number\"/gm, "number");

  var regex = /config\:((.|\n)*)\=\srequire/gm;
  var mod = str.replace(regex, `config:${parsed} = require`);
  fs.writeFileSync(asset("./libs/src/compiler/config.ts"), mod);

  function parseConfig(
    config: { [key: string]: any },
    usingExclude: boolean = null
  ) {
    const excluded = function (key: string) {
      return ["vscode"].indexOf(key) == -1;
    };
    for (const key in config) {
      if (config.hasOwnProperty(key)) {
        if (!excluded(key) &amp;&amp; usingExclude) {
          continue;
        }
        const element = config[key];
        const type = typeof element;
        if (["number", "string", "boolean"].indexOf(type) != -1) {
          config[key] = type;
        } else if (type == "object") {
          config[key] = parseConfig(config[key]);
        } else if (Array.isArray(config[key])) {
          config[key].forEach(parseConfig);
        }
      }
    }
    return config;
  }
}

/**
 * Remove source sub elements array if exists in target array
 * ```js
 * // If I have this array:
 * var myArray = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
 * // and this one:
 * var toRemove = ['b', 'c', 'g'];
 * console.log(array_remove(myArray, toRemove)); // => ['a', 'd', 'e', 'f']
 * ```
 * @param source
 * @param target
 */
export function array_remove(source: Array&lt;string>, target: Array&lt;string>) {
  return source.filter(function (el) {
    return !target.includes(el);
  });
}

/**
 * Array object counter
 * @param objarr
 */
export function count(objarr: any[] | object) {
  if (Array.isArray(objarr)) {
    return objarr.length;
  } else if (typeof objarr == "object") {
    return Object.keys(objarr).length;
  }
}

/**
 * Do trycatch
 * @param callback
 */
export function trycatch(callback: () => any) {
  try {
    var test = callback();
    if (typeof test == "boolean") {
      return test;
    }
    return true;
  } catch (error) {
    return false;
  }
}

/**
 * Async current function
 * @param callback
 */
export function async(callback: Function) {
  return new Promise(async function (resolve, reject) {
    if (typeof callback == "function") {
      await callback();
      resolve(true);
    } else {
      reject(false);
    }
  });
}

/**
 * Get latest version of packages
 * @param key
 */
export function getLatestVersion(key: string) {
  execute(`npm show ${key} version`, function (error, message) {
    if (message instanceof Error || !error) {
      console.error(error);
    }
    try {
      writeFile(
        `./tmp/npm/packages/${key}/latest.json`,
        JSON.parse(message.toString())
      );
    } catch (error) {}
  });
}

/**
 * Async execute commands
 * @param commands
 * @param callback callback for each command return
 */
export function async_exec(
  commands: string[],
  callback: (stdout: string, stderr: string, isLast: boolean) => any
) {
  if (!Array.isArray(commands)) {
    console.error("commands must be instance of array");
    return null;
  }
  const executor = promisify(exec);
  const exec2 = async function () {
    let script: string;
    let index = 0;
    for await (script of commands) {
      try {
        let { stdout, stderr } = await executor(script);
        if (typeof callback == "function") {
          callback(stdout, stderr, !--commands.length);
        }
      } catch (e) {
        console.error(e);
      }
      index++;
    }
    return true;
  };
  return exec2;
}

localStorage.removeItem("list_package_latest");
localStorage.removeItem("list_package");

/**
 * Get list packages and fetch latest version
 */
export function list_package() {
  if (isOffline()) {
    console.error("Are you offline");
    return;
  }
  if (!localStorage.getItem("list_package")) {
    localStorage.setItem("list_package", "true");
    var global = exec("npm list -json -depth=0 -g");
    global.stdout.on("data", function (data) {
      writeFile("./tmp/npm/global.json", data);
    });
    global.stderr.on("data", function (data) {
      writeFile("./tmp/npm/global-error.json", data);
    });

    var local = exec("npm list -json -depth=0");
    local.stdout.on("data", function (data) {
      try {
        data = JSON.parse(data);
        if (fs.existsSync("./tmp/npm/local.json")) {
          var old = JSON.parse(
            fs.readFileSync("./tmp/npm/local.json").toString()
          );
          if (old) {
            data = Object.assign({}, data, old);
          }
        }
        if (
          data.hasOwnProperty("dependencies") &amp;&amp;
          !localStorage.getItem("list_package_latest")
        ) {
          localStorage.setItem("list_package_latest", "1");
          const executor = promisify(exec);
          const dependencies = Object.keys(data.dependencies);
          const checkLatest = async function () {
            //observatory.settings({ prefix: chalk.cyan("[Buzz] ") });
            var task = observatory.add("Fetch latest version");

            for await (const key of dependencies) {
              if (data.dependencies.hasOwnProperty(key)) {
                try {
                  var { stdout } = await executor(
                    "npm show " + key + " version"
                  );
                  data.dependencies[key].latest = stdout.trim();
                  if (!key.includes("@types")) {
                    var { stdout } = await executor(
                      "npm view @types/" + key + " version -json"
                    );
                    if (stdout.trim().length) {
                      data.dependencies[key].types = {
                        name: "@types/" + key,
                        version: stdout.trim(),
                      };
                    } else {
                      data.dependencies[key].types = {
                        name: null,
                        version: null,
                      };
                    }
                  }
                  writeFile("./tmp/npm/local.json", data);
                  task
                    .status(
                      (
                        (dependencies.length * 100) /
                        Object.keys(data.dependencies).length
                      )
                        .toFixed(3)
                        .toString() + "%"
                    )
                    .details(chalk.hex(random_hex(true)).underline(key));
                } catch (error) {
                  console.error(error);
                }
                if (!--dependencies.length) {
                  localStorage.removeItem("list_package_latest");
                  task.done("Complete");
                }
              }
            }
          };

          checkLatest()
            .catch(function (err) {})
            .then(function () {
              localStorage.removeItem("list_package");
            });
        }
      } catch (error) {}
    });
    local.stderr.on("data", function (data) {
      writeFile("./tmp/npm/local-error.json", data);
    });
  } else {
    console.warn(
      "process for list_package is locked, if previous runner got error, please fix it using `node index.js fix`"
    );
  }
}

/*
results.local = data;
      if (count(results)) {
        for (const key in results.local) {
          if (results.local.hasOwnProperty(key)) {
            const version = results.local[key];
            getLatestVersion(key);
          }
        }
        writeFile("./tmp/npm/installed.json", results);
        timer_run = null;
      }
      */
</code></pre>
        </article>
    </section>




            </div>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>

</body>
</html>
