$(document).ready((function(){setTimeout(()=>{$(".mdb-select").not(".select-wrapper").materialSelect(),$("input,textarea").each((function(i,el){if(!empty($(el).val())){var labels=$(el).closest("div").find("label");labels.length&&(labels.hasClass("active")||labels.addClass("active"))}})),$('[data-toggle="modal"]').each((function(i,el){$(el).attr("data-backdrop")||$(el).attr("data-backdrop","true")}))},2e3)}));function telkomsel(url,method,data,success,failed,complete){currentUID()?AJAX=ajaxRun(url,method,data,success,failed,complete):checkUID((function(uid){AJAX=ajaxRun(url,method,data,success,failed,complete)}))}function telkomsel_batch(url,method,data,success,failed,complete){$.ajax({url:url,method:method.toUpperCase(),data:data,indicator:!0,headers:{"unique-id":getUID()},beforeSend:function(){$("#ajx-stats").attr("class","spinner-border text-primary").addClass("text-primary").fadeIn("slow")},success:function(res){if("object"==typeof res){if(res.hasOwnProperty("error")){var title=res.hasOwnProperty("title")?res.title:"Unknown Title",msg=res.hasOwnProperty("message")?res.message:"Unknown Error";res.error?toastr.error(msg,title):toastr.success(msg,title)}res.hasOwnProperty("unauthorized")&&location.replace("/telkomsel/login")}"function"==typeof success?success(res):"string"==typeof success?call_user_func(success,getWindow(),res):console.log("success isnt callback, instead of "+typeof success)},error:function(res){$("#ajx-stats").attr("class","spinner-border text-primary").addClass("text-danger"),"function"==typeof failed&&failed(res)},complete:function(res){$("#ajx-stats").attr("class","spinner-border text-primary").fadeOut(),AJAX=null,"function"==typeof complete&&complete(res)}})}smartform(),checkUID();var pkgls=$("select#pkgls"),pkgr=$("button#pkg-refresh"),refresh_token=$("button#refresh-token");function buyCheck(pkgid){ajx({url:"/telkomsel/package",method:"POST",data:{"paket-id":pkgid,check:!0}},(function(res){"object"==typeof res&&res.hasOwnProperty("error")&&(res.error||buyAlert(pkgid,res))}))}function buyAlert(pkgid,response){var success;ajx({url:"/telkomsel/profile",data:{balance:!0},method:"POST"},(function(res){var price=framework().rp(response.price,"IDR"),balance=framework().rp(res.balance,"IDR"),expire=res.expiry_date,div=document.createElement("div");div.setAttribute("class","alert alert-warning text-left"),div.innerHTML=`\n    Simcard Balance <b>${balance}</b> Active Until ${expire} <br/>\n    Package Name <b>${response.name} ${price}</b> Quota ${response.quota}`,swal({title:"Warning!",text:"Are you sure to buy this?",closeOnClickOutside:!1,closeOnEsc:!1,dangerMode:!0,buttons:!0,cancel:{text:"Cancel",value:null,visible:!1,className:"",closeModal:!0},confirm:{text:"OK",value:!0,visible:!0,className:"",closeModal:!0},content:div}).then(conf=>{!0===conf&&buy(pkgid)})}))}function buy(pkgid){$.ajax({url:"/telkomsel/package",method:"POST",data:{"paket-id":pkgid,buy:!0},success:function(res){console.log(res)}})}function check_login(success,failed){ajx({url:"/user",method:"POST",data:{check:!0,simcard:!0}},(function(res){console.log("check_login",res),res.error?("function"==typeof failed&&failed(res),refresh_token.prop("disabled",!0)):("function"==typeof success&&success(res),refresh_token.prop("disabled",!1))}))}refresh_token.length&&refresh_token.click((function(e){e.preventDefault(),ajx({url:"/telkomsel/refresh_token",method:"POST"})})),$("button#pkg-buy").length&&$("button#pkg-buy").click((function(e){e.preventDefault();var id=$("select#pkgls").val();id?buyCheck(id):toastr.error("Package not selected, please select one","package info")})),$('[id^="btn-buy-"]').length&&$('[id^="btn-buy-"]').click((function(e){var pkgid;e.preventDefault(),buyCheck($("#PKGInsp").val())}));var table_refresh=null,unique_cookie=null;function get_table_info(){var simcard_info=this.localStorage.getItem("tsel-simcard")||"{}";simcard_info=JSON.parse(simcard_info),console.log("simcard_info",simcard_info),check_login((function(ress){ajx({url:"/telkomsel/profile",method:"post",data:{balance:!0}},(function(res){"object"==typeof res&&(res.hasOwnProperty("balance")&&(simcard_info.balance=res.balance),res.hasOwnProperty("expiry_date")&&(simcard_info.expiry_date=res.expiry_date),res.error||(telkomsel("/telkomsel/profile","post",{puk:!0},(function(res){"object"==typeof res&&res.hasOwnProperty("profiles")&&(simcard_info.puk1=res.profiles.puk1,simcard_info.puk2=res.profiles.puk2)})),telkomsel_batch("/telkomsel/profile","post",{msisdn:!0},(function(res){"object"==typeof res&&res.hasOwnProperty("undefined")&&(simcard_info.msisdn=res.undefined)})),telkomsel_batch("/telkomsel/profile","post",{history:!0},(function(res){})),telkomsel_batch("/telkomsel/profile","post",{me:!0},(function(res){"object"==typeof res&&res.hasOwnProperty("profiles")&&(simcard_info.priceplan=res.profiles.priceplan,simcard_info.cancel_date=res.profiles.cancel_date,simcard_info.brand=res.profiles.brand,simcard_info._=(new Date).getTime(),localStorage.setItem("tsel-simcard",JSON.stringify(simcard_info)),display_simcard_info())})))),table_refresh||setTimeout(()=>{table_refresh=!0,$("#DataPkgs").DataTable().ajax.reload()},3e3)}))}))}function display_simcard_info(){toastr.info("Loading simcard info...","information");var simcard_info=localStorage.getItem("tsel-simcard")||"{}",allowed;simcard_info=JSON.parse(simcard_info),Object.keys(simcard_info).length&&($("#i-puk1").html(simcard_info.puk1),$("#i-puk2").html(simcard_info.puk2),$("#i-msisdn").html(simcard_info.msisdn),$("#i-balances").html(framework().rp(simcard_info.balance,"IDR")),$("#i-expiry").html(simcard_info.expiry_date),$("#i-canceld").html(simcard_info.cancel_date),$("#i-brand").html(simcard_info.brand),$("#i-pp").html(simcard_info.priceplan))}function uniqueCookie(){unique_cookie||get_table_info()}function check_package_callback(res){if(res&&!res.error&&res.hasOwnProperty("data")){var chtml="";for(var key in chtml+='<div class="col-xs-12 m-3"><table class="table table-bordered">',res.data)if(res.data.hasOwnProperty(key)){var value=res.data[key];if(res.data.hasOwnProperty("bonus"))for(var index=0;index<res.data.bonus.length;index++)delete res.data.bonus[index].class,delete res.data.bonus[index].viral,delete res.data.bonus[index].highlight,delete res.data.bonus[index].consumptiontime,delete res.data.bonus[index].subclass;"string"!=typeof value&&(value=`<pre>${JSON.stringify(value,null,4)}</pre>`),chtml+="<tr>",chtml+=`<th>${key=key.toUpperCase()}</th><td>${value}</td>`,chtml+="</tr>"}chtml+="</table></div>",document.getElementById("chk-result").innerHTML=chtml}}check_login(display_simcard_info),$(document).ready((function(){var ids,table;$.fn.dataTable.ext.errMode="none",table=$("#DataPkgs").DataTable({destroy:!0,processing:!0,serverSide:!0,fixedColumns:!0,stateSave:!1,autoWidth:!1,responsive:!0,deferRender:!0,paging:!0,hideEmptyCols:!0,ajax:{url:"/telkomsel/package/datatables",type:"post",data:{term:getUID(),data:""},headers:{Accept:"application/json"},dataSrc:function(res){ids=res.data;var data=res.data;if(!data)return{};console.log(data);var i=data.map((function(buildmap){for(const key in buildmap)if(buildmap.hasOwnProperty(key)){if("name"==key){var pkgn=buildmap[key];""!=buildmap[key]&&buildmap[key]?"Unknown Package Name"==buildmap[key]&&(buildmap[key]=`<b data-pkgname="${buildmap.id}">Unknown Package Name</b>`):buildmap[key]=`<b data-pkgname="${buildmap.id}">Unknown Package Name</b>`,buildmap[key]+=`\n                <div data-quota="${buildmap.id}">\n                <ul>\n                <li>Quota: ${buildmap.quota}</li>\n                <li>Price: ${buildmap.price}</li>\n                </ul>\n                </div>\n                <div class="d-flex justify-content-around">\n                <button id="dtbuy" data-id="${buildmap.id}" data-toggle="tooltip" title="Buy ${pkgn}" class="btn btn-circle btn-danger btn-icon btn-md" data-buy="${buildmap.id}">\n                <i class="fad fa-shopping-cart"></i>\n                </button>\n                <button class="btn btn-info btn-md btn-icon btn-circle" data-check="${buildmap.id}" data-toggle="tooltip" title="Re-check ${pkgn}">\n                <i class="fad fa-eye"></i>\n                </button>\n                </div>\n                `}"desc"==key&&(""!=buildmap[key]&&buildmap[key]||(buildmap[key]="Unknown Package Description"))}}));return res.data},beforeSend:function(){table&&table.settings()[0].jqXHR.abort()}},dataSrc:"data",dataFilter:function(data){var json=jQuery.parseJSON(data);return console.log({dataFilter:json}),json.recordsTotal=json.recordsTotal,json.recordsFiltered=json.recordsFiltered,json.data=json.data,JSON.stringify(json)},lengthMenu:[5,10,15,20,25,30,100,200,300,400,500,"All"],createdRow:function(row,data,index){$(row).attr("data-id",ids[index].id),$(row).find("td:eq(0)").attr("name","Information"),$(row).find("td:eq(1)").attr("name","Description")},columnDefs:[{targets:1,createdCell:function(td,cellData,rowData,row,col){}}],initComplete:function(){var api=this.api()},columns:[{title:"Information",data:"name"},{title:"Description",data:"desc"}],drawCallback:function(settings){var api=this.api()}}),$("#DataPkgs").on("page.dt",(function(){$("html, body").animate({scrollTop:$(".dataTables_wrapper").offset().top},"slow"),$("thead tr th:first-child").focus().blur()})),$(".dataTables_length").addClass("bs-select"),$(document).on("click","[data-check]",(function(e){e.preventDefault();var t,pid=$(this).data("check");console.log("check"),ajaxRun("/telkomsel/package","post",{"paket-id":pid,check:!0},(function(res){if("object"==typeof res&&res.hasOwnProperty("error")){if(!res.error){var quotainfo=$('[data-quota="'+res.id+'"]'),pkgname=$('[data-pkgname="'+res.id+'"]');res.quota&&quotainfo.length&&quotainfo.html(res.quota),res.name&&pkgname.length&&pkgname.html(res.name)}console.log(res)}}))})),$(document).on("click","[data-buy]",(function(e){var pid;e.preventDefault(),buyCheck($(this).data("buy"))})),$(document).on("submit","form",(function(e){e.preventDefault();var data=$(this).serialize(),action=$(this).attr("action"),method=$(this).attr("method");method&&""!=method||(method="POST");var form=$(this),success=form.data("success"),failed=form.data("fail-callback"),complete=form.data("complete-callback");ajx({url:action,method:method,data:data,header:{"unique-id":getUID()}},success,failed,complete)})),$('a[href="#PostAComments"]').one("click",(function(e){e.preventDefault(),load_disqus("dimaslanjaka")})),$.ajax({url:"/server/msisdn",data:{uid:getUID()},success:function(msisdns){$("#NO").mdbAutocomplete({data:msisdns,dataColor:"green",inputFocus:"2px solid green",inputBlur:"1px solid #ced4da",inputFocusShadow:"0 1px 0 0 #4285f4",inputBlurShadow:""})}})}));