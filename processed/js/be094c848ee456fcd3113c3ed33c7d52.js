$(document).ready((function(){setTimeout(()=>{$(".mdb-select").not(".select-wrapper").materialSelect(),$("input,textarea").each((function(i,el){if(!empty($(el).val())){var labels=$(el).closest("div").find("label");labels.length&&(labels.hasClass("active")||labels.addClass("active"))}})),$('[data-toggle="modal"]').each((function(i,el){$(el).attr("data-backdrop")||$(el).attr("data-backdrop","true")}))},2e3)}));var table;function dtreload(){table&&table.ajax.reload()}$(window,document,void 0).ready((function(){framework().captcha.get(),$(document).on("submit","form",(function(e){e.preventDefault();var t=$(this),success=t.data("success");ajx({url:t.attr("action"),method:t.attr("method"),data:t.serialize(),success:function(res){console.log(res)}},success)})),smartform(),$.fn.dataTable.ext.errMode="none",table=$("#listCoupons").DataTable({destroy:!0,processing:!0,serverSide:!0,fixedColumns:!0,stateSave:!1,autoWidth:!1,responsive:!0,deferRender:!0,paging:!0,hideEmptyCols:!0,ajax:{url:"/coupon/manage?list="+guid(),type:"post",data:{term:getUID(),data:""},headers:{Accept:"application/json"},dataSrc:function(res){var data;return ids=res.data,res.data?(res.data.forEach((function(value,index){if(value.hasOwnProperty("limit")){var g=guid();value.limit=`<form data-success="dtreload" method="post" action="/coupon/manage?edit=${g}" class="form-inline">\n                <input type="hidden" name="coupon" value="${value.code}" />\n                <div class="md-form m-0 p-0"><input class="form-control p-0 m-0" type="number" id="limit-${value.code}" name="limit" value="${value.limit}" />\n                <small id="help-${value.code}" class="form-text text-muted">\n                <i class="text-success">${value.success} Success</i> - <i class="text-primary">${value.limit-value.success} Remaining</i>\n                </small></div>\n                <button type="submit" class="btn purple text-white ml-2"><i class="fad fa-save"></i></button>\n                </form>`}})),res.data):{}},beforeSend:function(){table&&table.settings()[0].jqXHR.abort()}},dataSrc:"data",dataFilter:function(data){var json=jQuery.parseJSON(data);return console.log({dataFilter:json}),json.recordsTotal=json.recordsTotal,json.recordsFiltered=json.recordsFiltered,json.data=json.data,JSON.stringify(json)},lengthMenu:[5,10,15,20,25,30,100,200,300,400,500,"All"],createdRow:function(row,data,index){},columnDefs:[{targets:1,createdCell:function(td,cellData,rowData,row,col){}}],initComplete:function(){var api=this.api()},columns:[{title:"Coupon",data:"code"},{title:"Limit",data:"limit"}],drawCallback:function(settings){var api=this.api()}}),$("#listCoupons").on("page.dt",(function(){$("html, body").animate({scrollTop:$(".dataTables_wrapper").offset().top},"slow"),$("thead tr th:first-child").focus().blur()})),$(".dataTables_length").addClass("bs-select"),setTimeout(()=>{$("#ReportLog").DataTable({destroy:!0,dom:"Bfrtip",processing:!1,serverSide:!1,stateSave:!1,autoWidth:!1,responsive:!0,deferRender:!0,paging:!0,lengthMenu:[5,10,15,20,25,30,100,200,300,400,500,"All"],ajax:{url:"/coupon/manage?report",headers:{Accept:"application/json"},method:"POST",data:{captcha:localStorage.getItem("captcha").toString(),data:""},dataSrc:function(res){var data_unprocess=[],data_processed=[];return data_unprocess=Array.isArray(res)?res:[res],console.log(data_unprocess),data_unprocess}},columns:[{title:"MSISDN",data:"msisdn",name:"msisdn"},{title:"Coupon",data:"coupon",name:"coupon"},{title:"Date",data:"date",name:"date"}]})},600)})),$(document).on("focus","form[captcha]",(function(e){var captcha=$(this).find('[name="captcha"]');captcha.length||($(this).append('<input type="hidden" name="captcha" id="'+guid()+'" />'),captcha=$(this).find('[name="captcha"]')),captcha.length&&captcha.val(storage().get("captcha").rot13());var form=captcha.parents("form"),button=form.find('[type="submit"]');form.one("submit",(function(e){e.preventDefault(),console.log("submit"),button.prop("disabled",!0),dimas.captcha.callback=function(){button.prop("disabled",!1)},dimas.captcha.get(),form.off("submit")}))}));