"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var t=0;t<i.length;t++){var a=i[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,i,t){return i&&_defineProperties(e.prototype,i),t&&_defineProperties(e,t),e}var MaterialSelectViewRenderer=function(){function e(i){_classCallCheck(this,e),this.view=i}return _createClass(e,[{key:"destroy",value:function(){var e=this.view.$nativeSelect.data("select-id");this.view.$nativeSelect.data("select-id",null).removeClass("initialized"),this.view.$nativeSelect.parent().find("span.caret").remove(),this.view.$nativeSelect.parent().find("input").remove(),this.view.$nativeSelect.unwrap(),$("ul#select-options-".concat(e)).remove()}},{key:"render",value:function(){this.setWrapperClasses(),this.setMaterialSelectInitialValue(),this.view.$nativeSelect.data("select-id",this.view.properties.id),this.view.$nativeSelect.before(this.view.$selectWrapper),this.appendDropdownIcon(),this.appendMaterialSelect(),this.appendMaterialOptionsList(),this.appendNativeSelect(),this.appendSelectLabel(),this.appendCustomTemplateParts(),this.shouldValidate&&this.appendValidationFeedbackElements(),this.isRequired&&this.enableValidation(),this.isDisabled||(this.setMaterialOptionsListMaxHeight(),this.view.dropdown=this.view.$materialSelect.dropdown({hover:!1,closeOnClick:!1,resetScroll:!1})),this.shouldInheritTabindex&&this.view.$materialSelect.attr("tabindex",this.view.$nativeSelect.attr("tabindex")),this.isDefaultMaterialInput&&this.view.$mainLabel.css("top","-7px"),this.isCustomSelect&&this.view.$materialSelect.css({display:"inline-block",width:"100%",height:"calc(1.5em + .75rem + 2px)",padding:".375rem 1.75rem .375rem .75rem",fontSize:"1rem",lineHeight:"1.5",backgroundColor:"#fff",border:"1px solid #ced4da"}),this.addAccessibilityAttributes(),this.markInitialized()}},{key:"setWrapperClasses",value:function(){this.isDefaultMaterialInput?this.view.$selectWrapper.addClass(this.view.$nativeSelect.attr("class").split(" ").filter((function(e){return"md-form"!==e})).join(" ")).css({marginTop:"1.5rem",marginBottom:"1.5rem"}):this.view.$selectWrapper.addClass(this.view.$nativeSelect.attr("class"))}},{key:"setMaterialSelectInitialValue",value:function(){if(this.view.options.placeholder)this.view.$materialSelect.attr("placeholder",this.view.options.placeholder),this.view.$nativeSelect.find('option[value=""][selected][disabled][data-mdb-placeholder]').length||this.view.$nativeSelect.prepend('<option value="" selected disabled data-mdb-placeholder></option>');else{var e=this.view.$materialSelectInitialOption.replace(/"/g,"&quot;").replace(/  +/g," ").trim();this.view.$materialSelect.val(e)}}},{key:"appendDropdownIcon",value:function(){this.isDisabled&&this.view.$dropdownIcon.addClass("disabled"),this.view.$selectWrapper.append(this.view.$dropdownIcon)}},{key:"appendMaterialSelect",value:function(){this.view.$selectWrapper.append(this.view.$materialSelect)}},{key:"appendMaterialOptionsList",value:function(){this.isSearchable&&this.appendSearchInputOption(),this.isEditable&&this.isSearchable&&this.appendAddOptionBtn(),this.buildMaterialOptions(),this.isMultiple&&this.appendToggleAllCheckbox(),this.view.$selectWrapper.append(this.view.$materialOptionsList)}},{key:"appendNativeSelect",value:function(){this.view.$nativeSelect.appendTo(this.view.$selectWrapper)}},{key:"appendSelectLabel",value:function(){(this.view.$materialSelect.val()||this.view.options.placeholder)&&this.view.$mainLabel.addClass("active"),this.view.$mainLabel[this.isDisabled?"addClass":"removeClass"]("disabled"),this.view.$mainLabel.appendTo(this.view.$selectWrapper)}},{key:"appendCustomTemplateParts",value:function(){var e=this;this.view.$customTemplateParts.each((function(i,t){var a=$(t);a.appendTo(e.view.$materialOptionsList).wrap("<li></li>")})),this.view.$btnSave.appendTo(this.view.$materialOptionsList)}},{key:"appendValidationFeedbackElements",value:function(){this.view.$validFeedback.insertAfter(this.view.$selectWrapper),this.view.$invalidFeedback.insertAfter(this.view.$selectWrapper)}},{key:"enableValidation",value:function(){this.view.$nativeSelect.css({position:"absolute",top:"1rem",left:"0",height:"0",width:"0",opacity:"0",padding:"0","pointer-events":"none"}),-1===this.view.$nativeSelect.attr("style").indexOf("inline!important")&&this.view.$nativeSelect.attr("style","".concat(this.view.$nativeSelect.attr("style")," display: inline!important;")),this.view.$nativeSelect.attr("tabindex",-1),this.view.$nativeSelect.data("inherit-tabindex",!1)}},{key:"setMaterialOptionsListMaxHeight",value:function(){var e=this.view.options.visibleOptions,i=0;this.view.$materialOptionsList.show();var t=this.view.$materialOptionsList.find("li").not(".disabled"),a=t.first().height(),s=t.length;if(this.isSearchable&&(i+=this.view.$searchInput.height()),this.isMultiple&&(i+=this.view.$toggleAll.height()),this.view.$materialOptionsList.hide(),e>=0&&e<s){var l=a*e+i;this.view.$materialOptionsList.css("max-height",l),this.view.$materialSelect.data("maxheight",l)}}},{key:"addAccessibilityAttributes",value:function(){this.view.$materialSelect.attr({role:this.isSearchable?"combobox":"listbox","aria-multiselectable":this.isMultiple,"aria-disabled":this.isDisabled,"aria-required":this.isRequired,"aria-labelledby":this.view.$mainLabel.attr("id"),"aria-haspopup":!0,"aria-expanded":!1}),this.view.$searchInput&&this.view.$searchInput.attr("role","searchbox"),this.view.$materialOptionsList.find("li").each((function(){var e=$(this);e.attr({role:"option","aria-selected":e.hasClass("active"),"aria-disabled":e.hasClass("disabled")})}))}},{key:"markInitialized",value:function(){this.view.$nativeSelect.addClass("initialized")}},{key:"appendSearchInputOption",value:function(){var e=this.view.$nativeSelect.attr("searchable"),i=this.isDefaultMaterialInput?"":"md-form",t=this.isDefaultMaterialInput?"select-default mb-2":"";this.view.$searchInput=$('<span class="search-wrap ml-2"><div class="'.concat(i,' mt-0"><input type="text" class="search w-100 d-block ').concat(t,'" tabindex="-1" placeholder="').concat(e,'"></div></span>')),this.view.$materialOptionsList.append(this.view.$searchInput),this.view.$searchInput.on("click",(function(e){return e.stopPropagation()}))}},{key:"appendAddOptionBtn",value:function(){this.view.$searchInput.append(this.view.$addOptionBtn),this.view.$addOptionBtn.on("click",this.addNewOption.bind(this))}},{key:"buildMaterialOptions",value:function(){var e=this;this.view.$nativeSelectChildren.each((function(i,t){var a=$(t);if(a.is("option"))e.buildSingleOption(a,e.isMultiple?"multiple":"");else if(a.is("optgroup")){var s=$('<li class="optgroup"><span>'.concat(a.attr("label"),"</span></li>"));e.view.$materialOptionsList.append(s);var l=a.children("option");l.each((function(i,t){e.buildSingleOption($(t),"optgroup-option")}))}}))}},{key:"appendToggleAllCheckbox",value:function(){var e=this.view.$materialOptionsList.find("li").first();e.hasClass("disabled")&&e.find("input").prop("disabled")?e.after(this.view.$toggleAll):this.view.$materialOptionsList.find("li").first().before(this.view.$toggleAll)}},{key:"addNewOption",value:function(){var e=this.view.$searchInput.find("input").val(),i=$('<option value="'.concat(e.toLowerCase(),'" selected>').concat(e,"</option>")).prop("selected",!0);this.isMultiple||this.view.$nativeSelectChildren.each((function(e,i){$(i).attr("selected",!1)})),this.view.$nativeSelect.append(i)}},{key:"buildSingleOption",value:function(e,i){var t=e.is(":disabled")?"disabled":"",a=e.is(":selected")?"active":"",s="optgroup-option"===i?"optgroup-option":"",l=e.data("icon"),n=e.data("fas")?'<i class="fa-pull-right m-2 fas fa-'.concat(e.data("fas")," ").concat(this.view.options.fasClasses,'"></i> '):"",r=e.data("far")?'<i class="fa-pull-right m-2 far fa-'.concat(e.data("far")," ").concat(this.view.options.farClasses,'"></i> '):"",o=e.data("fab")?'<i class="fa-pull-right m-2 fab fa-'.concat(e.data("fab")," ").concat(this.view.options.fabClasses,'"></i> '):"",c=e.attr("class"),p=l?'<img alt="" src="'.concat(l,'" class="').concat(c,'">'):"",h=this.isMultiple?'<input type="checkbox" class="form-check-input" '.concat(t,"/><label></label>"):"";this.view.$materialOptionsList.append($('<li class="'.concat(t," ").concat(a," ").concat(s," ").concat(this.view.options.copyClassesOption?c:"",' ">').concat(p,'<span class="filtrable">').concat(h," ").concat(e.html()," ").concat(n," ").concat(r," ").concat(o,"</span></li>")))}},{key:"shouldValidate",get:function(){return this.view.options.validate}},{key:"shouldInheritTabindex",get:function(){return!1!==this.view.$nativeSelect.data("inherit-tabindex")}},{key:"isMultiple",get:function(){return this.view.isMultiple}},{key:"isSearchable",get:function(){return this.view.isSearchable}},{key:"isRequired",get:function(){return this.view.isRequired}},{key:"isEditable",get:function(){return this.view.isEditable}},{key:"isDisabled",get:function(){return this.view.isDisabled}},{key:"isDefaultMaterialInput",get:function(){return this.view.options.defaultMaterialInput}},{key:"isCustomSelect",get:function(){return this.view.$materialSelect.hasClass("custom-select")&&this.view.$materialSelect.hasClass("select-dropdown")}}]),e}();