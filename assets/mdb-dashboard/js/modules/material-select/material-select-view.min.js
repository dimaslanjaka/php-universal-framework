"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var MaterialSelectView=function(){function e(t,i){var{options:l,properties:{id:a}}=i;_classCallCheck(this,e),this.properties={id:a,isMultiple:Boolean(t.attr("multiple")),isSearchable:Boolean(t.attr("searchable")),isRequired:Boolean(t.attr("required")),isEditable:Boolean(t.attr("editable"))},this.options=this._copyOptions(l),this.$nativeSelect=t,this.$selectWrapper=$('<div class="select-wrapper"></div>'),this.$materialOptionsList=$('<ul id="select-options-'.concat(this.properties.id,'" class="dropdown-content select-dropdown w-100 ').concat(this.properties.isMultiple?"multiple-select-dropdown":"",'"></ul>')),this.$materialSelectInitialOption=t.find("option:selected").text()||t.find("option:first").text()||"",this.$nativeSelectChildren=this.$nativeSelect.children("option, optgroup"),this.$materialSelect=$('<input type="text" class="'.concat(this.options.defaultMaterialInput?"browser-default custom-select multi-bs-select select-dropdown form-control":"select-dropdown form-control",'" ').concat(!this.options.validate&&'readonly="true"',' required="').concat(this.options.validate?"true":"false",'" ').concat(this.$nativeSelect.is(" :disabled")?"disabled":"",' data-activates="select-options-').concat(this.properties.id,'" value=""/>')),this.$dropdownIcon=this.options.defaultMaterialInput?"":$('<span class="caret">&#9660;</span>'),this.$searchInput=null,this.$noSearchResultsInfo=$("<li><span><i>".concat(this.options.labels.noSearchResults,"</i></span></li>")),this.$toggleAll=$('<li class="select-toggle-all"><span><input type="checkbox" class="form-check-input"><label>'.concat(this.options.labels.selectAll,"</label></span></li>")),this.$addOptionBtn=$('<i class="select-add-option fas fa-plus"></i>'),this.$mainLabel=this._jQueryFallback(this.$nativeSelect.next("label.mdb-main-label"),$("label[for='".concat(this.properties.id,"']"))),this.$customTemplateParts=this._jQueryFallback(this.$nativeSelect.nextUntil("select",".mdb-select-template-part"),$("[data-mdb-select-template-part-for='".concat(this.properties.id,"']"))),this.$btnSave=this.$nativeSelect.nextUntil("select",".btn-save"),this.$validFeedback=$('<div class="valid-feedback">'.concat(this.options.labels.validFeedback,"</div>")),this.$invalidFeedback=$('<div class="invalid-feedback">'.concat(this.options.labels.invalidFeedback,"</div>")),this.keyCodes={tab:9,esc:27,enter:13,arrowUp:38,arrowDown:40},this.renderer=new MaterialSelectViewRenderer(this),this.dropdown=null}return _createClass(e,[{key:"destroy",value:function(){this.renderer.destroy()}},{key:"render",value:function(){this.renderer.render()}},{key:"selectPreselectedOptions",value:function(e){var t=this;if(this.isMultiple)this.$nativeSelect.find("option:selected:not(:disabled)").each((function(i,l){var a=l.index;t.$materialOptionsList.find("li:not(.optgroup):not(.select-toggle-all)").eq(a).addClass("selected active").find(":checkbox").prop("checked",!0),e(a)}));else{var i=this.$nativeSelect.find("option:selected").first(),l=this.$nativeSelect.find("option").index(i.get(0));i.get(0)&&"disabled"!==i.attr("disabled")&&e(l)}}},{key:"bindMaterialSelectFocus",value:function(){var e=this;this.$materialSelect.on("focus",(function(t){var i=$(t.target);if($("ul.select-dropdown").not(e.$materialOptionsList.get(0)).is(":visible")&&$("input.select-dropdown").trigger("close"),e.$mainLabel.addClass("active"),!e.$materialOptionsList.is(":visible")){i.trigger("open",["focus"]);var l=i.val(),a=e.$materialOptionsList.find("li").filter((function(){return $(this).text().toLowerCase()===l.toLowerCase()})).get(0);e._selectSingleOption(a),e._updateDropdownScrollTop()}e.isMultiple||e.$mainLabel.addClass("active")}))}},{key:"bindMaterialSelectClick",value:function(){var e=this;this.$materialSelect.on("mousedown",(function(e){3===e.which&&e.preventDefault()})),this.$materialSelect.on("click",(function(t){e.$mainLabel.addClass("active"),t.stopPropagation()}))}},{key:"bindMaterialSelectBlur",value:function(){var e=this;this.$materialSelect.on("blur",(function(t){var i=$(t);e.isMultiple||e.isSearchable||i.trigger("close"),e.$materialOptionsList.find("li.selected").removeClass("selected")}))}},{key:"bindMaterialSelectKeydown",value:function(){var e=this;this.$materialSelect.on("keydown",(function(t){var i=$(t.target),l=t.which===e.keyCodes.tab,a=t.which===e.keyCodes.esc,s=t.which===e.keyCodes.enter,n=s&&t.shiftKey,o=t.which===e.keyCodes.arrowUp,r=t.which===e.keyCodes.arrowDown,c=e.$materialOptionsList.is(":visible");if(l)e._handleTabKey(i);else if(!r||c){if(!s||c)switch(t.preventDefault(),!0){case n:return e._handleEnterWithShiftKey(i);case s:return e._handleEnterKey(i);case r||o:return e._handleArrowUpDownKey(t.which);case a:return e._handleEscKey(i);default:return e._handleLetterKey(t)}}else i.trigger("open")}))}},{key:"bindMaterialSelectDropdownToggle",value:function(){var e=this;this.$materialSelect.on("open",(function(){return e.$materialSelect.attr("aria-expanded","true")})),this.$materialSelect.on("close",(function(){return e.$materialSelect.attr("aria-expanded","false")}))}},{key:"bindToggleAllClick",value:function(e){var t=this;this.$toggleAll.on("click",(function(i){var l=$(t.$toggleAll).find('input[type="checkbox"]').first(),a=Boolean($(l).prop("checked")),s=!a;$(l).prop("checked",!a),t.$materialOptionsList.find("li:not(.optgroup):not(.select-toggle-all)").each((function(i,l){var a=$(l),n=a.find('input[type="checkbox"]');a.attr("aria-selected",s),s&&n.is(":checked")||!s&&!n.is(":checked")||$(l).is(":hidden")||$(l).is(".disabled")||(n.prop("checked",s),t.$nativeSelect.find("option").eq(i).prop("selected",s),a.toggleClass("active"),t._selectOption(l),e(i))})),t.$nativeSelect.data("stop-refresh",!0),t._triggerChangeOnNativeSelect(),t.$nativeSelect.removeData("stop-refresh"),i.stopPropagation()}))}},{key:"bindMaterialOptionMousedown",value:function(){var e=this;this.$materialOptionsList.on("mousedown",(function(t){var i=t.target,l=$(".modal-content").find(e.$materialOptionsList).length;l&&i.scrollHeight>i.offsetHeight&&t.preventDefault()}))}},{key:"bindMaterialOptionClick",value:function(e){var t=this;this.$materialOptionsList.find("li:not(.optgroup)").not(this.$toggleAll).each((function(i,l){$(l).on("click",(function(a){a.stopPropagation();var s=$(l);if(!s.hasClass("disabled")&&!s.hasClass("optgroup")){var n=!0;if(t.isMultiple){s.find('input[type="checkbox"]').prop("checked",(function(e,t){return!t}));var o=Boolean(t.$nativeSelect.find("optgroup").length),r=t._isToggleAllPresent()?s.index()-1:s.index();switch(!0){case t.isSearchable&&o:n=e(r-s.prevAll(".optgroup").length-1);break;case t.isSearchable:n=e(r-1);break;case o:n=e(r-s.prevAll(".optgroup").length);break;default:n=e(r);break}t._isToggleAllPresent()&&t._updateToggleAllOption(),t.$materialSelect.trigger("focus")}else t.$materialOptionsList.find("li").removeClass("active").attr("aria-selected","false"),t.$materialSelect.val(s.text().replace(/  +/g," ").trim()),t.$materialSelect.trigger("close");s.toggleClass("active");var c=s.attr("aria-selected");s.attr("aria-selected","true"===c?"false":"true"),t._selectSingleOption(s),t.$nativeSelect.data("stop-refresh",!0),t.$nativeSelect.find("option").eq(i).prop("selected",n),t.$nativeSelect.removeData("stop-refresh"),t._triggerChangeOnNativeSelect(),t.$materialSelect.val()&&t.$mainLabel.addClass("active"),s.hasClass("li-added")&&t.renderer.buildSingleOption(s,"")}}))}))}},{key:"bindSingleMaterialOptionClick",value:function(){var e=this;this.$materialOptionsList.find("li").on("click",(function(){e.$materialSelect.trigger("close")}))}},{key:"bindSearchInputKeyup",value:function(){var e=this;this.$searchInput.find(".search").on("keyup",(function(t){var i=$(t.target),l=t.which===e.keyCodes.tab,a=t.which===e.keyCodes.esc,s=t.which===e.keyCodes.enter,n=s&&t.shiftKey,o=t.which===e.keyCodes.arrowUp,r=t.which===e.keyCodes.arrowDown;if(r||l||a||o)return e.$materialSelect.focus(),void e._handleArrowUpDownKey(t.which);var c=i.closest("ul"),d=i.val(),h=c.find("li span.filtrable"),p=!1;if(h.each((function(){var e=$(this);if("string"===typeof this.outerHTML){var t=this.textContent.toLowerCase();t.includes(d.toLowerCase())?e.show().parent().show():e.hide().parent().hide(),t.trim()===d.toLowerCase()&&(p=!0)}})),s)return e.isEditable&&!p?void e.renderer.addNewOption():(n&&e._handleEnterWithShiftKey(i),void e.$materialSelect.trigger("open"));e.$addOptionBtn[d&&e.isEditable&&!p?"show":"hide"]();var u=0!==h.filter((function(e,t){return $(t).is(":visible")&&!$(t).parent().hasClass("disabled")})).length;u?(e.$toggleAll.show(),e.$materialOptionsList.find(e.$noSearchResultsInfo).remove(),e._updateToggleAllOption()):(e.$toggleAll.hide(),e.$materialOptionsList.append(e.$noSearchResultsInfo)),e.dropdown.updatePosition(e.$materialSelect,e.$materialOptionsList)}))}},{key:"bindHtmlClick",value:function(){var e=this;$("html").on("click",(function(t){$(t.target).closest("#select-options-".concat(e.properties.id)).length||$(t.target).hasClass("mdb-select")||!$("#select-options-".concat(e.properties.id)).hasClass("active")||(e.$materialSelect.trigger("close"),e.$materialSelect.val()||e.options.placeholder||e.$mainLabel.removeClass("active")),e.isSearchable&&null!==e.$searchInput&&e.$materialOptionsList.hasClass("active")&&e.$materialOptionsList.find(".search-wrap input.search").focus()}))}},{key:"bindMobileDevicesMousedown",value:function(){$("select").siblings("input.select-dropdown","input.multi-bs-select").on("mousedown",(function(t){e.isMobileDevice&&(t.clientX>=t.target.clientWidth||t.clientY>=t.target.clientHeight)&&t.preventDefault()}))}},{key:"bindSaveBtnClick",value:function(){var e=this;this.$btnSave.on("click",(function(){e.$materialSelect.trigger("close")}))}},{key:"_isToggleAllPresent",value:function(){return this.$materialOptionsList.find(this.$toggleAll).length}},{key:"_updateToggleAllOption",value:function(){var e=this.$materialOptionsList.find("li").not(".select-toggle-all, .disabled, :hidden").find("[type=checkbox]"),t=e.filter(":checked"),i=this.$toggleAll.find("[type=checkbox]").is(":checked");t.length!==e.length||i?t.length<e.length&&i&&this.$toggleAll.find("[type=checkbox]").prop("checked",!1):this.$toggleAll.find("[type=checkbox]").prop("checked",!0)}},{key:"_handleTabKey",value:function(e){this._handleEscKey(e)}},{key:"_handleEnterWithShiftKey",value:function(e){this.isMultiple?this.$toggleAll.trigger("click"):this._handleEnterKey(e)}},{key:"_handleEnterKey",value:function(e){var t=this.$materialOptionsList.find("li.selected:not(.disabled)");t.trigger("click").addClass("active"),this.isMultiple||e.trigger("close")}},{key:"_handleArrowUpDownKey",value:function(e){var t=this,i=this.$materialOptionsList.find("li:visible").not(".disabled, .select-toggle-all"),l=i.first(),a=i.last(),s=this.$materialOptionsList.find("li.selected").length>0,n=null,o=null,r=e===this.keyCodes.arrowUp;if(r){var c=s?this.$materialOptionsList.find("li.selected").first():a,d=c.prev("li:visible:not(.disabled, .select-toggle-all)");o=d,i.each((function(e,l){$(l).hasClass(t.options.keyboardActiveClass)&&(d=i.eq(e-1),o=i.eq(e))})),n=c.is(l)||!s?c:d}else{var h=s?this.$materialOptionsList.find("li.selected").first():l,p=h.next("li:visible:not(.disabled, .select-toggle-all)");o=p,i.each((function(e,l){$(l).hasClass(t.options.keyboardActiveClass)&&(p=i.eq(e+1),o=i.eq(e))})),n=h.is(a)||!s?h:p}this._selectSingleOption(n),this._removeKeyboardActiveClass(),n.find("input").is(":checked")||n.removeClass(this.options.keyboardActiveClass),o.hasClass("selected")||o.find("input").is(":checked")||!this.isMultiple||o.removeClass("active",this.options.keyboardActiveClass),n.addClass(this.options.keyboardActiveClass),n.position()&&this.$materialOptionsList.scrollTop(this.$materialOptionsList.scrollTop()+n.position().top)}},{key:"_handleEscKey",value:function(e){this._removeKeyboardActiveClass(),e.trigger("close")}},{key:"_handleLetterKey",value:function(e){var t=this;if(this._removeKeyboardActiveClass(),this.isSearchable){var i=e.which>46&&e.which<91,l=e.which>93&&e.which<106,a=8===e.which;(i||l)&&this.$searchInput.find("input").val(e.key).focus(),a&&this.$searchInput.find("input").val("").focus()}else{var s="",n=String.fromCharCode(e.which).toLowerCase(),o=Object.keys(this.keyCodes).map((function(e){return t.keyCodes[e]})),r=n&&-1===o.indexOf(e.which);if(r){s+=n;var c=this.$materialOptionsList.find("li").filter((function(e,t){return $(t).text().toLowerCase().includes(s)})).first();this.isMultiple||this.$materialOptionsList.find("li").removeClass("active"),c.addClass("active"),this._selectSingleOption(c)}}}},{key:"_removeKeyboardActiveClass",value:function(){this.$materialOptionsList.find("li").removeClass(this.options.keyboardActiveClass)}},{key:"_triggerChangeOnNativeSelect",value:function(){var e=new KeyboardEvent("change",{bubbles:!0,cancelable:!0});this.$nativeSelect.get(0).dispatchEvent(e)}},{key:"_selectSingleOption",value:function(e){this.$materialOptionsList.find("li.selected").removeClass("selected"),this._selectOption(e)}},{key:"_updateDropdownScrollTop",value:function(){var e=this.$materialOptionsList.find("li.active").first();e.length?this.$materialOptionsList.scrollTo(e):this.$materialOptionsList.scrollTop(0)}},{key:"_selectOption",value:function(e){var t=$(e);t.addClass("selected")}},{key:"_copyOptions",value:function(e){return $.extend({},e)}},{key:"_jQueryFallback",value:function(){for(var e=null,t=0;t<arguments.length;t++)if(e=t<0||arguments.length<=t?void 0:arguments[t],e.length)return e;return e}},{key:"isMultiple",get:function(){return this.properties.isMultiple}},{key:"isSearchable",get:function(){return this.properties.isSearchable}},{key:"isRequired",get:function(){return this.properties.isRequired}},{key:"isEditable",get:function(){return this.properties.isEditable}},{key:"isDisabled",get:function(){return this.$nativeSelect.is(":disabled")}}],[{key:"isMobileDevice",get:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}]),e}();