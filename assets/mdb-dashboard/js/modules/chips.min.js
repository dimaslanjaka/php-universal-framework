"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(function(e){e(document).on("click",".chip .close",(function(){var t=e(this);t.closest(".chips").data("initialized")||t.closest(".chip").remove()}));var t=function(){function t(i,s){_classCallCheck(this,t),this.chips=i,this.$document=e(document),this.options=s,this.eventsHandled=!1,this.ulWrapper=e('<ul class="chip-ul z-depth-1" tabindex="0"></ul>'),this.defaultOptions={data:[],dataChip:[],placeholder:"",secondaryPlaceholder:""},this.selectors={chips:".chips",chip:".chip",input:"input",delete:".fas",selectedChip:".selected"},this.keyCodes={enter:13,backspace:8,delete:46,arrowLeft:37,arrowRight:39,comma:188},this.init()}return _createClass(t,[{key:"init",value:function(){var t=this;return this.optionsDataStatement(),this.assignOptions(),this.chips.each((function(i,s){var a=e(s);if(!a.data("initialized")){var n=a.data("options");n.data&&Array.isArray(n.data)||(n.data=[]),a.data("chips",n.data),a.data("index",i),a.data("initialized",!0),a.attr("tabindex",0),a.hasClass(t.selectors.chips)||a.addClass("chips"),t.renderChips(a)}})),this.eventsHandled||(this.handleEvents(),this.eventsHandled=!0),this}},{key:"optionsDataStatement",value:function(){return"data"===this.options?this.chips.data("chips"):"options"!==this.options||this.chips.data("options")}},{key:"assignOptions",value:function(){this.chips.data("options",e.extend({},this.defaultOptions,this.options))}},{key:"handleEvents",value:function(){this.handleSelecorChips(),this.handleBlurInput(),this.handleSelectorChip(),this.handleDocumentKeyDown(),this.handleDocumentFocusIn(),this.handleDocumentFocusOut(),this.handleDocumentKeyDownChipsInput(),this.handleDocumentClickChipsDelete(),this.inputKeyDown(),this.renderedLiClick(),this.dynamicInputChanges()}},{key:"handleSelecorChips",value:function(){var t=this;this.$document.on("click",this.selectors.chips,(function(i){return e(i.target).find(t.selectors.input).focus().addClass("active")}))}},{key:"handleBlurInput",value:function(){var t=this;this.$document.on("blur",this.selectors.chips,(function(i){setTimeout((function(){return t.ulWrapper.removeClass("active").hide()}),100),e(i.target).removeClass("active"),e(".chip.selected").removeClass("selected")}))}},{key:"handleSelectorChip",value:function(){this.chips.on("click",".chip",(function(){e(".chip.selected").not(this).removeClass("selected"),e(this).toggleClass("selected")}))}},{key:"handleDocumentKeyDown",value:function(){var e=this;this.chips.on("keydown",(function(t){var i=e.$document.find(e.selectors.chip+e.selectors.selectedChip),s=i.closest(e.selectors.chips),a=i.siblings(e.selectors.chip).length;if(i.length){var n=t.which===e.keyCodes.backspace,c=t.which===e.keyCodes.delete,h=t.which===e.keyCodes.arrowLeft,l=t.which===e.keyCodes.arrowRight;n||c?(t.preventDefault(),e.deleteSelectedChip(s,i,a)):h?e.selectLeftChip(s,i):l&&e.selectRightChip(s,i,a)}}))}},{key:"handleDocumentFocusIn",value:function(){var t,i=this,s=this.chips;t=s.hasClass("chips-autocomplete")?s.children().children("input"):s.children("input"),t.on("click",(function(t){var s=e(t.target);s.closest(i.selectors.chips).addClass("focus"),e(i.selectors.chip).removeClass("selected"),s.addClass("active")}))}},{key:"handleDocumentFocusOut",value:function(){var t=this;this.chips.on("focusout","input",(function(i){return e(i.target).closest(t.selectors.chips).removeClass("focus")}))}},{key:"handleDocumentKeyDownChipsInput",value:function(){var t=this;this.chips.on("keydown","input",(function(i){var s=e(i.target),a=t.chips,n=s.closest(t.selectors.chips),c=n.data("index"),h=n.children(t.selectors.chip).length,l=i.which===t.keyCodes.enter,o=i.which===t.keyCodes.comma,p=i.which===t.keyCodes.arrowLeft,r=i.which===t.keyCodes.backspace;if((l||o)&&!t.ulWrapper.find("li").hasClass("selected"))return i.preventDefault(),t.addChip(c,{tag:s.val()},n),void s.val("");var d=i.keyCode===t.keyCodes.arrowLeft||i.keyCode===t.keyCodes.delete,u=""===s.val();d&&u&&h&&t.selectChip(c,h-1,n),u&&e(t.selectors.input).hasClass("active")?p&&t.selectChip(c,h-1,n):a.find(".chip").removeClass("selected");var f=a.find(".chip-position-wrapper").children(".chip"),C=a.find(".chip-position-wrapper .chip").last().index();!u||!r||f.hasClass("selected")&&a.find(".chip").hasClass("selected")||!a.hasClass("chips")||a.hasClass("chips-initial")||a.hasClass("chips-placeholder")||t.deleteChip(n.data("index"),C,n),u&&r&&!a.find(".chip").hasClass("selected")&&a.hasClass("chips")&&(a.hasClass("chips-initial")||a.hasClass("chips-placeholder"))&&t.deleteChip(n.data("index"),C,n)}))}},{key:"handleDocumentClickChipsDelete",value:function(){var t=this;this.chips.on("click",".chip .fas",(function(i){var s,a=e(i.target),n=a.parent(e(t.chips));n.parents().eq(1).hasClass("chips-autocomplete")?s=n.parents().eq(1):n.parent().hasClass("chips-autocomplete")||n.parents().eq(1).hasClass("chips-autocomplete")?n.parent().hasClass("chips-initial")&&n.parent().hasClass("chips-autocomplete")&&(s=n.parents().eq(0)):s=n.parents().eq(0),t.deleteChip(s.data("index"),n.index(),s),s.find("input").focus()}))}},{key:"inputKeyDown",value:function(){var t=this,i=this.ulWrapper,s=this.options.dataChip,a=this.chips,n=a.children(".chip-position-wrapper").children("input");n.on("keyup",(function(c){var h=n.val();if(i.empty(),h.length)for(var l in s)s[l].toLowerCase().includes(h.toLowerCase())&&a.children(".chip-position-wrapper").append(i.append(e("<li>".concat(s[l],"</li>"))));c.which===t.keyCodes.enter&&(i.empty(),i.remove()),0===h.length?i.removeClass("active").hide():i.addClass("active").show()}))}},{key:"dynamicInputChanges",value:function(){var t=this.options.dataChip;void 0!==t&&this.chips.children(".chip-position-wrapper").children("input").on("change",(function(i){var s=e(i.target).val();t.includes(s)||(t.push(s),t.sort())}))}},{key:"renderedLiClick",value:function(){var t=this;this.chips.on("click","li",(function(i){i.preventDefault();var s=e(i.target),a=s.closest(e(t.selectors.chips)),n=a.data("index");t.addChip(n,{tag:s.text()},a),t.chips.children(".chip-position-wrapper").children("input").val(""),t.ulWrapper.remove()}))}},{key:"deleteSelectedChip",value:function(e,t,i){var s=e.data("index"),a=t.index();this.deleteChip(s,a,e);var n=null;a<i-1?n=a:a!==i&&a!==i-1||(n=i-1),n<0&&(n=null),null!==n&&this.selectChip(s,n,e),i||e.find("input").focus()}},{key:"selectLeftChip",value:function(t,i){var s=i.index()-1;s<0||(e(this.selectors.chip).removeClass("selected"),this.selectChip(t.data("index"),s,t))}},{key:"selectRightChip",value:function(t,i,s){var a=i.index()+1;e(this.selectors.chip).removeClass("selected"),a>s?t.find("input").focus():this.selectChip(t.data("index"),a,t)}},{key:"renderChips",value:function(e){var t=this,i="";e.data("chips").forEach((function(e){i+=t.getSingleChipHtml(e)})),e.hasClass("chips-autocomplete")?i+='<span class="chip-position-wrapper position-relative"><input class="input" placeholder=""></span>':i+='<input class="input" placeholder="">',e.html(i),this.setPlaceholder(e)}},{key:"getSingleChipHtml",value:function(e){if(!e.tag)return"";var t='<div class="chip">'.concat(e.tag);return e.image&&(t+=' <img src="'.concat(e.image,'"> ')),t+='<i class="close fas fa-times"></i>',t+="</div>",t}},{key:"setPlaceholder",value:function(e){var t=e.data("options");e.data("chips").length&&t.placeholder?e.find("input").prop("placeholder",t.placeholder):!e.data("chips").length&&t.secondaryPlaceholder&&e.find("input").prop("placeholder",t.secondaryPlaceholder)}},{key:"isValid",value:function(e,t){for(var i=e.data("chips"),s=0;s<i.length;s++)if(i[s].tag===t.tag)return!1;return""!==t.tag}},{key:"addChip",value:function(t,i,s){if(this.isValid(s,i)){var a=e(this.getSingleChipHtml(i));s.data("chips").push(i),s.hasClass("chips-autocomplete")&&s.hasClass("chips-initial")&&s.find(".chip").length>0?a.insertAfter(s.find(".chip").last()):a.insertBefore(s.find("input")),s.trigger("chip.add",i),this.setPlaceholder(s)}}},{key:"deleteChip",value:function(e,t,i){var s=i.data("chips")[t];i.find(".chip").eq(t).remove(),i.data("chips").splice(t,1),i.trigger("chip.delete",s),this.setPlaceholder(i)}},{key:"selectChip",value:function(e,t,i){var s=i.find(".chip").eq(t);s&&!1===s.hasClass("selected")&&(s.addClass("selected"),i.trigger("chip.select",i.data("chips")[t]))}},{key:"getChipsElement",value:function(e,t){return t.eq(e)}}]),t}();e.fn.materialChip=function(i){return this.each((function(){new t(e(this),i)}))}})(jQuery);