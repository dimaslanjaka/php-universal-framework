(function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):this.Picker=e(jQuery)})((function(e){var t=e(window),n=e(document),o=e(document.documentElement),r=null!=document.documentElement.style.transition;function i(t,o,l,f){if(!t)return i;var m=!1,h={id:t.id||"P"+Math.abs(~~(Math.random()*new Date)),handlingOpen:!1},g=l?e.extend(!0,{},l.defaults,f):f||{},v=e.extend({},i.klasses(),g.klass),y=e(t),_=2,b=function(){return this.start()},$=b.prototype={constructor:b,$node:y,start:function(){return h&&h.start?$:(h.methods={},h.start=!0,h.open=!1,h.type=t.type,t.autofocus=t==p(),t.readOnly=!g.editable,t.id=t.id||h.id,"text"!=t.type&&(t.type="text"),$.component=new l($,g),$.$root=e('<div class="'+v.picker+'" id="'+t.id+'_root" />'),w(),$.$holder=e(k()).appendTo($.$root),C(),g.formatSubmit&&O(),x(),g.containerHidden?e(g.containerHidden).append($._hidden):y.after($._hidden),g.container?e(g.container).append($.$root):y.after($.$root),$.on({start:$.component.onStart,render:$.component.onRender,stop:$.component.onStop,open:$.component.onOpen,close:$.component.onClose,set:$.component.onSet}).on({start:g.onStart,render:g.onRender,stop:g.onStop,open:g.onOpen,close:g.onClose,set:g.onSet}),m=a($.$holder[0]),t.autofocus&&$.open(),$.trigger("start").trigger("render"))},render:function(t){return t?($.$holder=e(k()),C(),$.$root.html($.$holder)):$.$root.find("."+v.box).html($.component.nodes(h.open)),$.trigger("render")},stop:function(){return h.start?($.close(),$._hidden&&$._hidden.parentNode.removeChild($._hidden),$.$root.remove(),y.removeClass(v.input).removeData(o),setTimeout((function(){y.off("."+h.id)}),0),t.type=h.type,t.readOnly=!1,$.trigger("stop"),h.methods={},h.start=!1,$):$},open:function(o){return _++,h.open||_<4&&g.editable?$:(setTimeout((function(){$.$root.addClass(v.opened),s($.$root[0],"hidden",!1)}),0),!1!==o&&(h.open=!0,m&&e("body").css("overflow","hidden").css("padding-right","+="+d()),S(),n.on("click."+h.id+" focusin."+h.id,(function(e){if(!h.handlingOpen){var n=u(e,t);e.isSimulated||n==t||n==document||3==e.which||$.close(n===$.$holder[0])}})).on("keydown."+h.id,(function(n){var o=n.keyCode,r=$.component.key[o],a=u(n,t);27==o?$.close(!0):a!=$.$holder[0]||!r&&13!=o?e.contains($.$root[0],a)&&13==o&&(n.preventDefault(),a.click()):(n.preventDefault(),r?i._.trigger($.component.key.go,$,[i._.trigger(r)]):$.$root.find("."+v.highlighted).hasClass(v.disabled)||($.set("select",$.component.item.highlight),g.closeOnSelect&&$.close(!0)))}))),$.trigger("open"))},close:function(o){return _=0,h.open?(o&&(g.editable?t.click():($.$holder.off("focus.toOpen").focus(),setTimeout((function(){$.$holder.on("focus.toOpen",P)}),0))),y.removeClass(v.active),s(t,"expanded",!1),setTimeout((function(){$.$root.removeClass(v.opened+" "+v.focused),s($.$root[0],"hidden",!0)}),0),m&&e("body").css("overflow","").css("padding-right","-="+d()),document.activeElement.blur(),n.off("."+h.id),h.open=!1,$.trigger("close")):$},clear:function(e){return document.activeElement.blur(),$.set("clear",null,e)},set:function(t,n,o){var r,i,a=e.isPlainObject(t),d=a?t:{};if(o=a&&e.isPlainObject(n)?n:o||{},t){for(r in a||(d[t]=n),d)i=d[r],r in $.component.item&&(void 0===i&&(i=null),$.component.set(r,i,o)),"select"!=r&&"clear"!=r||!g.updateInput||y.val("clear"==r?"":$.get(r,g.format)).trigger("change");$.render()}return o.muted?$:$.trigger("set",d)},get:function(e,n){if(e=e||"value",null!=h[e])return h[e];if("valueSubmit"==e){if($._hidden)return $._hidden.value;e="value"}if("value"==e)return t.value;if(e in $.component.item){if("string"==typeof n){var o=$.component.get(e);return o?i._.trigger($.component.formats.toString,$.component,[n,o]):""}return $.component.get(e)}},on:function(t,n,o){var r,i,a=e.isPlainObject(t),d=a?t:{};if(t)for(r in a||(d[t]=n),d)i=d[r],o&&(r="_"+r),h.methods[r]=h.methods[r]||[],h.methods[r].push(i);return $},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;e<namesCount;e+=1)t=n[e],t in h.methods&&delete h.methods[t];return $},trigger:function(e,t){var n=function(e){var n=h.methods[e];n&&n.map((function(e){i._.trigger(e,$,[t])}))};return n("_"+e),n(e),$}};function k(){return i._.node("div",i._.node("div",i._.node("div",i._.node("div",$.component.nodes(h.open),v.box),v.wrap),v.frame),v.holder,'tabindex="-1"')}function x(){y.data(o,$).addClass(v.input).val(y.data("value")?$.get("select",g.format):t.value).on("focus."+h.id+" click."+h.id,c((function(e){e.preventDefault(),$.open()}),100)).on("mousedown",(function(){h.handlingOpen=!0;var t=function(){setTimeout((function(){e(document).off("mouseup",t),h.handlingOpen=!1}),0)};e(document).on("mouseup",t)})),g.editable||y.on("keydown."+h.id,D),s(t,{haspopup:!0,expanded:!1,readonly:!1,owns:t.id+"_root"})}function w(){s($.$root[0],"hidden",!0)}function C(){$.$holder.on({keydown:D,"focus.toOpen":P,blur:function(){y.removeClass(v.target)},focusin:function(e){$.$root.removeClass(v.focused),e.stopPropagation()},"mousedown click":function(n){var o=u(n,t);o!=$.$holder[0]&&(n.stopPropagation(),"mousedown"!=n.type||e(o).is("input, select, textarea, button, option")||(n.preventDefault(),$.$holder.eq(0).focus()))}}).on("click","[data-pick], [data-nav], [data-clear], [data-close]",(function(){var t=e(this),n=t.data(),o=t.hasClass(v.navDisabled)||t.hasClass(v.disabled),r=p();r=r&&(r.type||r.href?r:null),(o||r&&!e.contains($.$root[0],r))&&$.$holder.eq(0).focus(),!o&&n.nav?$.set("highlight",$.component.item.highlight,{nav:n.nav}):!o&&"pick"in n?($.set("select",n.pick),g.closeOnSelect&&$.close(!0)):n.clear?($.clear(),g.closeOnClear&&$.close(!0)):n.close&&$.close(!0)}))}function O(){var n;!0===g.hiddenName?(n=t.name,t.name=""):(n=["string"==typeof g.hiddenPrefix?g.hiddenPrefix:"","string"==typeof g.hiddenSuffix?g.hiddenSuffix:"_submit"],n=n[0]+t.name+n[1]),$._hidden=e('<input type=hidden name="'+n+'"'+(y.data("value")||t.value?' value="'+$.get("select",g.formatSubmit)+'"':"")+">")[0],y.on("change."+h.id,(function(){$._hidden.value=t.value?$.get("select",g.formatSubmit):""}))}function S(){m&&r?$.$holder.find("."+v.frame).one("transitionend",(function(){$.$holder.eq(0).focus()})):setTimeout((function(){$.$holder.eq(0).focus()}),0)}function P(e){e.stopPropagation(),y.addClass(v.target),$.$root.addClass(v.focused),$.open()}function D(e){var t=e.keyCode,n=/^(8|46)$/.test(t);if(27==t)return $.close(!0),!1;(32==t||n||!h.open&&$.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?$.clear().close():$.open())}return new b}function a(e){var t,n="position";return e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]),"fixed"==t}function d(){if(o.height()<=t.height())return 0;var n=e('<div style="visibility:hidden;width:100px" />').appendTo("body"),r=n[0].offsetWidth;n.css("overflow","scroll");var i=e('<div style="width:100%" />').appendTo(n),a=i[0].offsetWidth;return n.remove(),r-a}function u(e,t){var n=[];return e.path&&(n=e.path),e.originalEvent&&e.originalEvent.path&&(n=e.originalEvent.path),n&&n.length>0?t&&n.indexOf(t)>=0?t:n[0]:e.target}function c(e,t,n){var o;return function(){var r=this,i=arguments,a=function(){o=null,n||e.apply(r,i)},d=n&&!o;clearTimeout(o),o=setTimeout(a,t),d&&e.apply(r,i)}}function s(t,n,o){if(e.isPlainObject(n))for(var r in n)l(t,r,n[r]);else l(t,n,o)}function l(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function f(t,n){for(var o in e.isPlainObject(t)||(t={attribute:n}),n="",t){var r=("role"==o?"":"aria-")+o,i=t[o];n+=null==i?"":r+'="'+t[o]+'"'}return n}function p(){try{return document.activeElement}catch(e){}}return i.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},i._={group:function(e){for(var t,n="",o=i._.trigger(e.min,e);o<=i._.trigger(e.max,e,[o]);o+=e.i)t=i._.trigger(e.item,e,[o]),n+=i._.node(e.node,t[0],t[1],t[2]);return n},node:function(t,n,o,r){return n?(n=e.isArray(n)?n.join(""):n,o=o?' class="'+o+'"':"",r=r?" "+r:"","<"+t+o+r+">"+n+"</"+t+">"):""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0},ariaAttr:f},i.extend=function(t,n){e.fn[t]=function(o,r){var a=this.data(t);return"picker"==o?a:a&&"string"==typeof o?i._.trigger(a[o],a,[r]):this.each((function(){var r=e(this);r.data(t)||new i(this,t,n,o)}))},e.fn[t].defaults=n.defaults},i}));