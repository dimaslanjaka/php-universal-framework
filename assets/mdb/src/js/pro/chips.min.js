jQuery(i=>{i(document).on("click",".chip .close",(function(){const t=i(this);t.closest(".chips").data("initialized")||t.closest(".chip").remove()}));class t{constructor(t,e={}){this.$chipsWrapper=t,this.options="string"===typeof e?e:{data:this.fallback().or(e.data).or([]).value(),dataChip:this.fallback().or(e.dataChip).or([]).value(),placeholder:this.fallback().or(t.attr("data-placeholder")).or(e.placeholder).or("").value(),secondaryPlaceholder:this.fallback().or(t.attr("data-secondary-placeholder")).or(e.secondaryPlaceholder).or("").value(),sortAutocompleteData:this.fallback().or(t.attr("data-sort-autocomplete-data")).or(e.sortAutocompleteData).or(!0).value(),autocompleteDataCompareFn:this.fallback().or(e.autocompleteDataCompareFn).or(void 0).value()},this.$autocompleteList=i('<ul class="chip-ul z-depth-1" tabindex="0"></ul>'),this.keyCodes={backspace:8,enter:13,arrowLeft:37,arrowRight:39,delete:46,comma:188}}get isPublicInterfaceCall(){return"string"===typeof this.options}get isInitialized(){return this.$chipsWrapper.data("initialized")}getSelectedChip(){return this.$chipsWrapper.find(".chip.selected")}returnPublicInterface(){return"data"===this.options?this.$chipsWrapper.data("chips"):"options"===this.options?this.$chipsWrapper.data("options"):this.$chipsWrapper}init(){this.isPublicInterfaceCall||(this.assignOptions(),this.isInitialized||(this.$chipsWrapper.data({chips:this.options.data.slice(),index:this.$chipsWrapper.index(),initialized:!0}),this.$chipsWrapper.attr("tabindex",0),this.$chipsWrapper.hasClass(".chips")||this.$chipsWrapper.addClass("chips"),this.renderChips(),this.bindEvents()))}assignOptions(){Array.isArray(this.options.data)||(this.options.data=[]),this.$chipsWrapper.data("options",Object.assign({},this.options))}bindEvents(){this.bindChipsWrapperClick(),this.bindChipsWrapperBlur(),this.bindSingleChipClick(),this.bindChipsWrapperKeydown(),this.bindChipsInputClick(),this.bindChipsInputFocusout(),this.bindChipsInputKeydown(),this.bindDeleteButtonClick(),this.bindAutocompleteInputKeyup(),this.bindAutocompleteOptionClick()}bindChipsWrapperClick(){this.$chipsWrapper.on("click",t=>i(t.target).find("input").focus().addClass("active"))}bindChipsWrapperBlur(){this.$chipsWrapper.on("blur",t=>{setTimeout(()=>this.$autocompleteList.removeClass("active").hide(),100),i(t.target).removeClass("active"),this.getSelectedChip().removeClass("selected")})}bindSingleChipClick(){this.$chipsWrapper.on("click",".chip",t=>{const e=i(t.target);this.$chipsWrapper.find(".chip.selected").not(e).removeClass("selected"),e.toggleClass("selected")})}bindChipsWrapperKeydown(){this.$chipsWrapper.on("keydown",i=>{const t=i.which===this.keyCodes.backspace,e=i.which===this.keyCodes.delete,s=i.which===this.keyCodes.arrowLeft,p=i.which===this.keyCodes.arrowRight;if((t||e)&&this.getSelectedChip().length){i.preventDefault();const t=this.deleteSelectedChip();this.selectChip(t)}else s?this.selectLeftChip():p&&this.selectRightChip()})}bindChipsInputClick(){const t=this.$chipsWrapper.find("input");t.on("click",t=>{const e=i(t.target);e.addClass("active"),this.$chipsWrapper.addClass("focus"),this.$chipsWrapper.find(".chip").removeClass("selected")})}bindChipsInputFocusout(){this.$chipsWrapper.on("focusout","input",()=>this.$chipsWrapper.removeClass("focus"))}bindChipsInputKeydown(){this.$chipsWrapper.on("keydown","input",t=>{const e=i(t.target),s=t.which===this.keyCodes.enter,p=t.which===this.keyCodes.comma,h=t.which===this.keyCodes.backspace;if((s||p)&&!this.$autocompleteList.find("li").hasClass("selected"))return t.preventDefault(),this.addChip({tag:e.val()}),void e.val("");const a=""===e.val();if(a&&h&&!this.$chipsWrapper.find(".chip").hasClass("selected")){const i=this.$chipsWrapper.find(".chip-position-wrapper .chip").last().index();this.deleteChip(i)}})}bindDeleteButtonClick(){this.$chipsWrapper.on("click",".chip i.close",t=>{const e=i(t.target),s=e.closest(".chip").index();this.deleteChip(s),this.$chipsWrapper.find("input").focus()})}bindAutocompleteInputKeyup(){const t=this.$chipsWrapper.find(".chip-position-wrapper").find("input");t.on("keyup",e=>{const s=t.val();this.$autocompleteList.empty(),s.length?(this.options.dataChip.forEach(t=>{t.toLowerCase().includes(s.toLowerCase())&&this.$chipsWrapper.find(".chip-position-wrapper").append(this.$autocompleteList.append(i(`<li>${t}</li>`)))}),this.$autocompleteList.addClass("active").show()):this.$autocompleteList.removeClass("active").hide();const p=e.which===this.keyCodes.enter,h=e.which===this.keyCodes.comma,a=this.$chipsWrapper.find(".chip-position-wrapper .chip").last().text();!p&&!h||this.options.dataChip.includes(a)?(p||h)&&this.$autocompleteList.remove():(this.options.dataChip.push(a),this.options.sortAutocompleteData&&this.options.dataChip.sort(this.options.autocompleteDataCompareFn))})}bindAutocompleteOptionClick(){this.$chipsWrapper.on("click","li",t=>{t.preventDefault();const e=i(t.target);this.addChip({tag:e.text()}),this.$chipsWrapper.find(".chip-position-wrapper").find("input").val(""),this.$autocompleteList.remove()})}deleteSelectedChip(){const i=this.getSelectedChip(),t=i.siblings(".chip").length,e=i.index();this.deleteChip(e);let s=-1;return e<t-1?s=e:e!==t&&e!==t-1||(s=t-1),t||this.$chipsWrapper.find("input").focus(),s}selectLeftChip(){this.selectLeftRightChip(!0)}selectRightChip(){this.selectLeftRightChip(!1)}selectLeftRightChip(i){const t=this.getSelectedChip(),e=t.index(),s=t.siblings(".chip").length;let p=i?e-1:e+1;if(i&&p<0)p=this.$chipsWrapper.find(".chip").length-1;else if(!i&&p>s)return void this.$chipsWrapper.find("input").focus();this.$chipsWrapper.find(".chip").removeClass("selected"),this.selectChip(p)}renderChips(){let i="";this.$chipsWrapper.data("chips").forEach(t=>{i+=this.getSingleChipTemplate(t)}),this.$chipsWrapper.hasClass("chips-autocomplete")?i+='<span class="chip-position-wrapper position-relative"><input class="input" placeholder=""></span>':i+='<input class="input" placeholder="">',this.$chipsWrapper.html(i),this.setPlaceholder()}getSingleChipTemplate(i){if(!i.tag)return"";let t='<div class="chip">'+i.tag;return i.image&&(t+=` <img src="${i.image}" /> `),t+='<i class="close fas fa-times"></i>',t+="</div>",t}setPlaceholder(){this.$chipsWrapper.find("input").prop("placeholder",this.options.data.length?this.options.placeholder:this.options.secondaryPlaceholder)}addChip(t){if(!this.isValid(t))return;const e=i(this.getSingleChipTemplate(t));this.$chipsWrapper.data("chips").push(t),this.options.data.push(t),this.$chipsWrapper.hasClass("chips-autocomplete")&&this.$chipsWrapper.find(".chip").length>0?e.insertAfter(this.$chipsWrapper.find(".chip").last()):e.insertBefore(this.$chipsWrapper.find("input")),this.$chipsWrapper.trigger("chip.add",t),this.setPlaceholder()}isValid(i){return""!==i.tag&&!this.options.data.some(t=>t.tag===i.tag)}deleteChip(i){const t=this.$chipsWrapper.data("chips")[i];this.$chipsWrapper.find(".chip").eq(i).remove(),this.$chipsWrapper.data("chips").splice(i,1),this.options.data.splice(i,1),this.$chipsWrapper.trigger("chip.delete",t),this.setPlaceholder()}selectChip(i){const t=this.$chipsWrapper.find(".chip").eq(i);t&&!t.hasClass("selected")&&(t.addClass("selected"),this.$chipsWrapper.trigger("chip.select",this.$chipsWrapper.data("chips")[i]))}fallback(){return{_value:void 0,or(i){return"undefined"!==typeof i&&"undefined"===typeof this._value&&(this._value=i),this},value(){return this._value}}}}i.fn.materialChip=function(e){if(this.length>1){const s=[];return this.each((function(){const p=new t(i(this),e);p.init(),s.push(p.returnPublicInterface())})),s}const s=new t(i(this),e);return s.init(),s.returnPublicInterface()}});