function pf_make_url_hashed(e){window.location.hash="#"+e}function assure_closed_menus(){jQuery(".dropdown li > *").on("click",function(){jQuery(".dropdown.open").removeClass("open")})}function trim_words(e,r){return expString=e.split(/\s+/,r),theNewString=expString.join(" "),theNewString}function assure_next_obj(e,r,t){var o=jQuery("article:last-child").attr("tabindex");return(0==r.length||r.is(":hidden"))&&(1==t?e+=1:e-=1,r=jQuery('article[tabindex="'+e+'"]')),(0==r.length||r.is(":hidden"))&&0<=e&&o>e&&(r=assure_next_obj(e,r,t)),!r.is(":hidden")&&r}function modalNavigator(e){e=parseInt(e);var r=jQuery('article[tabindex="'+e+'"]'),t=(jQuery(r).attr("id"),e-1),o=e+1,n=jQuery('article[tabindex="'+t+'"]'),a=jQuery('article[tabindex="'+o+'"]'),i=r.children("header").children("h1").children("a").attr("href");if(n=assure_next_obj(t,n,0),a=assure_next_obj(o,a,1),0!=jQuery(n)&&jQuery(n).is("*")){var l=jQuery(n).children("header").children("h1").children("a").attr("href"),d=jQuery(n).children("header").children("h1").text(),s=jQuery(n).children("header").children("p.source_title").text(),u=jQuery(n).children("header").children("div.feed-item-info-box").children("span.item_authors").text(),c=jQuery(n).children("div.content").children("div.item_excerpt").text(),f='<h5 class="prev_title">Previous: <a href="'+l+'" role="button" class="modal-nav" data-dismiss="modal" data-toggle="modal" data-backdrop="false">'+d+"</a></h5>";f+='<p class="prev_source_title">'+s+"</p>",f+='<p class="prev_author">'+u+"</p>",f+='<p class="prev_excerpt">'+(c=trim_words(c,20))+"</p>",f+='<p class="prev_date">'+jQuery(n).children("footer").children("p.pubdate").text()+"</p>",jQuery(i+" div.modal-body-row div.modal-sidebar div.goPrev").html(f),jQuery(i+" div.mobile-goPrev").html('<i class="icon-arrow-left"></i> <a href="'+l+'" role="button" data-dismiss="modal" class="mobile-modal-navlink modal-nav" data-toggle="modal" data-backdrop="false">'+d+"</a> ")}if(0!=jQuery(a)&&jQuery(a).is("*")){var p=jQuery(a).children("header").children("h1").children("a").attr("href"),m=jQuery(a).children("header").children("h1").text(),h=jQuery(a).children("header").children("p.source_title").text(),y=jQuery(a).children("header").children("div.feed-item-info-box").children("span.item_authors").text(),j=jQuery(a).children("div.content").children("div.item_excerpt").text(),Q='<h5 class="next_title">Next: <a href="'+p+'" role="button" class="modal-nav" data-dismiss="modal" data-toggle="modal" data-backdrop="false">'+m+"</a></h5>";Q+='<p class="next_source_title">'+h+"</p>",Q+='<p class="next_author">'+y+"</p>",Q+='<p class="next_excerpt">'+(j=trim_words(j,20))+"</p>",Q+='<p class="next_date">'+jQuery(a).children("footer").children("p.pubdate").text()+"</p>",jQuery(i+" div.modal-body-row div.modal-sidebar div.goNext").html(Q),jQuery(i+" div.mobile-goNext").html('&nbsp;| <a href="'+p+'" role="button" class="mobile-modal-navlink modal-nav" data-dismiss="modal" data-toggle="modal" data-backdrop="false">'+m+'</a> <i class="icon-arrow-right"></i>')}}function commentPopModal(){jQuery(".pf_container").on("shown",".modal.comment-modal",function(e){var r=jQuery(this),t=r.closest("article"),o=(r.closest("article").attr("id"),t.attr("pf-item-id"),t.attr("pf-post-id"),t.attr("pf-item-post-id"));jQuery("#ef-comments_wrapper").remove(),jQuery.post(ajaxurl,{action:"pf_ajax_get_comments",id_for_comments:o},function(e){jQuery("#comment_modal_"+o+" .modal-body").html(e)})}),jQuery(".pf_container").on("hide",".modal.comment-modal",function(e){jQuery("#ef-comments_wrapper").remove()})}function reshowModal(){jQuery(".pf_container").on("show",".modal.pfmodal",function(e){pf_make_url_hashed(jQuery(this).attr("id"))}),jQuery(".pf_container").on("shown",".modal.pfmodal",function(e){var r=jQuery(this).attr("id");document.body.style.overflow="hidden";jQuery("#"+r+".pfmodal").css({display:"block",position:"fixed",top:"0",right:"0",bottom:"100%",left:"0",margin:"0",width:"100%",height:"100%",overflow:"hidden","z-index":"9999"}).load(hide_non_modals())})}function hide_non_modals(){jQuery("#wpadminbar").hide(),jQuery("#adminmenuback").hide(),jQuery("#adminmenuwrap").hide(),jQuery("#wpfooter").hide()}function reviewModal(){jQuery(".pressforward_page_pf-review .pf_container").on("shown",".modal.pfmodal",function(e){var r=jQuery(this),t=r.attr("id"),o=r.parent().attr("pf-item-post-id");jQuery.post(ajaxurl,{action:"pf_ajax_get_comments",id_for_comments:o},function(e){jQuery("#"+t+".pfmodal .modal-comments").html(e)}),modalNavigator(r.parent().attr("tabindex"))})}function hideModal(){jQuery(".pf_container").on("hide",".modal.pfmodal",function(e){jQuery(".pfmodal .modal-comments").html(""),"function"==typeof editorialCommentReply&&editorialCommentReply.close(),jQuery("#wpadminbar").show(),jQuery("#adminmenuback").show(),jQuery("#adminmenuwrap").show(),jQuery("#wpfooter").show(),document.body.style.overflow="visible",pf_make_url_hashed("ready")})}function commentModal(){jQuery(".pf_container").on("show",".comment-modal",function(e){var r=jQuery(this),t=r.parent("article").attr("id"),o=(r.attr("pf-item-id"),r.attr("pf-post-id"),r.parent().attr("pf-item-post-id"));jQuery.post(ajaxurl,{action:"pf_ajax_get_comments",id_for_comments:o},function(e){jQuery("#"+t+".comment-modal .modal-body").html(e)})})}function PFBootstrapInits(){jQuery(".nom-to-archive").tooltip({placement:"top",trigger:"hover",title:"Item"}),jQuery(".nom-to-draft").tooltip({placement:"top",trigger:"hover",title:"Item"}),jQuery(".nominate-now").tooltip({placement:"top",trigger:"hover",title:"Nominate"}),jQuery(".star-item").tooltip({placement:"top",trigger:"hover",title:"Star"}),jQuery(".itemInfobutton").tooltip({placement:"top",trigger:"hover",title:"Star"}),jQuery(".itemCommentModal").tooltip({placement:"top",trigger:"hover",title:"Comment"}),jQuery(".nom-count").tooltip({placement:"top",trigger:"hover",title:"Nomination Count"}),jQuery(".pf-amplify").tooltip({placement:"top",trigger:"hover",title:"Amplify"}),jQuery(".meta_form_modal-button").tooltip({placement:"top",trigger:"hover",title:"Edit Metadata"}),jQuery(".itemInfobutton").popover({html:!0,title:"",container:".icon-info-sign",content:function(){var e=jQuery(this).attr("data-target"),r='<div class="feed-item-info-box">';return r+=jQuery("#info-box-"+e).html(),r+="</div>",console.log("Popover assembled"),r}}).on("click",function(){jQuery(".popover").addClass(jQuery(this).data("class"))}),jQuery(".modal.pfmodal").on("hide",function(e){jQuery(".itemInfobutton").popover("hide")}),jQuery(".modal.pfmodal").on("show",function(e){jQuery(".itemInfobutton").popover("hide")}),jQuery(".info-box-popover").on("click",function(e){e.stopPropagation()}),jQuery(".itemInfobutton").on("click",function(e){e.stopPropagation()}),jQuery(document).on("click",function(e){jQuery(".itemInfobutton").popover("hide")}),attach_menu_on_scroll_past(),assure_closed_menus()}function attach_menu_on_scroll_past(){jQuery(window).scroll(function(){if(window.pageYOffset>90){jQuery(".pf_container .display").addClass("nav-fix"),jQuery(".pf_container #feed-folders").addClass("right-bar-fix"),jQuery(".pf_container #tools").addClass("right-bar-fix"),jQuery("#fullscreenfeed").appendTo(".display .pf-btns"),jQuery("#feeds-search").insertAfter(".display .pf-btns").addClass("pull-left search-in-bar"),jQuery("#feeds-search > *").addClass("pull-left"),jQuery("#feeds-search > label").hide();var e=jQuery("#entries").innerWidth();jQuery(".nav-fix").width(e-80)}else jQuery(".pf_container .display").removeClass("nav-fix"),jQuery(".pf_container #feed-folders").removeClass("right-bar-fix"),jQuery(".pf_container #tools").removeClass("right-bar-fix"),jQuery("#fullscreenfeed").insertAfter("#h-after"),jQuery("#feeds-search").appendTo("#app-banner").removeClass("pull-left search-in-bar"),jQuery("#feeds-search > *").removeClass("pull-left"),jQuery(".pf_container .display").width("auto")}),jQuery(window).resize(function(){var e=jQuery("#entries").innerWidth();jQuery(".nav-fix").width(e-80),jQuery("#adminmenuback").width()})}function detect_view_change(){jQuery(".pf_container").on("click",".pf-top-menu-selection.display-state",function(e){var r=jQuery(this).attr("id");console.log(r),jQuery.post(ajaxurl,{action:"pf_ajax_retain_display_setting",pf_read_state:r},function(e){})});var e=!1;jQuery(".pressforward #wpbody").on("click",".list .amplify-group .pf-amplify",function(r){var t=jQuery(this),o=t.parents("article"),n=o.height();t.hasClass("amplify-down")?(t.removeClass("amplify-down"),jQuery(o).removeClass("show-overflow"),jQuery(o).css("height","")):(t.addClass("amplify-down"),jQuery(o).addClass("show-overflow"),jQuery(o).height(n),e=!0)}),jQuery(".pressforward #wpbody").on("click",".list div:not(.amplify-group.open)",function(r){var t=jQuery(".amplify-group.open");if(e){var o=t.find(".pf-amplify"),n=o.parents("article");n.height();o.removeClass("amplify-down"),jQuery(n).removeClass("show-overflow"),jQuery(n).css("height","")}}),jQuery(".pressforward #wpbody").on("click",".grid .amplify-group .pf-amplify",function(r){var t=jQuery(this),o=t.parents("article");o.height(),o.find("header");t.hasClass("amplify-down")?o.removeClass("amplify-down"):(o.addClass("amplify-down"),e=!0)}),jQuery(".pressforward #wpbody").on("click",".grid div:not(.amplify-group.open)",function(r){var t=jQuery(".amplify-group.open");if(e){var o=t.find(".pf-amplify").parents("article");o.height();o.removeClass("amplify-down")}})}function removeURLParameter(e,r){var t=e.split("?");if(t.length>=2){for(var o=encodeURIComponent(r)+"=",n=t[1].split(/[&;]/g),a=n.length;a-- >0;)-1!==n[a].lastIndexOf(o,0)&&n.splice(a,1);return e=t[0]+"?"+n.join("&")}return e}console.log("Waiting for load."),jQuery(window).load(function(){jQuery(".pf-loader").delay(300).fadeOut("slow",function(){if(console.log("Load complete."),jQuery(".pf_container").fadeIn("slow"),window.location.hash.indexOf("#")<0)window.location.hash="#ready";else if(window.location.hash.toLowerCase().indexOf("modal")>=0){var e=window.location.hash;jQuery(e).hasClass("in")||jQuery(e).modal("show")}jQuery(window).on("hashchange",function(){if("#ready"==window.location.hash&&jQuery(".modal").modal("hide"),window.location.hash.toLowerCase().indexOf("modal")>=0){var e=window.location.hash;jQuery(e).hasClass("in")||jQuery(e).modal("show")}})})}),jQuery(window).load(function(){if(jQuery("#gogrid").click(function(e){e.preventDefault(),jQuery("div.pf_container").removeClass("list").addClass("grid"),jQuery("#gogrid").addClass("unset"),jQuery("#golist").removeClass("unset"),jQuery(".feed-item").each(function(e){var r=jQuery(this).attr("id");jQuery("#"+r+" footer .actions").appendTo("#"+r+" header")})}),jQuery("#golist").click(function(e){e.preventDefault(),jQuery("div.pf_container").removeClass("grid").addClass("list"),jQuery("#golist").addClass("unset"),jQuery("#gogrid").removeClass("unset"),jQuery(".feed-item").each(function(e){var r=jQuery(this).attr("id");jQuery("#"+r+" header .actions").appendTo("#"+r+" footer")})}),jQuery("#gomenu").click(function(e){e.preventDefault(),jQuery("#feed-folders").hide("slide",{direction:"right",easing:"linear"},150)}),jQuery("#gomenu").click(function(e){pf.toggler(e,this,function(e){var r=jQuery("#tools");jQuery("div.pf_container").removeClass("full"),jQuery("#feed-folders").hide("slide",{direction:"right",easing:"linear"},150),jQuery(r).show("slide",{direction:"right",easing:"linear"},150)},function(){var e=jQuery("#tools");jQuery(e).hide("slide",{direction:"right",easing:"linear"},150),jQuery("div.pf_container").addClass("full")})}),jQuery("#gofolders").click(function(e){e.preventDefault(),jQuery("#tools").hide("slide",{direction:"right",easing:"linear"},150)}),jQuery("#gofolders").click(function(e){pf.toggler(e,this,function(e){var r=jQuery("#feed-folders");jQuery("div.pf_container").removeClass("full"),jQuery(r).show("slide",{direction:"right",easing:"linear"},150)},function(){var e=jQuery("#feed-folders");jQuery(e).hide("slide",{direction:"right",easing:"linear"},150),jQuery("div.pf_container").addClass("full")})}),jQuery("#feed-folders .folder").click(function(e){e.preventDefault();var r=jQuery(this).attr("href"),t=window.location.href;(t=removeURLParameter(t=removeURLParameter(t=removeURLParameter(t=t.replace("#","&"),"folder"),"feed"),"ready")).indexOf("?")>-1?t+="&folder="+r:t+="?folder="+r,window.location.href=t}),jQuery("#feed-folders .feed").click(function(e){e.preventDefault();var r=jQuery(this).children("a").attr("href"),t=window.location.href;(t=removeURLParameter(t=removeURLParameter(t=removeURLParameter(t=t.replace("#","&"),"folder"),"feed"),"ready")).indexOf("?")>-1?t+="&feed="+r:t+="?feed="+r,window.location.href=t}),jQuery(".scroll-toggler").click(function(e){e.preventDefault();var r=jQuery(this).attr("id"),t="true";console.log(r),"gopaged"==r&&(t="false"),jQuery.post(ajaxurl,{action:"pf_ajax_user_setting",pf_user_setting:"pf_user_scroll_switch",setting:t},function(e){"1"!=html_entity_decode(jQuery(e).find("response_data").text())?alert("PressForward has lost its connection to your server. Reload page and try again."):location.reload()})}),jQuery("#deletefeedarchive").click(function(e){e.preventDefault(),jQuery(".loading-top").show(),jQuery.post(ajaxurl,{action:"reset_feed"},function(e){jQuery(".loading-top").hide(),jQuery("#errors").html(e)})}),0!=jQuery(".list").length){var e=jQuery(".list article");jQuery.each(e,function(e,r){var t=jQuery(this).attr("id");jQuery("#"+t+" header .actions").appendTo("#"+t+" footer")})}jQuery(".pf_container").on("click","#showMyNominations",function(e){e.preventDefault(),window.open("?page=pf-menu&by=nominated","_self")}),jQuery(".pf_container").on("click","#showMyHidden",function(e){e.preventDefault(),window.open("?page=pf-menu&reveal=no_hidden","_self")}),jQuery(".pf_container").on("click","#showUnread",function(e){e.preventDefault(),window.open("?page=pf-menu&reveal=unread","_self")}),jQuery(".pf_container.pf-all-content").on("click","#showDrafted",function(e){e.preventDefault(),window.open("?page=pf-menu&reveal=drafted","_self")}),jQuery(".pf_container").on("click","#showMyStarred",function(e){e.preventDefault(),window.open("?page=pf-menu&by=starred","_self")}),jQuery(".pf_container").on("click","#showNormal",function(e){e.preventDefault(),window.open("?page=pf-menu","_self")}),jQuery(".pf_container").on("click","#showNormalNominations",function(e){e.preventDefault(),window.open("?page=pf-review","_self")}),jQuery(".pf_container").on("click",".remove-nom-this-prompt",function(e){e.preventDefault(),jQuery("article.nominate-this-preview").remove(),jQuery.post(ajaxurl,{action:"pf_ajax_user_setting",pf_user_setting:"have_you_seen_nominate_this",setting:"yes"},function(e){html_entity_decode(jQuery(e).find("response_data").text())}),jQuery(this).is("[href]")&&window.open("?page=pf-tools","_self")}),reshowModal(),reviewModal(),hideModal(),commentPopModal(),PFBootstrapInits(),detect_view_change()});