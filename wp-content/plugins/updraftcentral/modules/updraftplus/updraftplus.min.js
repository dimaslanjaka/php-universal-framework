function UpdraftCentral_UpdraftPlus_Module(){var g=jQuery,t=".updraftcentral_row_extracontents .updraft_site_settings_output ",o="#updraftcentral_dashboard_existingsites "+t,l={};function d(t){var e=t.find(".updraftcentral_row_extracontents button.updraft_download_button"),a=[];e.wrapAll(function(){var t=g(this).closest("tr").data("key");return-1===g.inArray(t,a)&&(a.push(t),g(this).parent().prepend('<a class="show-backup-data" data-key="'+t+'"><span class="dashicons dashicons-arrow-right"></span> '+udclion.updraftplus.select_backup_data+"</a>")),'<span class="backup-data-'+t+' hide-backup-data"></span>'}),UpdraftCentral.register_event_handler("click","a.show-backup-data",function(){var t=g(this).data("key");g(this).find("span.dashicons").toggleClass("dashicons-arrow-right dashicons-arrow-down"),g(this).parent().find(".backup-label-container-"+t).toggleClass("hide-backup-data"),g(this).parent().find(".backup-data-"+t).toggleClass("hide-backup-data")});var r,n,d,s,i,u=t.find(".updraftcentral_row_extracontents div.backup_date_label");(u.length||(t.find(".updraftcentral_row_extracontents td.updraft_existingbackup_date").each(function(){g(this).wrapInner('<div class="backup_date_label"></div>')}),u=t.find(".updraftcentral_row_extracontents div.backup_date_label")),u.length)&&(u.prepend('<div class="delete-backup-container"><input type="checkbox" class="delete_backup_item" name="delete_backup" value="1" /></div>'),t.find(".updraftcentral_row_extracontents div.updraft_existing_backups").append('<button id="btn-backup-bulk-delete" class="btn btn-secondary">'+udclion.updraftplus.delete_selected+"</button>"));$table=(r="storage",n=!0,d=t.find(".updraftcentral_row_extracontents table.existing-backups-table"),s=d.find("thead th.backup-date"),i=d.find("tbody td.updraft_existingbackup_date"),void 0!==n&&n&&i.next("td").attr("class","updraft_existingbackup_data"),g('<th class="backup-'+r+'">'+udclion.updraftplus.backup+" "+r+"</th>").insertAfter(s),g('<td class="updraft_existingbackup_'+r+'"></td>').insertAfter(i),d),$table.find("tr.updraft_existing_backups_row").each(function(){var t=g(this);t.find(".backup_date_label img.stored_icon").each(function(){g(this).appendTo(t.find("td.updraft_existingbackup_storage"))})}),t.find(".updraftcentral_row_extracontents table.existing-backups-table").find("tr.updraft_existing_backups_row").each(function(){var t=g(this),e=t.find("td.updraft_existingbackup_data a.show-backup-data"),a="backup-label-container-"+e.data("key");g('<div class="'+a+' hide-backup-data"></div>').insertAfter(e),t.find(".backup_date_label br").wrap("<span></span>"),t.find(".backup_date_label .clear-right ~ span").appendTo(t.find("div."+a))})}UpdraftCentral.register_listener_processor("updraftplus_backup",function(t,e,a){if(0<g(t).find(".updraft_finished").length)return 1<UpdraftCentral.get_debug_level()&&console.log("UDCentral: UpdraftPlus backup listener: job finished"),0;var r=g(t).data("job_id");return l.hasOwnProperty(r)||(l[r]=0),l[r]++,l[r]<30||0==l[r]%3?{call:"updraftplus.backup_progress",data:{job_id:r}}:null}),UpdraftCentral.register_listener_processor("updraftplus.backup_progress",function(t,e,a,r){var n="";r.hasOwnProperty("l")&&(n+="<strong>"+udclion.updraftplus.lastlogline+":</strong> "+r.l+"<br>"),r.hasOwnProperty("j")&&(n+=r.j),g(t).find(".backup_state:first").html(UpdraftCentral_Library.sanitize_html(n));var d="<div class='text-center' id='info"+a+"'>"+("undefined"===jQuery.type(g(t).find(".updraft_percentage").data("info"))?udclion.updraftplus.missing_data_attributes:UpdraftCentral_Library.sanitize_html(g(t).find(".updraft_percentage").data("info")))+"</div>";d+="<progress class='progress progress-updraftcentral' value='"+("undefined"===jQuery.type(g(t).find(".updraft_percentage").data("progress"))?"0":UpdraftCentral_Library.quote_attribute(g(t).find(".updraft_percentage").data("progress")))+"' max='100' ></progress>",g(t).find(".curstage").html(d)}),UpdraftCentral.register_listener_processor("updraftplus_download",function(t,e,d){var s=[],i=null;return g(t).find(".updraftplus_downloader").each(function(t,e){g(e).data("updraft_finished")?null===i&&(i=!0):i=!1;var a=g(e).data("findex"),r=g(e).data("what"),n=g(e).data("backup_timestamp");s.push(d+","+n+","+r+","+a)}),i?(console.log("UDCentral: UpdraftPlus download listener: job finished - will not poll any more"),1):{call:"updraftplus.get_download_status",data:s}}),UpdraftCentral.register_listener_processor("updraftplus.get_download_status",function(t,e,a,r){g.each(r,function(t,e){e.hasOwnProperty("base")&&function(t){var e=t.base,a=(t.f,t.findex),r=(t.m,t.hasOwnProperty("p")&&t.p,t.s,t.t,t.timestamp),n=t.what,d=e+"_"+r+"_"+n+"_"+a,s="#updraftcentral_notice_container ."+d;if(t.hasOwnProperty("failed")&&t.failed&&g(s).data("updraft_finished",!0),t.hasOwnProperty("e")&&t.e)g(s+" .raw").html("<strong>"+udclion.error+":</strong> "+t.e),console.log("UDCentral: UpdraftPlus: downloader ("+d+"): an error was returned (follows)"),console.log(t);else if(null!==t.p){if(g(s+"_st .dlfileprogress").width(t.p+"%"),null!=t.a&&0<t.a){var i=(new Date).getTime()-g(s).data("last_time_began");if(90<t.a&&6e4<i){console.log("UDCentral: UpdraftPlus: "+d+": restarting download: file_age="+t.a+", since_last_restart_ms="+i);var u={type:n,timestamp:r,findex:a},o=g('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+e+'"');g(s).data("last_time_began",(new Date).getTime()),UpdraftCentral.send_site_rpc("updraftplus.downloader",u,o,function(t,e,a){"ok"!=e&&(g(s+" .raw").html(udclion.updraftplus.backup_start_failed),console.log("code="+e+", error_code="+a),console.log(t))})}}t.hasOwnProperty("m")&&null!=t.m&&(t.p<100?g(s+" .raw").html(t.m):(msg=template_replace("updraftplus-downloaded",{file_ready:udclion.updraftplus.file_ready,download_to_computer:udclion.updraftplus.download_to_computer,and_then:udclion.updraftplus.and_then,you_should:udclion.updraftplus.you_should,backup_timestamp:r,site_id:e,what:n,findex:a,delete_from_server:udclion.updraftplus.delete_from_server}),g(s).data("updraft_finished",!0),g(s+" .raw").html(msg)))}else null!=t.m?g(s+" .raw").html(t.m):(g(s+" .raw").html(udclion.updraftplus.backup_start_failed),1)}(e)})}),this.backupnow_go=function(t,e,a,r,n,d,s){var i;n&&n.hasOwnProperty("_listener_title")&&(i=n._listener_title,delete n._listener_title);var u={backupnow_nodb:t,backupnow_nofiles:e,backupnow_nocloud:a,backupnow_label:d,extradata:n};""!=r&&(u.onlythisfileentity=r),""!=s&&(u.onlythesetableentities=s),u.always_keep=void 0!==n.always_keep?n.always_keep:0,u.incremental=void 0!==n.incremental?n.incremental:0,UpdraftCentral.send_site_rpc("updraftplus.backupnow",u,UpdraftCentral.$site_row,function(t,e,a){if("ok"==e&&!1!==t&&t.hasOwnProperty("data"))if(t.data.hasOwnProperty("nonce")){var r='<div class="backup_state">'+udclion.updraftplus.backupstarted+"</div>",n=t.data.nonce;l[n]=0,UpdraftCentral.create_dashboard_listener("updraftplus_backup",UpdraftCentral.$site_row,r,{job_id:t.data.nonce},i)}else UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.backup_start_failed,"error")})};var f=0,h=0;function s(c){c.find(".updraftcentral_row_extracontents").css("opacity","0.3"),UpdraftCentral.send_site_rpc("updraftplus.get_settings",{include_database_decrypter:0,include_adverts:0,include_save_button:1},c,function(n,t,e){if(c.find(".updraftcentral_row_extracontents").css("opacity","1.0"),"ok"==t&&n){if(c.find(".updraftcentral_row_extracontents").html('<div class="updraft_site_settings_output"><div class="dashicons dashicons-image-rotate updraftcentral_site_backup_settings"></div>'+UpdraftCentral_Library.sanitize_html(n.data.settings)+"</div>"),n.data.hasOwnProperty("remote_storage_templates")&&n.data.hasOwnProperty("remote_storage_options")){var a="";for(var r in n.data.remote_storage_templates)if(void 0!==n.data.remote_storage_options[r]){var d=Handlebars.compile(n.data.remote_storage_templates[r]),s=!0;for(var i in n.data.remote_storage_options[r])if("default"!==i){var u=n.data.remote_storage_options[r][i];u.first_instance=s,void 0===u.instance_enabled&&(u.instance_enabled=1),a+=d(u),s=!1}}else a+=n.data.remote_storage_templates[r];g("#remote-storage-holder").append(a)}function o(t){var e=Handlebars.compile(n.data.remote_storage_templates[t]),a=n.data.remote_storage_options[t].default;a.instance_id="s-"+function(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}(32),a.instance_enabled=1;var r=e(a);g(r).hide().insertAfter("."+t+"_add_instance_container:first").show("slow")}if(g(".updraftcentral_row_extracontents #remote-storage-holder").on("click",".updraftplusmethod a.updraft_add_instance",function(t){t.preventDefault(),o(g(this).data("method"))}),g(".updraftcentral_row_extracontents #remote-storage-holder").on("click",".updraftplusmethod a.updraft_delete_instance",function(t){t.preventDefault();var e=g(this).data("method"),a=g(this).data("instance_id");1===g("."+e+"_updraft_remote_storage_border").length&&o(e),g("."+e+"-"+a).hide("slow",function(){g(this).remove()})}),g(".updraftcentral_row_extracontents #remote-storage-holder").on("change","input[class='updraft_instance_toggle']",function(){g(this).is(":checked")?g(this).siblings("label").html(udclion.updraftplus.instance_enabled):g(this).siblings("label").html(udclion.updraftplus.instance_disabled)}),c.find('.updraftcentral_row_extracontents #remote-storage-container > input[type="checkbox"]').each(function(){var t=jQuery(this);t.attr("aria-label",udclion.updraftplus.backup_using+" "+t.val()+"?")}),w(),function(){O=0;var r=g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox:checked");g(r).each(function(t,e){var a=g(e).val();"updraft_servicecheckbox_none"!=g(e).attr("id")&&O++,g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+a).show(),t==g(r).length-1&&P(a)}),0<O?g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").hide():(g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod:not(.none)").hide(),g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").show());var t=g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox");"function"==typeof t.labelauty&&t.labelauty()}(),f=b=0,n.data.hasOwnProperty("meta")){var l=n.data.meta;l.hasOwnProperty("retain_rules")&&l.retain_rules.hasOwnProperty("files")&&(_=l.retain_rules.files,p=l.retain_rules.db,v=k=0,g.each(_,function(t,e){x("files",e.after_howmany,e.after_period,e.every_howmany,e.every_period)}),g.each(p,function(t,e){x("db",e.after_howmany,e.after_period,e.every_howmany,e.every_period)})),l.hasOwnProperty("extra_dbs")&&g.each(l.extra_dbs,function(t,e){e.hasOwnProperty("host")&&m(e.host,e.user,e.name,e.pass,e.prefix)})}n.data.hasOwnProperty("updraftplus_version")&&(h=n.data.updraftplus_version),U("uploads"),U("others"),U("wpcore"),C=g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_reportbox").length+2,g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths input.updraft_include_more_path").each(function(t,e){var a=g(e).data(a);f<a&&(f=a)}),g('#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output input[type="submit"]').removeClass().addClass("btn btn-primary-outline"),g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output").on("change keyup paste",".updraft_webdav_settings",function(){var n=[],d="";g(".updraft_webdav_settings").each(function(t,e){var a=g(e).attr("id");if(a&&"updraft_webdav_settings_"==a.substring(0,24)){var r=a.substring(24);n[r]=this.value}else if(a&&"updraft_webdav_"==a.substring(0,15)){r=a.substring(15);id_split=r.split("_"),r=id_split[0],d=id_split[1],void 0===n[d]&&(n[d]=[]),n[d][r]=this.value}});var t="",e="@",a="/",r=":",s=":";for(var d in n)(0<=n[d].host.indexOf("@")||""===n[d].host)&&(e=""),0<=n[d].host.indexOf("/")?g("#updraft_webdav_host_error").show():g("#updraft_webdav_host_error").hide(),0!=n[d].path.indexOf("/")&&""!==n[d].path||(a=""),""!==n[d].user&&""!==n[d].pass||(r=""),""!==n[d].host&&""!==n[d].port||(s=""),t=n[d].webdav+n[d].user+r+n[d].pass+e+encodeURIComponent(n[d].host)+s+n[d].port+a+n[d].path,masked_webdav_url=n[d].webdav+n[d].user+r+n[d].pass.replace(/./gi,"*")+e+encodeURIComponent(n[d].host)+s+n[d].port+a+n[d].path,""==d?g("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_settings_url").val(t):(g("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_url_"+d).val(t),g("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_masked_url_"+d).val(masked_webdav_url))})}var _,p})}var b=0;function m(t,e,a,r,n){b++,g(template_replace("updraftplus-settings-extra-db",{updraft_extra_dbs:b,remove:udclion.updraftplus.remove,backup_external_database:udclion.updraftplus.backup_external_database,host:udclion.updraftplus.host,database:udclion.updraftplus.database,username:udclion.updraftplus.username,password:udclion.updraftplus.password,table_prefix:udclion.updraftplus.table_prefix,backup_tables_with_prefixes:udclion.updraftplus.backup_tables_with_prefixes,test_connection:udclion.updraftplus.test_connection},{host_attr:t,user_attr:e,name_attr:a,pass_attr:r,prefix_attr:n})).appendTo(g("#updraft_backupextradbs")).fadeIn()}function a(){UpdraftCentral.register_row_clicker(".row_backupnow, .updraftcentral_site_backup_now",function(t){e(t,"new")}),UpdraftCentral.register_row_clicker(".row_backupnow, .updraftcentral_site_backup_now_increment",function(t){e(t,"incremental")}),UpdraftCentral.register_modal_listener("#backupnow_includefiles_showmoreoptions",function(t){t.preventDefault(),g("#updraftcentral_modal #backupnow_includefiles_moreoptions").slideToggle()}),UpdraftCentral.register_modal_listener("#backupnow_database_showmoreoptions",function(t){t.preventDefault(),g("#updraftcentral_modal #backupnow_database_moreoptions").slideToggle()})}function i(r){r.find(".updraftcentral_row_extracontents").css("opacity","0.3");var t=navigator.userAgent.match(/Opera|OPR\//)?1:0;UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"panel_download_and_restore",data:{include_opera_warning:t,include_uploader:0,will_immediately_calculate_disk_space:0,include_header:1}},r,function(t,e,a){r.find(".updraftcentral_row_extracontents").css("opacity","1.0"),"ok"==e&&t&&(r.find(".updraftcentral_row_extracontents").html('<div class="updraft_existing_backups_output"><div class="dashicons dashicons-image-rotate updraftcentral_site_backups_manage" style="float:right;"></div>'+UpdraftCentral_Library.sanitize_html(t.data.output)+"</div>"),d(r))})}function e(t,u){UpdraftCentral.send_site_rpc("updraftplus.get_fragment","backupnow_modal_contents",t,function(t,e,a){if("ok"==e&&t){var r,n=!(t.data.output.hasOwnProperty("error")&&t.data.output.error)&&udclion.updraftplus.backupnow,d=!1;t.data.output.hasOwnProperty("backupnow_file_entities")&&(r=t.data.output.backupnow_file_entities),t.data.output.hasOwnProperty("incremental_installed")&&(d=t.data.output.incremental_installed),UpdraftCentral.open_modal(udclion.updraftplus.backupnow,t.data.output.html,function(){var t=g("#updraftcentral_modal #backupnow_includedb").is(":checked")?0:1,e=g("#updraftcentral_modal #backupnow_includefiles").is(":checked")?0:1,a=g("#updraftcentral_modal #backupnow_includecloud").is(":checked")?0:1,r="incremental"==u?1:0,n="";g('#updraftcentral_modal #backupnow_includefiles_moreoptions input[type="checkbox"]').each(function(t){if(g(this).is(":checked")){var e=g(this).attr("name");if("updraft_include_"==e.substring(0,16)){var a=e.substring(16);""!=n&&(n+=","),n+=a}}});var d="",s=!1;g('#backupnow_database_moreoptions input[type="checkbox"]').each(function(t){g(this).is(":checked")||(s=!0)}),d=!s||jQuery("input[name^='updraft_include_tables_']").serializeArray();var i=g("#always_keep").is(":checked")?1:0;""!=n||0!=e?""!=d||0!=t?(s||(d=null),t&&e?UpdraftCentral_Library.dialog.alert(udclion.updraftplus.excludedeverything):(UpdraftCentral.close_modal(),UpdraftCentral_Module_UpdraftPlus.backupnow_go(t,e,a,n,{always_keep:i,incremental:r},g("#updraftcentral_modal #backupnow_label").val(),d))):UpdraftCentral_Library.dialog.alert(udclion.updraftplus.notableschosen):UpdraftCentral_Library.dialog.alert(udclion.updraftplus.nofileschosen)},n,function(){d||"incremental"!=u?jQuery("#updraftcentral_modal .incremental-backups-only").hide():(jQuery("#updraftcentral_modal .incremental-free-only").show(),u="new"),g("#updraftcentral_modal #backupnow_label").val(""),"incremental"==u?(_(!0,r),g("#updraftcentral_modal #backupnow_includedb").prop("checked",!1),g("#updraftcentral_modal #backupnow_includefiles").prop("checked",!0),g("#updraftcentral_modal #backupnow_includefiles_label").text(udclion.updraftplus.files_incremental_backup),g("#updraftcentral_modal .new-backups-only").hide(),g("#updraftcentral_modal .incremental-backups-only").show()):(_(!1,r),g("#updraftcentral_modal #backupnow_includedb").prop("checked",!0),g("#updraftcentral_modal #backupnow_includefiles_label").text(udclion.updraftplus.files_new_backup),g("#updraftcentral_modal .new-backups-only").show(),g("#updraftcentral_modal .incremental-backups-only").hide()),g("#updraftcentral_modal #backupnow_includefiles_moreoptions").hide(),g("#updraftcentral_modal #updraft_backupnow_gotosettings").contents().unwrap()},!0,"backup-now")}})}function _(t,e){t?jQuery(e).each(function(t,e){jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("checked",!1),jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("disabled",!0)}):jQuery('#updraftcentral_modal #backupnow_includefiles_moreoptions input[type="checkbox"]').each(function(t){var e=jQuery(this).attr("name");if("updraft_include_"==e.substring(0,16)){var a=e.substring(16);jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+a).prop("disabled",!1),jQuery(this).is(":checked")&&jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+a).prop("checked",!0)}})}function u(t,e,a){var r=udclion.updraftplus.delete_areyousure_singular;-1<t.indexOf(",")&&(r=udclion.updraftplus.delete_areyousure_plural),UpdraftCentral.open_modal(udclion.updraftplus.deletebackupset,UpdraftCentral.template_replace("updraftplus-deletebackup",{nonce:e,timestamp:t,delete_question:r,also_delete_from_remote:udclion.updraftplus.also_delete_from_remote,deleting_please_allow_time:udclion.updraftplus.deleting_please_allow_time}),function(){var t=g("#updraft_delete_modal_contents").data("nonce").toString(),e=g("#updraft_delete_modal_contents").data("timestamp").toString(),a=0;g("#updraft_delete_modal_contents #updraft_delete_remote").is(":checked")&&(a=1),g("#updraftcentral_modal #updraft-delete-waitwarning").slideDown();var r=!!navigator.userAgent.match(/Opera|OPR\//);UpdraftCentral.send_site_rpc("updraftplus.deleteset",{backup_nonce:t,backup_timestamp:e,delete_remote:a,get_history_opts:{include_opera_warning:r,include_uploader:!1,will_immediately_calculate_disk_space:!1,include_header:!0}},UpdraftCentral.$site_row,function(t,e,a){if(g("#updraftcentral_modal #updraft-delete-waitwarning").slideUp(),"ok"==e&&t){var r=t.data;if(null!=r.result)if("error"==r.result)UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+r.message);else if("success"==r.result){r.hasOwnProperty("history")?(UpdraftCentral.$site_row.find(".updraftcentral_row_extracontents").html('<div class="updraft_existing_backups_output">'+UpdraftCentral_Library.sanitize_html(r.history)+"</div>"),d($site_row)):i(UpdraftCentral.$site_row),UpdraftCentral.close_modal();var n=r.message;void 0===n&&(n=r.local_message+" "+r.backup_local,n+=", "+r.remote_message+" "+r.backup_remote,n+=", "+r.set_message+" "+r.backup_sets),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.updraftplus.deleted+"</h2>"+n)}}})},udclion.updraftplus.delete,function(){a?g("#updraft-delete-remote-section, #updraft_delete_remote").removeAttr("disabled").show():g("#updraft-delete-remote-section").remove()})}function w(){var t=0,e=g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_interval").val();"manual"==e?g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_files_timings").hide():g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_files_timings").show(),"weekly"==e||"fortnightly"==e||"monthly"==e?(r("updraft_startday_files",e),g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_files").show()):(g("#updraftcentral_dashboard_existingsites .updraft_monthly_extra_words_updraft_startday_files").remove(),g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_files").hide());var a=g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_interval_database").val();"manual"==a&&(t=1,g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").hide()),"weekly"==a||"fortnightly"==a||"monthly"==a?(r("updraft_startday_db",a),g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_db").show()):(g("#updraftcentral_dashboard_existingsites .updraft_monthly_extra_words_updraft_startday_db").remove(),g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_db").hide()),a==e?(g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").hide(),0==t?g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").show():g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").hide()):(g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").hide(),0==t&&g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").show())}"notices"!=UpdraftCentral.get_dashboard_mode()&&a(),g("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set",function(t,e){e&&e.hasOwnProperty("new_mode")&&"notices"==e.new_mode||a()}),g("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_backups",function(){UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradb_another",function(){m("","","","","")}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradbs .updraft_backupextradbs_row_delete",function(){g(this).parents(".updraft_backupextradbs_row").fadeOut("medium",function(){g(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradbs .updraft_backupextradbs_row_testconnection",function(){var r=g(this).closest(".updraft_backupextradbs_row");r.find(".updraft_backupextradbs_testresultarea").html("<p><em>"+udclion.updraftplus.testing+"</em></p>");var t={row:r.attr("id"),host:r.find(".extradb_host").val(),user:r.find(".extradb_user").val(),pass:r.find(".extradb_pass").val(),name:r.find(".extradb_name").val(),prefix:r.find(".extradb_prefix").val()};UpdraftCentral.send_site_rpc("updraftplus.extradb_testconnection",t,UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&t&&r.find(".updraft_backupextradbs_testresultarea").html(UpdraftCentral_Library.sanitize_html(t.data.m))},r)}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod button.updraft-test-button",function(){var t=g(this),n=jQuery(this).data("instance_id"),d=t.data("method");!function(r,n){var t,e=r.closest(".updraftcentral_site_row"),a=r.data("method"),d=r.data("method_label"),s=r.data("instance_id");t=s?".updraftplusmethod."+a+"-"+s:".updraftplusmethod."+a;r.html(sprintf(udclion.updraftplus.testing_settings,d));var i={method:a};g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" input[data-updraft_settings_test], #updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .expertmode input[data-updraft_settings_test]").each(function(t,e){var a=g(e).data("updraft_settings_test"),r=g(e).attr("type");if(a){r||(console.log("UpdraftCentral: UpdraftPlus: settings test input item with no type found"),console.log(e),r="text");var n=null;"checkbox"==r?n=g(e).is(":checked")?1:0:"text"==r||"password"==r?n=g(e).val():(console.log("UpdraftCentral: UpdraftPlus: settings test input item with unrecognised type ("+r+") found"),console.log(e)),i[a]=n}}),g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" textarea[data-updraft_settings_test], #updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" select[data-updraft_settings_test]").each(function(t,e){var a=g(e).data("updraft_settings_test");i[a]=g(e).val()}),UpdraftCentral.send_site_rpc("updraftplus.test_storage_settings",i,e,function(t,e,a){"ok"==e&&t&&(r.html(sprintf(udclion.updraftplus.test_settings,d)),void 0!==n&&0!=n&&(n=n.call(this,t,e,a,i)),void 0!==n&&!1===n&&UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,d)+"</h2> "+t.data.output))},r.closest("td"))}(t,function(t,e,a,r){return"sftp"==d&&(void 0!==r&&r.hasOwnProperty("scp")&&r.scp?UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,"SCP")+"</h2> "+t.data.output):UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,"SFTP")+"</h2> "+t.data.output),t.hasOwnProperty("data")&&t.data&&t.data.hasOwnProperty("data")&&t.data.data&&void 0!==t.data.data.valid_md5_fingerprint&&g("#updraft_sftp_fingerprint_"+n).val(t.data.data.valid_md5_fingerprint),!0)})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraftplus-settings-save",function(i,u){var a=g(o+" input, "+o+" textarea, "+o+" select").serialize();g.each(g(o+" input[type=checkbox]").filter(function(t){return 0==g(this).prop("checked")}),function(t,e){a+="&"+g(e).attr("name")+"=0"}),spin_this=g(this).closest("td"),a+="&updraftplus_version="+h,UpdraftCentral.send_site_rpc("updraftplus.save_settings",a,i,function(t,e,a){if("ok"===e){var r=t.data.backup_dir.writable,n=t.data.backup_dir.message;t.data.backup_dir.button_title;0==r?(g(o+"#updraft_writable_mess").html(n),g(o+".backupdirrow").show()):g(o+".backupdirrow").hide();var d=i.data("site_url");g("#updraftcentral_notice_container .updraftplus_saved_settings").closest(".updraftcentral_notice").remove();var s=add_dashboard_notice("<h2>"+udclion.updraftplus.settings_saved+" - "+d+'</h2><div class="updraftplus_saved_settings" data-site_id="'+u+'">'+t.data.messages+"</div>","notice",!1);g("html, body").animate({scrollTop:s.offset().top},1e3)}},spin_this)}),UpdraftCentral.register_row_clicker(t+".backupdirrow a.updraft_backup_dir_reset",function(){g(o+"#updraft_dir").val("updraft")}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .enableexpertmode",function(){g(".updraftcentral_row_extracontents .updraft_site_settings_output .expertmode").fadeIn(),g(".updraftcentral_row_extracontents .updraft_site_settings_output .enableexpertmode").off("click")}),UpdraftCentral.register_row_clicker(t+" a.updraft_authlink",function(t){var e=g(this).attr("href");if(void 0!==e){var a=g(this).closest("td");UpdraftCentral_Library.open_browser_at(t,{module:"direct_url",url:e},a)}}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_include_entity",function(){var t=g(this).data("toggle_exclude_field");t&&U(t,!1)},!1,"change"),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft_existingbackup_date",function(t){var e=g(this).data("rawbackup");null!=e&&""!=e&&UpdraftCentral.open_modal(udclion.updraftplus.raw,e,!0,!1)},!1,"dblclick"),register_modal_listener("#always_keep_this_backup",function(t){var r=g(this).data("backup_key");UpdraftCentral.send_site_rpc("updraftplus.always_keep_this_backup",{backup_key:r,always_keep:g(this).is(":checked")?1:0},UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("rawbackup")&&(UpdraftCentral.close_modal(),g(".updraft_existing_backups_row_"+r+" .updraft_existingbackup_date").data("rawbackup",t.data.rawbackup),UpdraftCentral.open_modal(udclion.updraftplus.raw,t.data.rawbackup,!0,!1))})},"change"),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .choose-components-button",function(e){var a=this,r=g(a).data("entities"),n=g(a).closest("td");r&&UpdraftCentral_Library.dialog.confirm("<h2>"+udclion.updraftplus.restore_backup+"</h2>"+udclion.updraftplus.pre_restore_message,function(t){t&&UpdraftCentral_Library.open_browser_at(e,{module:"updraftplus",action:"initiate_restore",data:{entities:r,backup_timestamp:g(a).data("backup_timestamp"),showdata:g(a).data("showdata")}},n)})}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft_download_button",function(t){var e=t.data("site_id"),a=g(this).data("backup_timestamp"),r=g(this).data("what"),n=g(this).data("set_contents"),d=g(this).data("prettydate");g(this).closest("td");!function(f,t,e,a,h,r,n){"string"!=typeof a&&(a=a.toString()),r=!!r,a=a.split(",");var b=g('#updraftcentral_notice_container .updraftcentral_listener_updraftplus_download[data-site_id="'+f+'"');0==b.length&&(b=!1);for(var d=0;d<a.length;d++){var s=a[d],i=f+"_"+t+"_"+e+"_"+s;if(g("."+i).length)return console.log("UDCentral: There already appears to be an active downloader for this entity (stid: "+i+")");var u={type:e,timestamp:t,findex:s};UpdraftCentral.send_site_rpc("updraftplus.downloader",u,UpdraftCentral.$site_row,function(t,e,a){if("ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("result")){var r=t.data.result,n=t.data.request,d=n.timestamp,s=n.type,i=parseInt(n.findex),u=f+"_"+d+"_"+s+"_"+i,o="."+u,l="??",_=(new Date).getTime(),p=0==i?"":" ("+(i+1)+")",c=h||d;widgets_html=template_replace("updraftplus-downloader",{stid:u,download_verb:udclion.updraftplus.download_verb,what:s,itext:p,pretty_date:c,begun_looking:udclion.updraftplus.begun_looking,site_id:f,backup_timestamp:d,findex:i}),"downloaded"==r?l=template_replace("updraftplus-downloaded",{file_ready:udclion.updraftplus.file_ready,download_to_computer:udclion.updraftplus.download_to_computer,and_then:udclion.updraftplus.and_then,you_should:udclion.updraftplus.you_should,backup_timestamp:d,site_id:f,what:s,findex:i,delete_from_server:udclion.updraftplus.delete_from_server}):"needs_download"==r?l=udclion.updraftplus.needs_download:"download_failed"==r&&(l=udclion.updraftplus.download_failed),!1===b?b=UpdraftCentral.create_dashboard_listener("updraftplus_download",UpdraftCentral.$site_row,widgets_html):b.append(widgets_html),b.data("finished",!1),b.find(o).data("last_time_began",_),b.find(o+" .raw").html(l)}else UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.download_start_failed,"error")})}}(e,a,r,n,d,!0)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output button.updraft-upload-link",function(t){g(this).hide();var e=g(this).data("nonce").toString(),a=g(this).data("key").toString();e?UpdraftCentral.send_site_rpc("updraftplus.upload_local_backup",{use_nonce:e,use_timestamp:a},UpdraftCentral.$site_row,function(t,e,a){if("ok"==e&&!1!==t&&t.hasOwnProperty("data"))if(t.data.hasOwnProperty("nonce")){var r='<div class="backup_state">'+udclion.updraftplus.backupstarted+"</div>";UpdraftCentral.create_dashboard_listener("updraftplus_backup",UpdraftCentral.$site_row,r,{job_id:t.data.nonce},udclion.updraftplus.upload_backup)}else UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.backup_start_failed,"error")}):console.log("UDCentral: UpdraftPlus: A upload link was clicked, but the backup ID could not be found")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft-delete-link",function(t){var e=g(this).data("hasremote").toString();e="0"!==e;var a=g(this).data("nonce").toString(),r=g(this).data("key").toString();a?u(r,a,e):console.log("UDCentral: UpdraftPlus: A delete link was clicked, but the backup ID could not be found")}),UpdraftCentral.register_event_handler("click",".delete-backup-container input.delete_backup_item",function(t){0<g(".delete-backup-container input.delete_backup_item:checked").length?g("button#btn-backup-bulk-delete").removeClass("btn-secondary").addClass("btn-primary"):g("button#btn-backup-bulk-delete").removeClass("btn-primary").addClass("btn-secondary")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output button#btn-backup-bulk-delete",function(t){var a,r=[],n=!1;g(".delete-backup-container input.delete_backup_item").each(function(){if(g(this).is(":checked")){var t=g(this).closest("tr.updraft_existing_backups_row").find("a.updraft-delete-link"),e=t.data("key");void 0!==e&&e&&(r.push(e.toString()),a=t.data("nonce"),n||(n=void 0!==t.data("hasremote")&&"0"!==t.data("hasremote")))}}),r.length?u(r.join(),a,n):console.log("UDCentral: UpdraftPlus: The bulk delete button was clicked, but none of the backup IDs could be found")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_diskspaceused_update",function(r){var t=this.closest("ul");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"disk_usage",data:"updraft"},r,function(t,e,a){"ok"==e&&t&&r.find(".updraft_diskspaceused").html(UpdraftCentral_Library.sanitize_html(t.data.output))},t)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_rescan_local",function(r){var t=this.closest("ul");r.find(".updraft_existing_backups").html('<div class="rescanning">'+udclion.updraftplus.rescanning+"</div>"),UpdraftCentral.send_site_rpc("updraftplus.rescan","rescan",r,function(t,e,a){"ok"==e&&t&&(r.find(".updraft_existing_backups").html(t.data.t),r.find(".updraft_existing_backups_output h2").html(t.data.n),d(r))},t)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_rescan_remote",function(r){var t=this.closest("ul");r.find(".updraft_existing_backups").html('<div class="rescanning">'+udclion.updraftplus.rescanningremote+"</div>"),UpdraftCentral.send_site_rpc("updraftplus.rescan","remotescan",r,function(t,e,a){"ok"==e&&t&&(r.find(".updraft_existing_backups").html(t.data.t),r.find(".updraft_existing_backups_output h2").html(t.data.n),d(r))},t,90)}),UpdraftCentral.register_row_clicker(".updraftcentral_site_backups_manage",function(t){i(t)},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_backup_settings",function(t){s(t)},!0),UpdraftCentral.register_row_clicker(".updraft_site_settings_output select.updraft_interval, .updraft_site_settings_output select.updraft_interval_database",function(){w()},!1,"change"),UpdraftCentral.register_row_clicker(".updraft_authlink",function(n){var t=this.closest("ul"),e={remote_method:g(this).data("remote_method"),instance_id:g(this).data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.auth_remote_method",e,n,function(t,e,a){if("ok"==e&&!1!==t){var r=t.data;"error"==r.result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+r.message):"success"==r.result&&s(n)}},t)},!0),UpdraftCentral.register_row_clicker(".updraft_deauthlink",function(n){var t=this.closest("ul"),e={remote_method:g(this).data("remote_method"),instance_id:g(this).data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.deauth_remote_method",e,n,function(t,e,a){if("ok"==e&&!1!==t){var r=t.data;"error"==r.result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+r.message):"success"==r.result&&s(n)}},t)},!0),UpdraftCentral.register_row_clicker(".updraft_site_settings_output #updraft_retain_db_addnew",function(){x("db",12,604800,1,604800)}),UpdraftCentral.register_row_clicker(".updraft_site_settings_output #updraft_retain_files_addnew",function(){x("files",12,604800,1,604800)}),UpdraftCentral.register_row_clicker(".updraft_site_settings_output .updraft_retain_rules_delete, .updraft_site_settings_output .updraft_retain_rules_delete",function(){g(this).parent(".updraft_retain_rules").slideUp(function(){g(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_reportbox .updraft_reportbox_delete",function(){g(this).closest(".updraft_reportbox").fadeOut("medium",function(){g(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_report_another",function(){g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_report_another_p").before(template_replace("updraftplus-settings-report-email",{index:C,send_only_on_warnings:udclion.updraftplus.send_only_on_warnings,whole_backup:udclion.updraftplus.whole_backup,email_size_limits:udclion.updraftplus.email_size_limits,db_backup:udclion.updraftplus.db_backup})),g("#updraft_reportbox_"+C).fadeIn(),C++}),UpdraftCentral.register_event_handler("change",".updraft_report_wholebackup .updraft_report_checkbox",function(){var t=g(this).closest(".updraft_reportbox").find(".updraft_report_dbbackup");g(this).is(":checked")?t.removeClass("updraft_report_disabled").find(".updraft_report_checkbox").removeProp("disabled"):(t.find(".updraft_report_checkbox").prop("checked",!1),t.addClass("updraft_report_disabled").find(".updraft_report_checkbox").prop("disabled",!0))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more",function(){g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more").is(":checked")?g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options").slideDown():g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options").slideUp()},!1,"change"),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths_another",function(){f++,g(template_replace("updraftplus-settings-more-paths",{index:f,enter_the_directory:udclion.updraftplus.enter_the_directory,remove:udclion.updraftplus.remove})).appendTo(g(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths")).slideDown()}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options .updraftplus-morefiles-row-delete",function(){var t=g(this).closest(".updraftplus-morefiles-row");g(t).slideUp("medium",function(){g(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox",function(){var t=g(this).attr("id");if("updraft_servicecheckbox_"==t.substring(0,24)){var e=t.substring(24);null!=e&&""!=e&&(g(this).is(":checked")?(O++,g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+e).fadeIn(),P(e)):(O--,g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+e).hide(),1==g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+e).data("active")&&P(g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab:visible").last().attr("name"))))}O<=0?g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").fadeIn():g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").hide()},!1,"change"),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab",function(){P(g(this).attr("name"))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox:not(.multi)",function(){var t=g(this).attr("value");g(this).is(":not(:checked)")?(g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod."+t).hide(),g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").fadeIn()):g("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox").not(this).prop("checked",!1)},!1,"change"),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell .updraftvault_backtostart",function(){g(o+"#updraftvault_settings_showoptions").slideUp(),g(o+"#updraftvault_settings_connect").slideUp(),g(o+"#updraftvault_settings_connected").slideUp(),g(o+"#updraftvault_settings_default").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_connect input",function(t,e,a){13==a.which&&(g(o+"#updraftvault_connect_go").click(),a.preventDefault())},!1,"keypress"),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell #updraftvault_recountquota",function(){g(o+"#updraftvault_recountquota").html(udclion.updraftplus.counting),UpdraftCentral.send_site_rpc("updraftplus.vault_recountquota",{instance_id:g("#updraftvault_settings_connect").data("instance_id")},UpdraftCentral.$site_row,function(t,e,a){g(o+"#updraftvault_recountquota").html(udclion.updraftplus.update_quota_count),"ok"==e&&t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("html")&&(g(o+"#updraftvault_settings_connected").html(t.data.html),t.data.hasOwnProperty("connected")&&(t.data.connected?(g(o+"#updraftvault_settings_default").hide(),g(o+"#updraftvault_settings_connected").show()):(g(o+"#updraftvault_settings_connected").hide(),g(o+"#updraftvault_settings_default").show())))})}),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell #updraftvault_disconnect",function(){g(o+"#updraftvault_disconnect").html(udclion.updraftplus.disconnecting),UpdraftCentral.send_site_rpc("updraftplus.vault_disconnect",{instance_id:g("#updraftvault_settings_connect").data("instance_id")},UpdraftCentral.$site_row,function(t,e,a){g(o+"#updraftvault_disconnect").html(udclion.updraftplus.disconnect),"ok"==e&&t.hasOwnProperty("data")&&(g(o+"#updraftvault_disconnect").html(udclion.updraftplus.disconnect),t.data.hasOwnProperty("html")&&(g(o+"#updraftvault_settings_connected").html(t.data.html).slideUp(),g(o+"#updraftvault_settings_default").slideDown()))})}),UpdraftCentral.register_row_clicker(t+"#updraftvault_connect",function(){g(o+"#updraftvault_settings_default").slideUp(),g(o+"#updraftvault_settings_connect").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraftvault_showoptions",function(){g(o+"#updraftvault_settings_default").slideUp(),g(o+"#updraftvault_settings_showoptions").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraft_s3_newapiuser",function(r){var t=this.closest("td");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"s3_new_api_user_form",data:null},r,function(t,e,a){"ok"==e&&t&&UpdraftCentral.open_modal(udclion.updraftplus.create_new_iam_user_and_bucket,t.data.output,function(){g("#updraftcentral_modal #updraft-s3newapiuser-results").empty();var t={adminaccesskey:g("#updraftcentral_modal #updraft_s3newapiuser_adminaccesskey").val(),adminsecret:g("#updraftcentral_modal #updraft_s3newapiuser_adminsecret").val(),newuser:g("#updraftcentral_modal #updraft_s3newapiuser_newuser").val(),bucket:g("#updraftcentral_modal #updraft_s3newapiuser_bucket").val(),region:g("#updraftcentral_modal #updraft_s3newapiuser_region").val(),useservercerts:g("#updraftcentral_modal #updraft_ssl_useservercerts").val(),disableverify:g("#updraftcentral_modal #updraft_ssl_disableverify").val(),nossl:g("#updraftcentral_modal #updraft_ssl_nossl").val(),allowdelete:g("#updraftcentral_modal #updraft_s3newapiuser_allowdelete").is(":checked")?1:0,allowdownload:g("#updraftcentral_modal #updraft_s3newapiuser_allowdownload").is(":checked")?1:0},e=g("#updraftcentral_modal");UpdraftCentral.send_site_rpc("updraftplus.s3_newuser",t,r,function(t,e,a){"ok"==e&&t&&(1==t.data.e?g("#updraftcentral_modal #updraft-s3newapiuser-results").html('<p style="color:red;">'+UpdraftCentral_Library.sanitize_html(t.data.m)+"</p>"):0==t.data.e&&(g("#updraftcentral_modal #updraft-s3newapiuser-results").html('<p style="color:green;">'+UpdraftCentral_Library.sanitize_html(t.data.m)+"</p>"),g(o+"#updraft_s3_apikey").val(t.data.k),g(o+"#updraft_s3_apisecret").val(t.data.s),g(o+"#updraft_s3_rrs").prop(":checked",t.data.r),g(o+"#updraft_s3_path").val(t.data.c),g(o+"#updraft_s3_newapiuser").html(udclion.updraftplus.now_using_iam),UpdraftCentral.close_modal()))},e)},udclion.updraftplus.create)},t)}),UpdraftCentral.register_row_clicker(t+"#updraft_cloudfiles_newapiuser",function(s){var t=this.closest("td");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"cloudfiles_new_api_user_form",data:null},s,function(t,e,a){if("ok"==e){var r=UpdraftCentral.template_replace("updraftplus-cloudfiles_new_api_user",t.data.output);UpdraftCentral.open_modal(udclion.updraftplus.new_api_user,UpdraftCentral_Library.sanitize_html(r),function(){var t=g(this).closest(".modal-dialog").find(".form-table"),e={adminuser:t.find(".adminuser").val(),adminapikey:t.find(".adminapikey").val(),newuser:t.find(".newuser").val(),container:t.find(".container").val(),newemail:t.find(".newemail").val(),location:t.find(".location").val(),region:t.find(".region").val()},a=g(".modal-dialog");UpdraftCentral.send_site_rpc("updraftplus.cloudfiles_newuser",e,s,function(t,e,a){if("ok"==e){UpdraftCentral.close_modal();var r=t.data.u,n=t.data.k,d=t.data.c;s.find("#updraft_cloudfiles_user").val(r),s.find("#updraft_cloudfiles_apikey").val(n),s.find("#updraft_cloudfiles_path").val(d)}else if("error"===a)return UpdraftCentral_Library.dialog.alert("<h3>"+udclion.error+"</h3>"+t.m),!0},a)},udclion.updraftplus.create)}},t)}),UpdraftCentral.register_row_clicker(t+"#updraftvault_connect_go",function(){g(o+"#updraftvault_connect_go").html(udclion.updraftplus.connecting);var t={email:g(o+"#updraftvault_email").val(),pass:g(o+"#updraftvault_pass").val(),instance_id:g(o+"#updraftvault_settings_connect").data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.vault_connect",t,UpdraftCentral.$site_row,function(t,e,a){g(o+"#updraftvault_connect_go").html(udclion.updraftplus.connect),"ok"==e&&t.hasOwnProperty("data")&&(t.data.hasOwnProperty("e")?(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+t.data.e+"</p>"),t.data.hasOwnProperty("code")&&"no_quota"==t.data.code&&(g(o+"#updraftvault_settings_connect").slideUp(),g(o+"#updraftvault_settings_default").slideDown())):t.data.hasOwnProperty("connected")&&t.data.connected&&t.data.hasOwnProperty("html")?(g(o+"#updraftvault_settings_connect").slideUp(),g(o+"#updraftvault_settings_connected").html(t.data.html).slideDown()):(console.log(t),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.js_exception_occurred+"</p>")))})})}),g("#updraftcentral_notice_container").on("click",".updraftplus_saved_settings a.updraft_authlink",function(t){var e=g(this).attr("href");if(void 0!==e){var a=g(this).closest(".updraftplus_saved_settings").data("site_id"),r=g('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+a+'"');if(r.length<1)console.log("UpdraftCentral: UpdraftPlus: site row not found for the link clicked (site_id="+a+")");else{t.preventDefault();var n=g(this).closest(".updraftplus_saved_settings");UpdraftCentral_Library.open_browser_at(r,{module:"direct_url",url:e},n)}}}),g("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraftplus_downloader_closebutton",function(t){t.preventDefault();var e=g(this).closest(".updraftcentral_listener");g(this).closest(".updraftplus_downloader").fadeOut().remove(),e.find(".updraftplus_downloader").length<1&&(console.log(e),e.clearQueue().slideUp("slow",function(){g(this).remove()}))}),g("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_downloaded",function(t){var e=g(this).data("site_id"),a=g('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+e+'"');if(!(a.length<1)){var r=g(this).data("backup_timestamp"),n=g(this).data("what"),d=g(this).data("findex");UpdraftCentral_Library.open_browser_at(a,{module:"updraftplus",action:"download_file",data:{backup_timestamp:r,what:n,findex:d}},null)}}),g("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_delete_downloaded_backup",function(t){t.preventDefault();var r=this,e=g(this).data("site_id"),a=g('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+e+'"'),n=g(this).data("findex"),d=g(this).data("what"),s=g(this).data("backup_timestamp");UpdraftCentral.send_site_rpc("updraftplus.delete_downloaded",{timestamp:s,site_id:e,type:d,findex:n},a,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&g(r).closest(".raw").html(udclion.updraftplus.entity_deleted)})}),g("#updraftcentral_notice_container, #updraftcentral_dashboard_existingsites").on("click",".updraftcentral_listener .updraft-log-link, .updraft_existing_backups_output .updraft-log-link",function(t){t.preventDefault();var r,e,a=g(this).data("jobid");if(a){var n=g(this).closest(".updraftcentral_listener, .updraftcentral_site_row").data("site_id"),d=g('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+n+'"');r=a,e=d,UpdraftCentral.send_site_rpc("updraftplus.get_log",r,e,function(t,e,a){"ok"==e&&t&&UpdraftCentral.open_modal(udclion.updraftplus.logfile,'<pre id="updraft_poppedlog">'+UpdraftCentral_Library.sanitize_html(t.data.log)+"</pre>",function(){UpdraftCentral_Library.download_inner_html("log."+r+".txt","updraft_poppedlog")},udclion.updraftplus.downloadlog,function(){},null,!0,"modal-lg")})}else console.log(this),console.log("UpdraftPlus: A log link was clicked, but the Job ID could not be found")}),g("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_jobinfo_delete",function(t){t.preventDefault();var e,a,n,r=g(this).data("jobid");if(r){var d=g(this).closest(".updraftcentral_listener"),s=d.data("site_id"),i=g('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+s+'"');e=r,a=i,n=d,UpdraftCentral.send_site_rpc("updraftplus.activejobs_delete",e,a,function(t,e,a){if("ok"==e&&t){var r="";r=t.hasOwnProperty("data")&&t.data.hasOwnProperty("c")?"deleted"==t.data.c?udclion.updraftplus.delete_deleted:"not_found"==t.data.c?udclion.updraftplus.delete_not_found:(console.log("UDCentral: UpdraftPlus: abort job: unknown response"),console.log(t.data),UpdraftCentral_Library.sanitize_html(t.data.m)):(console.log("UDCentral: UpdraftPlus: abort job: unknown response"),console.log(t.data),udclion.js_exception_occurred),g(n).find(".backup_state:first").html(r)}})}else console.log("UpdraftPlus: A stop job link was clicked, but the Job ID could not be found"),console.log(this)});var k,v,p=!1,c=!1;function r(t,e){var a="#updraftcentral_dashboard_existingsites .updraft_site_settings_output #"+t,r="monthly"==e,n=!1;if(10<g(a+" option").length&&(n=!0),r||n)if(r&&n)"monthly"==e&&(g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_monthly_extra_words_"+t).remove(),g(a).before('<span class="updraft_monthly_extra_words_'+t+'">'+udclion.updraftplus.day+" </span>").after('<span class="updraft_monthly_extra_words_'+t+'"> '+udclion.updraftplus.in_the_month+" </span>"));else if(g("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_monthly_extra_words_"+t).remove(),r){p=g(a+" option:selected").val(),g(a).html(udclion.updraftplus.mday_selector).before('<span class="updraft_monthly_extra_words_'+t+'">'+udclion.updraftplus.day+" </span>").after('<span class="updraft_monthly_extra_words_'+t+'"> '+udclion.updraftplus.in_the_month+" </span>");var d=!1===c?1:c;g(a+" option:eq("+(d-=1)+")").prop("selected",!0)}else{c=g(a+" option:selected").val(),g(a).html(udclion.updraftplus.day_selector),g(a+" option:eq("+(!1===p?1:p)+")").prop("selected",!0)}}function x(t,e,a,r,n){var d,s="updraft_retain_"+t+"_rules";d="db"==t?++k:++v,g("#"+s).append('<div style="float:left; clear:left;" class="updraft_retain_rules '+s+'_entry">'+udclion.updraftplus.for_backups_older_than+" "+y(t,d,"after",e,a)+" keep no more than 1 backup every "+y(t,d,"every",r,n)+' <span title="'+udclion.updraftplus.delete+'" class="updraft_retain_rules_delete"><span class="dashicons dashicons-no"></span></span></div>')}function y(t,e,a,r,n){var d="updraft_retain_extrarules["+t+"]["+e+"]["+a+"-",s='<input type="number" min="1" step="1" class="additional-rule-width" name="'+d+'howmany]" value="'+r+'"> \t\t<select name="'+d+'period]">\t\t<option value="3600"';return 3600==n&&(s+=' selected="selected"'),s+=">"+udclion.updraftplus.hours+'</option>\t\t<option value="86400"',86400==n&&(s+=' selected="selected"'),s+=">"+udclion.updraftplus.days+'</option>\t\t<option value="604800"',604800==n&&(s+=' selected="selected"'),s+=">"+udclion.updraftplus.weeks+"</option>\t\t</select>"}function U(t,e){g(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t).is(":checked")?e?g(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").show():g(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").slideDown():e?g(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").hide():g(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").slideUp()}var C=1;function P(t){var e="#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output";g(e+" .updraftplusmethod").hide(),g(e+" .remote-tab").data("active",!1),g(e+" .remote-tab").removeClass("nav-tab-active"),g(e+" .updraftplusmethod."+t).show(),g(e+" .remote-tab-"+t).data("active",!0),g(e+" .remote-tab-"+t).addClass("nav-tab-active")}var O=0}jQuery(document).ready(function(t){UpdraftCentral_Module_UpdraftPlus=new UpdraftCentral_UpdraftPlus_Module,jQuery(document).keyup(function(t){if((32===t.keyCode||13===t.keyCode)&&jQuery(document.activeElement).is("input.labelauty + label")){var e=jQuery(document.activeElement).attr("for");e&&jQuery("#"+e).change()}}),Handlebars.registerHelper("maskPassword",function(t){return t.replace(/./gi,"*")}),Handlebars.registerHelper("encodeURIComponent",function(t){return encodeURIComponent(t)})});