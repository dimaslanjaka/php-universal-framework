function UpdraftCentral_WPO_Management(){var s,l,m,h,w,v=this,b=jQuery,p=new UpdraftCentral_Queue,_=new UpdraftCentral_Collection,a=UpdraftCentral.get_debug_level(),d="WP-Optimize",c="wp-optimize",u="WP-Optimize Premium",f="wp-optimize-premium",z={};function g(t,e,i){var n,o=!1,a=!1,r=i;return s=i,l=c,t||(o=!0,-1!==r.indexOf("Premium")&&(r=r.replace(" Premium",""))),!e&&t&&(a=!0),n={action:{install_and_activate:o,activate:a,messages:{not_installed:vsprintf(udclion.plugin_not_installed,[r]),install_and_activate:udclion.plugin_install_and_activate,not_activated:vsprintf(udclion.plugin_not_activated,[s]),activate:udclion.plugin_activate}}},UpdraftCentral.template_replace("wpo-wpo-not_active",n)}function i(n,o){var a="",r=P(n);UpdraftCentral.set_loading(r),L(n,d,c).then(function(t){if(t.installed&&t.active)v.load_contents(n,o);else if(v.current_section=o,!t.installed||t.installed&&!t.active){var i=!(!t.installed||t.active);L(n,u,f).then(function(t){if(t.installed&&t.active)v.load_contents(n,o);else{var e=!(!t.installed||t.active);a=!e&&i?g(!0,!1,d):g(t.installed,t.active,u),UpdraftCentral.done_loading(r,a)}}).fail(function(t){$(t),UpdraftCentral.done_loading(r,a)})}else!t.active&&t.installed&&(a=g(t.installed,t.active,d),UpdraftCentral.done_loading(r,a))}).fail(function(t){$(t),UpdraftCentral.done_loading(r,a)})}function y(){0===b(".wpo_scheduled_event:visible").length?(b(".wpo_auto_event_heading_container").hide(),b(".wpo_no_schedules").show()):(b(".wpo_auto_event_heading_container").show(),b(".wpo_no_schedules").hide()),0!==b(".wpo_scheduled_event:visible").length||0!==b(".wpo_auto_event:visible").length||b("#save_settings_reminder").is(":visible")?b(".wpo_no_schedules").hide():b(".wpo_no_schedules").show()}function k(){b(".wpo_auto_optimizations").select2({placeholder:h.select_optimizations}),b(".wpo_auto_optimizations").off("select2:open").on("select2:open",function(){b.fullscreen.isFullScreen()&&b(document.body).children("span.select2-container--open").appendTo("#updraftcentral_dashboard")}),b(".wpo_auto_optimizations").off("select2:opening select2:closing").on("select2:opening select2:closing",function(t){b(this).parent().find(".select2-search__field").prop("disabled",!0)})}function C(t){return confirm(h.are_you_sure_you_want_to_remove_logging_destination)&&(t.closest(".wpo_logging_row, .wpo_add_logger_form").remove(),b(".wpo_logger_type").each(function(){x(b(this))}),0==b("#wp-optimize-logging-options .wpo_logging_row").length&&b("#wp-optimize-logging-options").hide(),U()),!1}function U(){var t=b("#wp-optimize-logger-settings .save_settings_reminder");t.is(":visible")||t.slideDown("normal")}function x(t){var e,i,n,o=(n=[],b(".wpo_logging_row, .wpo_logger_type").each(function(){var t=b(this).is("select")?b(this).val():b(this).data("id");t&&n.push(t)}),n);for(e in o)i=o[e],h.loggers_classes_info[i].allow_multiple?b('option[value="'+i+'"]',t).show():b('option[value="'+i+'"]',t).hide()}function j(t){var e,i,n;if(t)for(e in t)t.hasOwnProperty(e)&&(i=["#wp-optimize-settings-",t[e].dom_id].join(""),n=t[e].info?t[e].info.join("<br>"):"",b(i+" .wp-optimize-settings-optimization-info").html(n))}function O(){var e=[];return b('#wpo_settings_sites_list input[type="checkbox"]').each(function(){var t=b(this);t.is(":checked")&&e.push(t.attr("value"))}),e}function D(t,e){var i=0,n=0;if(e.each(function(){b(this).is(":checked")&&n++,i++}),t.next().is("label")&&t.next().data("label")){var o=t.next(),a=o.data("label");i==n?o.text(a):o.text(a.replace("all",[n," of ",i].join("")))}i==n?t.prop("checked",!0):t.prop("checked",!1)}function P(t){var e=t.find(".updraftcentral_row_extracontents"),i=e.find(".updraftcentral_wpo_rows");return 0===i.length&&(i=b('<div class="updraftcentral_wpo_rows"></div>').appendTo(e)),i}function $(t){if(void 0!==t.data){var e=t.data;if(null!==e&&void 0!==e.message){var i=udclion.wpo[e.message];void 0===i&&void 0===(i=udclion[e.message])&&(i=udclion.unknown_response),void 0!==e.values?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+vsprintf(i,e.values)+"</p>"):UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+i+"</p>")}}}function q(t){var i="";return"object"==(t=void 0===t?"string":t)?i=b(".updraftcentral_wpo_rows form input[name!='action'], .updraftcentral_wpo_rows form textarea, .updraftcentral_wpo_rows form select").serializeJSON({useIntKeysAsArrayIndex:!0}):(i=b(".updraftcentral_wpo_rows form input[name!='action'], .updraftcentral_wpo_rows form textarea, .updraftcentral_wpo_rows form select").serialize(),b.each(b(".updraftcentral_wpo_rows form input[type=checkbox]").filter(function(t){return 0==b(this).prop("checked")}),function(t,e){i+="&"+b(e).attr("name")+"=0"})),i}function S(){b("#enable-schedule").is(":checked")?b("#wp-optimize-auto-options").css("opacity","1"):b("#wp-optimize-auto-options").css("opacity","0.5")}function M(){b("#wp-optimize-logger-updraft_ring_logger").is(":checked")?b("#additional_options_updraft_ring_logger").show():b("#additional_options_updraft_ring_logger").hide()}function W(){b("#wp-optimize-logger-updraft_slack_logger").is(":checked")?b("#additional_options_updraft_slack_logger").show():b("#additional_options_updraft_slack_logger").hide()}function T(t,e){var i=b.Deferred();return F({name:"do_optimization",arguments:t},e).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise()}function F(t,e){var n=b.Deferred();return UpdraftCentral.send_site_rpc("wpoptimize."+t.name,t.arguments,e,function(t,e,i){"ok"!==e||void 0===t.data||null===t.data||t.data.error?n.reject(t):n.resolve(t.data)}),n.promise()}function L(t,e,i){return UpdraftCentral.is_plugin_active(t,e,i)}function r(n,t){!0!==b(".optimization_button_"+n).prop("disabled")&&(b("#optimization_checkbox_"+n).hide(),b("#optimization_spinner_"+n).show(),b(".optimization_button_"+n).prop("disabled",!0),b("#optimization_info_"+n).html("..."),"optimizetables"==n?b(m).each(function(t){var e=b(this).find("td");if(table_type=e.eq(5).text(),table=e.eq(1).text(),optimizable=e.eq(5).data("optimizable"),""!=table&&"1"==optimizable){var i={optimization_id:n,optimization_table:e.eq(1).text(),optimization_table_type:table_type};p.enqueue(i)}}):p.enqueue(n),function r(s){if(p.get_lock()){0<a&&console.log("WP-Optimize: process_queue(): got queue lock");var l=p.peek();if("object"==typeof l?l=(data=l).optimization_id:data={},void 0===l)return b(document).trigger("updraftcentral_wpo_opimization_end",[s]),0<a&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),void p.unlock();0<a&&console.log("WP-Optimize: process_queue(): processing item: "+l),p.dequeue(),T({optimization_id:l,data:data},s).then(function(t){if(b("#optimization_spinner_"+l).hide(),b("#optimization_checkbox_"+l).show(),b(".optimization_button_"+l).prop("disabled",!1),t){for(var e="",i=0,n=t.errors.length;i<n;i++)e+='<span class="error">'+t.errors[i]+"</span><br>";for(i=0,n=t.messages.length;i<n;i++)e+=t.errors[i]+"<br>";for(i=0,n=t.result.output.length;i<n;i++)e+=t.result.output[i]+"<br>";if(b("#optimization_info_"+l).html(e),t.hasOwnProperty("status_box_contents")&&(b("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t.status_box_contents),b("a#wp_optimize_status_box_refresh").attr("href","#"),UpdraftCentral.register_event_handler("click","a#wp_optimize_status_box_refresh",function(){v.load_contents(s,"wp_optimize")})),t.hasOwnProperty("table_list")&&b("#wpoptimize_table_list tbody").replaceWith(t.table_list),t.hasOwnProperty("total_size")&&b("#optimize_current_db_size").html(t.total_size),"optimizetables"===l&&data.optimization_table){var o=p.peek();p.is_empty()||void 0===o.optimization_table?(b("#optimization_spinner_"+l).hide(),b("#optimization_checkbox_"+l).show(),b(".optimization_button_"+l).prop("disabled",!1),b("#optimization_info_"+l).html(udclion.wpo.optimization_complete)):(b("#optimization_checkbox_"+l).hide(),b("#optimization_spinner_"+l).show(),b(".optimization_button_"+l).prop("disabled",!0))}if(t.result.meta&&t.result.meta.hasOwnProperty("awaiting_mod")){var a=t.result.meta.awaiting_mod;0<a?b("#adminmenu .awaiting-mod .pending-count").remove(a):b("#adminmenu .awaiting-mod").remove()}}setTimeout(function(){p.unlock(),r(s)},10)})}else 0<a&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting")}(t))}b("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_wpo",function(){UpdraftCentral.register_row_clicker(".updraftcentral_site_wp_optimize",function(t){i(t,"wp_optimize")},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_table_information",function(t){i(t,"table_information")},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_settings",function(t){i(t,"settings")},!0),UpdraftCentral.register_row_clicker("#btn-activate",function(e){var t,i,n,o=P(e);UpdraftCentral.set_loading(o),(t=e,i=s,n=l,UpdraftCentral.activate_plugin(t,i,n)).then(function(t){t.activated&&v.load_contents(e,v.current_section)}).fail(function(t){$(t),UpdraftCentral.done_loading(o)})},!0),UpdraftCentral.register_row_clicker("#btn-install-activate",function(e){var t,i,n,o=P(e);UpdraftCentral.set_loading(o),(t=e,i=d,n=c,UpdraftCentral.install_activate_plugin(t,i,n)).then(function(t){(t.installed||t.activated)&&v.load_contents(e,v.current_section)}).fail(function(t){$(t),UpdraftCentral.done_loading(o)})},!0)}),b(document).on("updraftcentral_wpo_opimization_start",function(t,e){void 0!==e&&P(e).css("opacity","0.3")}),b(document).on("updraftcentral_wpo_opimization_end",function(t,e){void 0!==e&&(P(e).css("opacity","1.0"),F({name:"optimizations_done",arguments:{}},e),e.find("table#optimizations_list tr").each(function(){var t=b(this).data("optimization_id");b(this).find("#optimization_spinner_"+t).is(":visible")&&(b(this).find("#optimization_spinner_"+t).hide(),b(this).find("#optimization_checkbox_"+t).show(),b(this).find(".optimization_button_"+t).prop("disabled",!1),"optimizetables"===t&&b(this).find("#optimization_info_"+t).html(udclion.wpo.optimization_complete))}))}),b("#updraftcentral_dashboard_existingsites").on("updraftcentral_listener_finished_updraftplus_backup",function(t,e){if(t.preventDefault(),void 0!==e.site_id){var i="site_"+e.site_id;if(_.exists(i)){var n=_.item(i);if(!n.autobackup_complete){var o=n.autobackup_options;n.autobackup_complete=!0,void 0!==o&&void 0!==o.callback&&o.callback.apply(null,[])}}}else 0<a&&console.log("WP-Optimize: unexpected site id was returned - exiting")}),this.toggle_feature=function(t,e,i){var n,o,a,r,s=P(i);if(void 0!==e&&e.length){var l=e.attr("id").split("-"),p=l[l.length-1];p="enable"===p,UpdraftCentral.set_loading(s),(n=t,o=p,a=i,r=b.Deferred(),F({name:"enable_or_disable_feature",arguments:{type:n,enable:o?1:0}},a).then(function(t){r.resolve(t)}).fail(function(t){r.reject(t)}),r.promise()).then(function(t){void 0!==t.output&&t.output.length&&UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.feature_update_heading+"</h2><p>"+t.output[0]+"</p>")}).fail(function(t){$(t)}).always(function(){UpdraftCentral.done_loading(s)})}},this.save_settings=function(t){var e,i,n,o,a,r=P(t),s=q(),l=(i=0,b("#wpo_auto_events .wpo_auto_event").each(function(){0===b(this).find("ul.select2-selection__rendered > li.select2-selection__choice").length&&i++}),i);if(!function(){var t=!0,e=h.fill_all_settings_fields;b("ul.select2-selection__rendered").each(function(){0===b(this).find("li.select2-selection__choice").length?(t=!1,e=h.fill_all_fields,b(this).closest(".select2-selection--multiple").addClass("wpo_error_field")):b(this).closest(".select2-selection--multiple").removeClass("wpo_error_field")}),b(".wpo_schedule_type, .wpo_logger_addition_option, .wpo_logger_type").each(function(){!function(t,e){var i=t.val(),n=t.data("validate");if(!n&&e)return""!=b.trim(i);if(n&&!e&&""==b.trim(i))return!0;var o=!0;switch(n){case"email":for(var a=/\S+@\S+\.\S+/,r=i.split(","),s="",l=0;l<r.length;l++)""!=(s=b.trim(r[l]))&&a.test(s)||(o=!1);break;case"url":var a=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i;o=a.test(i)}return o}(b(this),!0)?(t=!1,b(this).addClass("wpo_error_field")):b(this).removeClass("wpo_error_field")}),t?b("#wp-optimize-logger-settings .save_settings_reminder").slideUp():b("#wp-optimize-settings-save-results").show().addClass("wpo_alert_notice").text(e).delay(5e3).fadeOut(3e3,function(){b(this).removeClass("wpo_alert_notice")});return t}())return!1;0<l?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+udclion.wpo.empty_schedule+"</p>"):(UpdraftCentral.set_loading(r),(n=s,o=t,a=b.Deferred(),F({name:"save_settings",arguments:n},o).then(function(t){a.resolve(t)}).fail(function(t){a.reject(t)}),a.promise()).then(function(t){void 0!==t.save_results&&(e=t.save_results)}).fail(function(t){$(t)}).always(function(){UpdraftCentral.done_loading(r).then(function(){void 0!==e&&(void 0!==e.errors&&e.errors.length?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+e.errors[0]+"</p>"):(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+e.messages[0]+"</p>"),v.load_contents(t,"settings")))})}))},this.run_optimization_single=function(t,i){b(document).trigger("updraftcentral_wpo_opimization_start",[i]),v.pre_optimization_run(i,!1,function(){var e=b(t).closest(".wp-optimize-settings").data("optimization_id");e?v.pre_save_options(i,function(t){b("#wpo_settings_sites_list").length?v.save_sites_list({"wpo-sites":O()},i).then(function(t){r(e,i)}):r(e,i)}):console.log("Optimization ID corresponding to pressed button not found")})},this.run_optimization_all=function(o){b(document).trigger("updraftcentral_wpo_opimization_start",[o]),v.pre_optimization_run(o,!0,function(){v.pre_save_options(o,function(n){if(b("#wpo_settings_sites_list").length)v.save_sites_list({"wpo-sites":O()},o).then(function(t){for(var e in n){var i=n[e];void 0!==i.active&&1==i.active&&r(e,o)}});else for(var t in n){var e=n[t];void 0!==e.active&&1==e.active&&r(t,o)}})})},this.pre_save_options=function(t,e){var i,n,o,a,r=(i={},$optimizations=b("#optimizations_list .optimization_checkbox:checked"),$optimizations.sort(function(t,e){return t=b(t).closest(".wp-optimize-settings").data("optimization_run_sort_order"),(e=b(e).closest(".wp-optimize-settings").data("optimization_run_sort_order"))<t?1:t<e?-1:0}),$optimizations.each(function(t){var e=b(this).closest(".wp-optimize-settings").data("optimization_id");e?i[e]={active:1}:console.log("Optimization ID corresponding to pressed button not found")}),i);(n=r,o=t,a=b.Deferred(),F({name:"save_manual_run_optimization_options",arguments:n},o).then(function(t){a.resolve(t)}).fail(function(t){a.reject(t)}),a.promise()).then(function(t){e.apply(null,[r])}).fail(function(t){$(t)})},this.pre_optimization_run=function(o,t,a){if(void 0===t||!t||!1!==confirm(udclion.wpo.warning)){var e,i,n,r=!1;b("#enable-auto-backup").is(":checked")&&(r=!0),(e=r,i=o,n=b.Deferred(),F({name:"save_auto_backup_option",arguments:{auto_backup:e}},i).then(function(t){n.resolve(t)}).fail(function(t){n.reject(t)}),n.promise()).then(function(t){var e="site_"+o.data("site_id");if(_.exists(e)){var i=_.item(e);if(r&&!i.autobackup_complete){var n={_listener_title:"<h2>"+o.data("site_description")+" - "+udclion.wpo.automatic_backup+"</h2>"};i.autobackup_options={callback:a},UpdraftCentral.set_current_site_row(o),UpdraftCentral_Module_UpdraftPlus.backupnow_go(!1,!1,!1,"",n,udclion.wpo.automatic_backup,"")}else a.apply(null,[])}}).fail(function(t){$(t)})}},this.load_contents=function(c,u){var f="",g=P(c),t="site_"+c.data("site_id");if(!_.exists(t)){var i=new UpdraftCentral_Site(c);_.add(t,i)}var n={name:"get_"+u+"_contents",arguments:{}};UpdraftCentral.set_loading(g),F(n,c).then(function(t){void 0!==t&&(void 0!==t.content?(f=t.content,h=t.translations):f=t)}).fail(function(t){var e=$(t);void 0!==e&&e.length&&(f=e)}).always(function(){UpdraftCentral.done_loading(g,f).then(function(){if(f&&f.length){b("img.optimization_spinner, img#wpo_import_spinner").attr("src",udclion.wpo.images+"spinner-2x.gif").attr("alt","").addClass("wp_uc_spinner"),g.find(".wpo_section .button").addClass("btn"),g.find(".wpo_section .button-primary").addClass("btn-primary"),g.find(".wpo_section .button-secondary").addClass("btn-secondary"),g.find("a#wp_optimize_status_box_refresh").attr("href","#");var t=g.find("input#wp-optimize-settings-save");void 0!==t&&t.length&&(btn_save_clone=t.clone(),btn_save_clone.attr("type","button"),t.replaceWith(btn_save_clone));var i=g.find("input#wp-optimize");void 0!==i&&i.length&&(btn_optimize_clone=i.clone(),btn_optimize_clone.attr("type","button"),i.replaceWith(btn_optimize_clone)),b("#optimizations_list .wp-optimize-settings-optimization-info a").each(function(){b(this).attr("target","_blank")}),S(),M(),W(),"wp_optimize"===u&&v.get_optimization_tables(c).then(function(t){var e=b("<div>").html(t.table_list);m=e.find("tbody#the-list tr")}),s=b("#wpoptimize_table_list_filter"),p=b("#wpoptimize_table_list"),_=b("#wpoptimize_table_list tbody:last"),d=b("#wpoptimize_table_list_tables_not_found"),p.tablesorter({theme:"default",widgets:["zebra","rows","filter"],cssInfoBlock:"tablesorter-no-sort",headers:{7:{sorter:!1}},widgetOptions:{filter_external:s,filter_defaultFilter:{2:"~{query}"}}}),p.on("filterEnd",function(){""==b.trim(s.val())?_.show():_.hide(),0==b("#the-list tr:visible",p).length?d.show():d.hide()}),b("button.run-single-table-optimization").addClass("btn btn-secondary"),b("#optimize_current_db_size").closest("h3").addClass("updraftcentral-current-db-size"),b("#wpoptimize_table_list > tbody > tr").each(function(t){var e=b(this);t%2==1?e.addClass("even"):e.addClass("odd")}),b("#wpoptimize_table_list th > div.tablesorter-header-inner").each(function(){var t=b(this).html();b(this).closest("th").attr("data-label",t)});var n="";if(b("#wpo_settings_sites_list_cron").length&&(n="_cron"),D(b("#wpo_settings_sites_list"+n+" #wpo_all_sites"+n),b("#wpo_sitelist_moreoptions"+n+' input[type="checkbox"]')),UpdraftCentral.register_event_handler("click","#wpo_sitelist_show_moreoptions"+n,function(){b("#wpo_sitelist_moreoptions"+n).hasClass("wpo_always_visible")||b("#wpo_sitelist_moreoptions"+n).toggleClass("wpo_hidden")}),UpdraftCentral.register_event_handler("change","#wpo_settings_sites_list"+n+" #wpo_all_sites"+n,function(){var t=b(this),e=b("#wpo_sitelist_moreoptions"+n+' input[type="checkbox"]');t.is(":checked")?e.prop("checked",!0):e.prop("checked",!1),D(t,e)}),UpdraftCentral.register_event_handler("change","#wpo_sitelist_moreoptions"+n+' input[type="checkbox"]',function(){var t=b("#wpo_sitelist_moreoptions"+n+' input[type="checkbox"]');D(b("#wpo_settings_sites_list"+n+" #wpo_all_sites"+n),t)}),UpdraftCentral.register_event_handler("change",'#wpo_settings_sites_list input[type="checkbox"]',function(){!function(t){var e=[t.data("site_id"),O().join("_")].join("_");if(z.hasOwnProperty(e))j(z[e]);else{var i={name:"get_optimizations_info",arguments:{"wpo-sites":O()}};F(i,t).then(function(t){void 0!==t&&!1!==t&&j(z[e]=t)})}}(c)}),UpdraftCentral.register_event_handler("click","#wpoptimize_table_list .run-single-table-optimization",function(){var e=b(this),i=e.next(),n=i.next(),t={optimization_id:"optimizetables",optimization_table:e.data("table"),optimization_table_type:e.data("type")};i.removeClass("visibility-hidden"),T({optimization_id:"optimizetables",data:t},c).then(function(t){e.prop("disabled",!1),i.addClass("visibility-hidden"),n.show().removeClass("visibility-hidden").delay(3e3).fadeOut("slow")})}),UpdraftCentral.register_event_handler("click","#wpoptimize_table_list .run-single-table-delete",function(){if(!confirm(udclion.wpo.are_you_sure_you_want_to_remove_this_table))return!1;var n=b(this),t=n.next(),o=t.next(),a=n.data("table");data={optimization_id:"orphanedtables",optimization_table:a},t.removeClass("visibility-hidden");var e={optimization_id:"orphanedtables",data:data};v.pre_optimization_run(c,!1,function(){T(e,c).then(function(t){if(t.result.meta.success){var i=n.closest("tr");o.show().removeClass("visibility-hidden"),setTimeout(function(){i.fadeOut("slow",function(){var t,e;i.remove(),t=b("#wpoptimize_table_list"),e=!0,b("tr",t).each(function(){var t=b(this);if(0<b("button",t).length)return e=!1}),b("tr",t).each(function(){var t=b(this);e?b("td:last, th:last",t).hide():b("td:last, th:last",t).show()})})},500)}else{var e=vsprintf(udclion.wpo.table_was_not_deleted,[a]);t.result.meta.message&&(e+="("+t.result.meta.message+")"),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+e+"</p>")}}).always(function(){n.prop("disabled",!1),t.addClass("visibility-hidden")})})}),UpdraftCentral.register_event_handler("click","#wpo_import_settings_btn",function(){var t=b("#wpo_import_settings_file"),i=t.val(),n=t[0].files[0],o=new FileReader;if(b("#wpo_import_settings_btn").prop("disabled",!0),!/\.json$/.test(i))return e.preventDefault(),b("#wpo_import_settings_btn").prop("disabled",!1),b("#wpo_import_error_message").text(udclion.wpo.please_select_settings_file).slideDown(),!1;o.onload=function(){var t,e,i,n,o,a;t=this.result,e=c,i=b("#wpo_import_spinner"),n=b("#wpo_import_success_message"),o=b("#wpo_import_error_message"),a={name:"import_settings",arguments:{settings:t}},i.show(),F(a,e).then(function(t){i.hide(),t&&t.errors&&t.errors.length?(o.text(t.errors.join("<br>")),o.slideDown()):t&&t.messages&&t.messages.length&&(n.text(t.messages.join("<br>")),n.slideDown(),setTimeout(function(){v.load_contents(e,"settings")},2e3)),b("#wpo_import_settings_btn").prop("disabled",!1)})},o.readAsText(n)}),UpdraftCentral.register_event_handler("change","#wpo_import_settings_file",function(){b("#wpo_import_error_message").slideUp()}),UpdraftCentral.register_event_handler("click","#wpo_export_settings_btn",function(){var t,e,i,n,o,a,r;t=q("object"),i=document.body.appendChild(document.createElement("a")),n=new Date,o=n.getFullYear(),a=n.getMonth()<10?["0",n.getMonth()].join(""):n.getMonth(),r=n.getDay()<10?["0",n.getDay()].join(""):n.getDay(),e=e||["wpo-settings-",o,"-",a,"-",r,".json"].join(""),i.setAttribute("download",e),i.setAttribute("style","display:none;"),i.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(JSON.stringify(t))),i.click()}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#innodb_force_optimize",function(){var t=b(this).closest("tr.wp-optimize-settings"),e=b(this).is(":checked");t.find("input.optimization_checkbox, button.wp-optimize-settings-optimization-run-button").each(function(){!e&&b(this).hasClass("optimization_checkbox")&&b(this).prop("checked",!1),b(this).prop("disabled",!e)})}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#enable-schedule",function(){S()}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#wp-optimize-logger-updraft_ring_logger",function(){M()}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#wp-optimize-logger-updraft_slack_logger",function(){W()}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows #wp_optimize_table_list_refresh",function(){v.load_contents(c,"table_information")}),UpdraftCentral.register_event_handler("click",'.updraftcentral_wpo_rows button[id^="wp-optimize-disable-enable-trackbacks-"]',function(){v.toggle_feature("trackbacks",b(this),c)}),UpdraftCentral.register_event_handler("click",'.updraftcentral_wpo_rows button[id^="wp-optimize-disable-enable-comments-"]',function(){v.toggle_feature("comments",b(this),c)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#wp-optimize-settings-save",function(){v.save_settings(c)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows a#wp_optimize_status_box_refresh",function(){v.load_contents(c,"wp_optimize")}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows button.wp-optimize-settings-optimization-run-button",function(){v.run_optimization_single(this,c)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#wp-optimize",function(){v.run_optimization_all(c)}),void 0!==h){var o=b("#wp-optimize-auto-options"),a=b('input[type="time"]'),r=b('input[type="date"]'),l=(new Date).toISOString().split("T")[0];w=b(".wpo_auto_event:last").data("count")||0,a.each(function(t,e){Modernizr.inputtypes.time||(b(e).timepicker({timeFormat:"H:i"}),b(e).addClass("no_date_time_support"),b(e).on("changeTime",function(){b(this).timepicker("hide")}))}),r.each(function(t,e){Modernizr.inputtypes.date||(b(e).datepicker({dateFormat:"yy-mm-dd",minDate:0}),b(e).addClass("no_date_time_support"))}),0!==b(".wpo_scheduled_event").length?b(".wpo_no_schedules").hide():b(".wpo_no_schedules").show(),k(),b("#wpo-add-event").on("click",function(t){w++;var e=UpdraftCentral.template_replace("schedule-optimizations",{optimizations:h.auto_optimizations,count:w}),i=UpdraftCentral.template_replace("schedule-schedule_types",{schedule_types:h.schedule_types,count:w}),n=UpdraftCentral.template_replace("schedule-action",{count:w}),o='<div class="wpo_auto_event wpo_cf" data-count="'+w+'">';o+=e+i+n,o+="</div>",b("#wpo_auto_events").prepend(o+'<div class="clear"></div>'),k()}),$logging=b("#wp-optimize-logger-settings"),$logging.find(".wpo_logging_header").append('<div class="clear"></div>'),$logging.find(".wpo_logging_row").append('<div class="clear"></div>'),$logging.find(".wpo_logging_row").each(function(){0===b(this).find(".wpo_logging_options_row").html().length&&b(this).find(".wpo_logging_options_row").html("&nbsp;")}),$logging.find("#wpo_add_logger_link").on("click",function(){b("#wp-optimize-logger-settings .save_settings_reminder").after(function(){var t,e=['<option value="">Select destination</option>'];for(t in h.loggers_classes_info)h.loggers_classes_info.hasOwnProperty(t)&&e.push(['<option value="',t,'">',h.loggers_classes_info[t].description,"</option>"].join(""));return['<div class="wpo_add_logger_form">','<select class="wpo_logger_type" name="wpo-logger-type[]">',e.join(""),"<select>",'<a href="#" class="wpo_delete_logger dashicons dashicons-no-alt"></a>','<div class="wpo_additional_logger_options"></div>',"</div>"].join("")}()),x(b(".wpo_logger_type").first()),$logging.find(".wpo_logger_type").on("change",function(){var t=b(this),e=t.val();t.parent().find(".wpo_additional_logger_options").html(function(t){if(!h.loggers_classes_info[t].options)return"";var e,i=h.loggers_classes_info[t].options,n=[],o="",a="";for(e in i)i.hasOwnProperty(e)&&(a=b.isArray(i[e])?(o=b.trim(i[e][0]),b.trim(i[e][1])):(o=b.trim(i[e]),""),n.push(['<input class="wpo_logger_addition_option" type="text" name="wpo-logger-options[',e,'][]" value="" ','placeholder="',o,'" ',""!==a?'data-validate="'+a+'"':"","/>"].join("")));return n.push('<input type="hidden" name="wpo-logger-options[active][]" value="1" />'),n.join("")}(e)),t.val()&&U()}),$logging.find(".wpo_add_logger_form a.wpo_delete_logger").on("click",function(){C(b(this))})}),$logging.find(".wpo_logging_row a.wpo_delete_logger").on("click",function(){C(b(this))}),$logging.find(".wpo_logging_actions_row .dashicons-edit").on("click",function(){var t=b(this),e=t.closest(".wpo_logging_row");return b(".wpo_additional_logger_options",e).removeClass("wpo_hidden"),b(".wpo_logging_options_row",e).text(""),b(".wpo_logging_status_row",e).text(""),t.hide(),!1}),$logging.find(".wpo_logging_row input.wpo_logger_active_checkbox").on("click",function(){var t=b(this).is(":checked")?1:0;b(this).closest("label").find('input[type="hidden"]').val(t)}),$auto_events=b("#wpo_auto_events"),$auto_events.find(".wpo_auto_event_heading_container").append('<div class="clear"></div>'),$auto_events.find(".wpo_scheduled_event").append('<div class="clear"></div>'),o.on("focus",'input[type="time"]',function(){var t=b(this).get(0);Modernizr.inputtypes.time||(b(t).timepicker({timeFormat:"H:i"}),b(t).on("changeTime",function(){b(this).timepicker("hide")}))}),o.on("keypress","input",function(t){if(13===t.keyCode)return!1}),o.on("focus",'input[type="date"]',function(){var t=b(this).get(0);Modernizr.inputtypes.date||b(t).datepicker({dateFormat:"yy-mm-dd",minDate:0})}),o.on("change",'select, input[type="date"], input[type="time"]',function(){b("#save_settings_reminder").slideDown(),y()}),o.on("change",".wpo_schedule_type",function(){var t=b(this).closest(".wpo_auto_event"),e=t.data("count")||w,i=b(this).val(),n="";Modernizr.inputtypes.date&&Modernizr.inputtypes.time||(n="no_date_time_support");var o={date:h.date,time:h.time,day:h.day,day_number:h.day_number,days:h.days,date_value:"",time_value:"00:00",status:h.active,status_value:"checked",week_days:h.week_days,week:h.week,count:e,class_name:n,today:l},a=function(t,e){var i="";switch(t){case"wpo_once":i=UpdraftCentral.template_replace("schedule-once",{details:e});break;case"wpo_daily":i=UpdraftCentral.template_replace("schedule-daily",{details:e});break;case"wpo_weekly":i=UpdraftCentral.template_replace("schedule-weekly",{details:e});break;case"wpo_fortnightly":i=UpdraftCentral.template_replace("schedule-fortnightly",{details:e});break;case"wpo_monthly":i=UpdraftCentral.template_replace("schedule-monthly",{details:e})}return i}(i,o),r=UpdraftCentral.template_replace("schedule-status",{details:o}),s=UpdraftCentral.template_replace("schedule-action",{});b(this).next().html(""),t.find(".wpo_event_status").remove(),t.find(".wpo_event_actions").remove(),""!==a&&b(this).next().html(a),t.append(r+s)}),o.on("click",".wpo_edit_event",function(){var t=b(this).closest(".wpo_scheduled_event");t.hide(),t.next().append('<div class="clear"></div>').show(),y()}),o.on("click",".wpo_remove_event",function(){var t=b(this).data("count");if(!0===confirm(h.confirm_remove_task)){var e=b(this).closest(".wpo_scheduled_event"),i=b(this).closest(".wpo_auto_event");t==e.next().data("count")&&(e.next().remove(),e.remove()),t==i.prev().data("count")&&i.prev().remove(),i.remove(),b("#save_settings_reminder").slideDown(),y()}})}}else UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.wpo.could_not_return_content+"</p>"),g.empty();var s,p,_,d})})},this.save_sites_list=function(t,e){var i=b.Deferred();return F({name:"save_site_settings",arguments:t},e).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise()},this.get_optimization_tables=function(t){var e=b.Deferred();return F({name:"get_table_list",arguments:{}},t).then(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e.promise()}}jQuery(document).ready(function(){new UpdraftCentral_WPO_Management});